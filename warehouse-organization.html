<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELSA</title>
    <style>
        :root {
            --primary-color: #409EFF;
            --secondary-color: #67C23A;
            --warning-color: #E6A23C;
            --danger-color: #F56C6C;
            --success-color: #67C23A;
            --text-color: #303133;
            --text-light: #606266;
            --border-color: #DCDFE6;
            --background-color: #f5f7fa;
            --card-bg: #ffffff;
            --sidebar-width: 240px;
            --header-height: 60px;
            --shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;
            color: var(--text-color);
            background-color: var(--background-color);
            line-height: 1.5;
        }
        
        /* å¸ƒå±€ */
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .app-header {
            height: var(--header-height);
            background: linear-gradient(135deg, #1a3a8f, #2c52c0);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            box-shadow: var(--shadow);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .logo {
            font-size: 22px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .logo-icon {
            margin-right: 10px;
            font-size: 28px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(45deg, #409EFF, #66b1ff);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }
        
        /* ä¾§è¾¹æ  */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--card-bg);
            height: calc(100vh - var(--header-height));
            position: fixed;
            top: var(--header-height);
            left: 0;
            box-shadow: var(--shadow);
            z-index: 900;
            transition: var(--transition);
            overflow-y: auto;
        }
        
        .menu {
            list-style: none;
            padding: 20px 0;
        }
        
        .menu-item {
            padding: 14px 25px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            color: var(--text-color);
        }
        
        .menu-item:hover, .menu-item.active {
            background-color: #f0f5ff;
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
        }
        
        .menu-item i {
            margin-right: 12px;
            font-size: 18px;
            width: 20px;
            text-align: center;
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 25px;
            margin-top: var(--header-height);
            transition: var(--transition);
        }
        
        .page-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 25px;
            color: var(--text-color);
            display: flex;
            align-items: center;
        }
        
        .page-title i {
            margin-right: 12px;
            font-size: 28px;
            color: var(--primary-color);
        }
        
        /* å¡ç‰‡ç»„ä»¶ */
        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            overflow: hidden;
        }
        
        .card-header {
            padding: 18px 25px;
            border-bottom: 1px solid var(--border-color);
            font-weight: bold;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-body {
            padding: 25px;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 10px 20px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #3385e0;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #5aac33;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }
        
        .btn + .btn {
            margin-left: 10px;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .table th, .table td {
            padding: 14px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .table th {
            background-color: #f8f9fc;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .table tr:hover {
            background-color: #f9fbfd;
        }
        
        /* æ ‡ç­¾ */
        .tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .tag-primary {
            background-color: #ecf5ff;
            color: var(--primary-color);
        }
        
        .tag-success {
            background-color: #f0f9eb;
            color: var(--success-color);
        }
        
        .tag-warning {
            background-color: #fdf6ec;
            color: var(--warning-color);
        }
        
        .tag-danger {
            background-color: #fef0f0;
            color: var(--danger-color);
        }

        /* ä»“åº“ç±»å‹æ ‡ç­¾æ ·å¼ */
        .tag.tag-department {
            background-color: #ecf5ff;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .tag.tag-channel {
            background-color: #f0f9eb;
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .tag.tag-stock {
            background-color: #fdf6ec;
            color: var(--warning-color);
            border: 1px solid var(--warning-color);
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(64, 158, 255, 0.2);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-col {
            flex: 1;
        }
        
        /* ç»„ç»‡æ¶æ„æ ‘ */
        .org-tree {
            margin-top: 15px;
            position: relative;
        }

        /* è§†å›¾åˆ‡æ¢æŒ‰é’® */
        .view-toggle-btn {
            border-radius: 4px;
            transition: var(--transition);
        }

        .view-toggle-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .view-container {
            animation: fadeIn 0.3s ease-out;
        }

        .company-group {
            position: relative;
            margin-bottom: 20px;
        }

        .org-node {
            padding: 12px 15px;
            border-radius: 4px;
            margin-bottom: 8px;
            background-color: #f8f9fc;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            position: relative;
        }

        .org-node:hover {
            background-color: #edf2ff;
        }

        .org-node.company {
            background-color: #eef5ff;
            border-left: 4px solid var(--primary-color);
            font-weight: bold;
            cursor: pointer;
            user-select: none;
        }

        .org-node.company .node-header {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .org-node.company .expand-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            transition: transform 0.3s ease;
            font-size: 14px;
        }

        .org-node.company.collapsed .expand-icon {
            transform: rotate(-90deg);
        }

        .org-node.company .dept-count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-color);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
            font-weight: normal;
        }

        /* éƒ¨é—¨å®¹å™¨ - ç”¨äºåŒ…è£¹æ‰€æœ‰éƒ¨é—¨èŠ‚ç‚¹ */
        .department-container {
            position: relative;
            margin-left: 30px;
            padding-left: 20px;
        }

        /* å‚ç›´è¿æ¥çº¿ - ä»å…¬å¸åˆ°æ‰€æœ‰éƒ¨é—¨ */
        .department-container::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 8px;
            width: 2px;
            background-color: #d0d7de;
        }

        .org-node.department {
            padding-left: 15px;
            background-color: #f8f9fc;
            border-left: 3px solid var(--secondary-color);
            position: relative;
            overflow: hidden;
            max-height: 500px;
            opacity: 1;
            transition: max-height 0.3s ease, opacity 0.3s ease, margin 0.3s ease;
            margin-left: 0;
        }

        .org-node.department.collapsed {
            max-height: 0;
            opacity: 0;
            margin-bottom: 0;
            padding-top: 0;
            padding-bottom: 0;
        }

        /* æ°´å¹³è¿æ¥çº¿ - ä»å‚ç›´çº¿åˆ°æ¯ä¸ªéƒ¨é—¨ */
        .org-node.department::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 50%;
            width: 20px;
            height: 2px;
            background-color: #d0d7de;
        }

        /* æœ€åä¸€ä¸ªéƒ¨é—¨çš„ç‰¹æ®Šå¤„ç† */
        .org-node.department:last-child::after {
            content: '';
            position: absolute;
            left: -22px;
            top: 50%;
            bottom: -8px;
            width: 2px;
            background-color: #f8f9fc;
        }

        .node-actions {
            display: flex;
            gap: 5px;
        }
        
        .node-actions .btn {
            margin: 0;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        /* è™šæ‹Ÿä»“å¡ç‰‡ */
        .warehouse-card {
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            background-color: #f9fbfd;
            transition: var(--transition);
        }

        .warehouse-card.active {
            border-color: var(--primary-color);
            background-color: #ecf5ff;
            box-shadow: 0 4px 12px rgba(64, 158, 255, 0.15);
        }

        /* è™šæ‹Ÿä»“æ ‘å½¢ç»“æ„ */
        .warehouse-tree-group {
            position: relative;
            margin-bottom: 30px;
        }

        .warehouse-main {
            position: relative;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .warehouse-main:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .warehouse-main-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .warehouse-main-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 600;
        }

        .warehouse-expand-icon {
            font-size: 14px;
            transition: transform 0.3s ease;
            color: rgba(255, 255, 255, 0.8);
        }

        .warehouse-expand-icon.expanded {
            transform: rotate(90deg);
        }

        .warehouse-dept-count {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .warehouse-departments-container {
            position: relative;
            margin-left: 30px;
            padding-left: 20px;
            margin-top: 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .warehouse-departments-container.expanded {
            max-height: 5000px;
        }

        .warehouse-departments-container::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 20px;
            width: 2px;
            background-color: #d0d7de;
        }

        .warehouse-dept-group {
            position: relative;
            margin-bottom: 20px;
        }

        .warehouse-dept-header {
            position: relative;
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background-color: #f0f4f8;
            border-radius: 6px;
            border-left: 3px solid var(--primary-color);
            margin-bottom: 12px;
        }

        .warehouse-dept-header::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 50%;
            width: 20px;
            height: 2px;
            background-color: #d0d7de;
        }

        .warehouse-dept-name {
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .warehouse-sub-item {
            position: relative;
            margin-left: 20px;
            padding-left: 20px;
            margin-bottom: 12px;
        }

        .warehouse-sub-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 20px;
            height: 2px;
            background-color: #d0d7de;
        }

        .warehouse-sub-card {
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            background-color: white;
            transition: var(--transition);
        }

        .warehouse-sub-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }
        
        .warehouse-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .warehouse-icon {
            font-size: 24px;
            color: var(--primary-color);
            margin-right: 12px;
        }
        
        .warehouse-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .warehouse-detail {
            display: flex;
            margin-bottom: 8px;
        }
        
        .detail-label {
            width: 100px;
            font-weight: 500;
            color: var(--text-light);
        }
        
        .inventory-count {
            font-size: 20px;
            font-weight: bold;
            color: var(--success-color);
        }
        
        .no-binding {
            color: var(--warning-color);
            font-style: italic;
        }
        
        /* å•é€‰æŒ‰é’®ç»„ */
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .radio-btn {
            padding: 10px 18px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--card-bg);
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }
        
        .radio-btn:hover {
            border-color: var(--primary-color);
        }
        
        .radio-btn.active {
            background-color: #ecf5ff;
            border-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
            box-shadow: 0 0 0 2px rgba(64, 158, 255, 0.2);
        }
        
        /* æ­¥éª¤æ¡ */
        .steps {
            display: flex;
            margin-bottom: 30px;
            position: relative;
        }
        
        .steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--border-color);
            z-index: 1;
        }
        
        .step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 2;
            padding-top: 30px;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--border-color);
            color: #909399;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            position: relative;
            z-index: 2;
            transition: var(--transition);
        }
        
        .step.active .step-number {
            background-color: var(--primary-color);
            color: white;
        }
        
        .step.completed .step-number {
            background-color: var(--success-color);
            color: white;
        }
        
        .step-title {
            font-weight: 500;
            font-size: 14px;
        }
        
        .step.active .step-title {
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .step.completed .step-title {
            color: var(--success-color);
            font-weight: bold;
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: var(--card-bg);
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            animation: modalOpen 0.3s ease-out;
        }
        
        @keyframes modalOpen {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            background-color: #f0f0f0;
            color: var(--danger-color);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .modal-footer {
            padding: 15px 25px;
            border-top: 1px solid var(--border-color);
            text-align: right;
        }
        
        /* æç¤ºä¿¡æ¯ */
        .alert {
            padding: 12px 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .alert-info {
            background-color: #f4f8ff;
            border-left: 4px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .alert-success {
            background-color: #f0f9eb;
            border-left: 4px solid var(--success-color);
            color: var(--success-color);
        }
        
        .alert-warning {
            background-color: #fdf6ec;
            border-left: 4px solid var(--warning-color);
            color: var(--warning-color);
        }
        
        .alert i {
            margin-right: 10px;
            font-size: 18px;
        }
        
        /* é¡µé¢å†…å®¹åŒºåŸŸ */
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* äº§å“åˆ—è¡¨ */
        .product-list {
            margin-top: 25px;
        }
        
        .product-item {
            display: flex;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
        }
        
        .product-info {
            flex: 1;
        }
        
        .product-sku {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .product-name {
            color: var(--text-light);
            font-size: 14px;
        }
        
        .product-quantity {
            font-weight: bold;
            margin: 0 15px;
            min-width: 60px;
            text-align: center;
        }
        
        /* æˆåŠŸé¡µé¢ */
        .success-page {
            text-align: center;
            padding: 40px 20px;
        }
        
        .success-icon {
            font-size: 80px;
            color: var(--success-color);
            margin-bottom: 20px;
        }
        
        .success-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--success-color);
        }
        
        .success-subtitle {
            font-size: 18px;
            color: var(--text-light);
            margin-bottom: 30px;
        }
        
        .order-details {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 25px;
            max-width: 500px;
            margin: 0 auto 30px;
            box-shadow: var(--shadow);
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .detail-row:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 16px;
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }
        
        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--text-color);
        }
        
        /* é¡µè„š */
        .app-footer {
            text-align: center;
            padding: 20px;
            color: var(--text-light);
            font-size: 14px;
            margin-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        /* Toastæç¤º */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            min-width: 300px;
            padding: 16px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            animation: slideIn 0.3s ease-out;
            transition: all 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .toast.hide {
            animation: slideOut 0.3s ease-in forwards;
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
        
        .toast-success {
            background-color: #f0f9eb;
            border-left: 4px solid var(--success-color);
            color: var(--success-color);
        }
        
        .toast-error {
            background-color: #fef0f0;
            border-left: 4px solid var(--danger-color);
            color: var(--danger-color);
        }
        
        .toast-warning {
            background-color: #fdf6ec;
            border-left: 4px solid var(--warning-color);
            color: var(--warning-color);
        }
        
        .toast-info {
            background-color: #f4f8ff;
            border-left: 4px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .toast-icon {
            font-size: 20px;
            margin-right: 12px;
        }
        
        .toast-message {
            flex: 1;
            font-size: 14px;
        }
        
        .toast-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: currentColor;
            margin-left: 10px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .toast-close:hover {
            opacity: 1;
        }
        
        /* åŠ è½½é®ç½© */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 2500;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* æŒ‰é’®ç‚¹å‡»æ•ˆæœ */
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* é¡µé¢å†…å®¹åˆ‡æ¢åŠ¨ç”» */
        .page-content {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        .page-content.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        /* æ­¥éª¤å†…å®¹åˆ‡æ¢åŠ¨ç”» */
        .step-content {
            transition: opacity 0.3s ease;
        }
        
        .step-content.fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        
        /* è¾“å…¥æ¡†èšç„¦åŠ¨ç”» */
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(64, 158, 255, 0.1);
            animation: pulse 0.3s ease-out;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(64, 158, 255, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(64, 158, 255, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(64, 158, 255, 0);
            }
        }
        
        /* è¡¨å•éªŒè¯æ ·å¼ */
        .form-group.has-error .form-control {
            border-color: var(--danger-color);
            background-color: #fef0f0;
        }
        
        .error-message {
            color: var(--danger-color);
            font-size: 12px;
            margin-top: 5px;
            display: none;
            animation: shake 0.3s ease-out;
        }
        
        .form-group.has-error .error-message {
            display: block;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* æ‚¬åœæ•ˆæœå¢å¼º */
        .card:hover {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
        }
        
        .warehouse-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .product-item:hover {
            background-color: #f8f9fc;
        }
        
        /* æˆåŠŸåŠ¨ç”» */
        .success-checkmark {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: var(--success-color);
            stroke-miterlimit: 10;
            margin: 0 auto 20px;
            animation: scaleIn 0.3s ease-out;
        }
        
        @keyframes scaleIn {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }
        
        /* ä¼˜åŒ–çš„å•é€‰æŒ‰é’® */
        .radio-btn {
            padding: 12px 20px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--card-bg);
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .radio-btn:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(64, 158, 255, 0.1);
        }
        
        .radio-btn.active {
            background-color: #ecf5ff;
            border-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
            box-shadow: 0 0 0 3px rgba(64, 158, 255, 0.2);
        }
        
        .radio-btn::before {
            content: 'â—‹';
            font-size: 16px;
            opacity: 0.5;
        }
        
        .radio-btn.active::before {
            content: 'â—';
            opacity: 1;
        }
        
        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 992px) {
            .toast-container {
                top: 70px;
                right: 10px;
                left: 10px;
            }
            
            .toast {
                min-width: auto;
                width: 100%;
            }
        }
        
        /* æœç´¢æ¡†æ ·å¼ä¼˜åŒ– */
        .search-input {
            position: relative;
        }
        
        .search-input::after {
            content: 'ğŸ”';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.5;
            font-size: 14px;
        }
        
        /* å¡ç‰‡æ‚¬åœæ•ˆæœ */
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        /* å·¥å…·æç¤º */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-5px);
            background-color: #303133;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-10px);
        }
        
        /* è¿›åº¦æ¡åŠ¨ç”» */
        .progress-bar {
            height: 4px;
            background-color: #e4e7ed;
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 2px;
            transition: width 0.6s ease;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="app-header">
            <div class="logo">
                <span class="logo-icon">ğŸ“¦</span>
                <span>ELSA</span>
            </div>
            <div class="user-info">
                <div class="avatar">A</div>
                <span>ç®¡ç†å‘˜</span>
            </div>
        </header>
        
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <ul class="menu">
                <li class="menu-item active" data-page="org">
                    <span>ğŸ¢</span>
                    <span>ç»„ç»‡æ¶æ„ç®¡ç†</span>
                </li>
                <li class="menu-item" data-page="transfer">
                    <span>ğŸ”„</span>
                    <span>åº“å­˜è°ƒæ‹¨</span>
                </li>
                <li class="menu-item" data-page="lock">
                    <span>ğŸ”’</span>
                    <span>åº“å­˜é”å®š</span>
                </li>
                <li class="menu-item" data-page="outbound">
                    <span>ğŸ“¤</span>
                    <span>åˆ›å»ºå‡ºåº“å•</span>
                </li>
            </ul>
        </aside>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- é¡µé¢1: ç»„ç»‡æ¶æ„ä¸è™šæ‹Ÿä»“ç®¡ç† -->
            <div class="page-content active" id="page-org">
                <div class="card">
                    <div class="card-header">
                        <span>ç»„ç»‡æ¶æ„ä¸è™šæ‹Ÿä»“ç®¡ç†</span>
                        <div style="display: flex; gap: 10px;">
                            <div style="display: flex; gap: 5px; border: 1px solid var(--border-color); border-radius: 4px; padding: 2px;">
                                <button class="btn btn-sm view-toggle-btn active" data-view="org" onclick="switchOrgView('org')" style="border: none; background: transparent;">
                                    <span>ğŸ¢</span>
                                    <span>ç»„ç»‡æ¶æ„</span>
                                </button>
                                <button class="btn btn-sm view-toggle-btn" data-view="warehouse" onclick="switchOrgView('warehouse')" style="border: none; background: transparent;">
                                    <span>ğŸ“¦</span>
                                    <span>è™šæ‹Ÿä»“</span>
                                </button>
                            </div>
                            <input type="text" class="form-control" id="orgSearch" placeholder="æœç´¢..." style="width: 200px;" oninput="filterCurrentView()">
                            <button class="btn btn-primary" onclick="openAddModal()" id="addBtn">
                                <span>+</span>
                                <span>æ·»åŠ </span>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- ç»„ç»‡æ¶æ„è§†å›¾ -->
                        <div id="orgTreeView" class="view-container"></div>
                        <!-- è™šæ‹Ÿä»“è§†å›¾ -->
                        <div id="warehouseTreeView" class="view-container" style="display: none;"></div>
                    </div>
                </div>
            </div>


            <!-- é¡µé¢3: åº“å­˜è°ƒæ‹¨ -->
            <div class="page-content" id="page-transfer">               
                <div class="card">
                    <div class="card-header">
                        <span>è°ƒæ‹¨è®°å½•</span>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" class="form-control" id="transferSearch" placeholder="æœç´¢è°ƒæ‹¨è®°å½•..." style="width: 200px;" oninput="filterTransfers()">
                            <button class="btn btn-success" onclick="openAddTransferModal()">
                                <span>+</span>
                                <span>æ–°å¢è°ƒæ‹¨</span>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="transferList"></div>
                    </div>
                </div>
            </div>


            <!-- é¡µé¢5: åº“å­˜é”å®šç®¡ç† -->
            <div class="page-content" id="page-outbound">
                <div class="card">
                    <div class="card-header">
                        <span>å‡ºåº“å•åˆ—è¡¨</span>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" class="form-control" id="outboundOrderSearch" placeholder="æœç´¢å‡ºåº“å•..." style="width: 250px;" onkeyup="filterOutboundOrders()">
                            <button class="btn btn-primary" onclick="openCreateOutboundModal()">
                                <span>+</span>
                                <span>åˆ›å»ºå‡ºåº“å•</span>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="outboundOrderList"></div>
                    </div>
                </div>
            </div>

            <!-- é¡µé¢5: åº“å­˜é”å®šç®¡ç† -->
            <div class="page-content" id="page-lock">               
                <div class="card">
                    <div class="card-header">
                        <span>é”å®šè®°å½•</span>
                        <button class="btn btn-primary" onclick="openCreateLockModal()">
                            <span>+</span>
                            <span>æ–°å»ºé”å®š</span>
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="lockList"></div>
                    </div>
                </div>
            </div>
            
            <!-- æ¨¡æ€æ¡† - æ·»åŠ å…¬å¸ -->
            <div class="modal" id="addCompanyModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">æ·»åŠ å…¬å¸</div>
                        <button class="close-modal" onclick="closeModal('addCompanyModal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">å…¬å¸åç§°</label>
                            <input type="text" class="form-control" id="companyName" placeholder="è¯·è¾“å…¥å…¬å¸åç§°">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å…¬å¸ä»£ç </label>
                            <input type="text" class="form-control" id="companyCode" placeholder="è¯·è¾“å…¥å…¬å¸ä»£ç ">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" onclick="closeModal('addCompanyModal')">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="addCompany()">ç¡®è®¤æ·»åŠ </button>
                    </div>
                </div>
            </div>
            
            <!-- æ¨¡æ€æ¡† - æ·»åŠ éƒ¨é—¨ -->
            <div class="modal" id="addDepartmentModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">æ·»åŠ éƒ¨é—¨</div>
                        <button class="close-modal" onclick="closeModal('addDepartmentModal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="departmentCompanyId">
                        <div class="form-group">
                            <label class="form-label">æ‰€å±å…¬å¸</label>
                            <input type="text" class="form-control" id="departmentCompanyName" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">éƒ¨é—¨åç§°</label>
                            <input type="text" class="form-control" id="departmentName" placeholder="è¯·è¾“å…¥éƒ¨é—¨åç§°">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" onclick="closeModal('addDepartmentModal')">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="addDepartment()">ç¡®è®¤æ·»åŠ </button>
                    </div>
                </div>
            </div>

            <!-- æ¨¡æ€æ¡† - ç¼–è¾‘éƒ¨é—¨ -->
            <div class="modal" id="editDepartmentModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">ç¼–è¾‘éƒ¨é—¨</div>
                        <button class="close-modal" onclick="closeModal('editDepartmentModal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="editDepartmentCompanyId">
                        <input type="hidden" id="editDepartmentId">
                        <div class="form-group">
                            <label class="form-label">æ‰€å±å…¬å¸</label>
                            <input type="text" class="form-control" id="editDepartmentCompanyName" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">éƒ¨é—¨åç§°</label>
                            <input type="text" class="form-control" id="editDepartmentName" placeholder="è¯·è¾“å…¥éƒ¨é—¨åç§°">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" onclick="closeModal('editDepartmentModal')">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="editDepartment()">ç¡®è®¤ä¿®æ”¹</button>
                    </div>
                </div>
            </div>

            <!-- æ¨¡æ€æ¡† - æ–°å¢è™šæ‹Ÿä»“ -->
            <div class="modal" id="addWarehouseModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">æ–°å¢è™šæ‹Ÿä»“</div>
                        <button class="close-modal" onclick="closeModal('addWarehouseModal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">è™šæ‹Ÿä»“åç§° <span style="color: var(--danger-color);">*</span></label>
                            <input type="text" class="form-control" id="warehouseNameModal" placeholder="è¯·è¾“å…¥è™šæ‹Ÿä»“åç§°">
                        </div>

                        <div class="form-group">
                            <label class="form-label">è™šæ‹Ÿä»“ç±»å‹ <span style="color: var(--danger-color);">*</span></label>
                            <div class="radio-group" id="warehouseTypeOptions">
                                <div class="radio-btn active" data-type="department">ğŸ“‹ è™šæ‹Ÿä»“</div>
                                <div class="radio-btn" data-type="channel">ğŸ›’ æ¸ é“ä»“</div>
                                <div class="radio-btn" data-type="stock">ğŸ“¦ å¤‡è´§ä»“</div>
                            </div>
                        </div>

                        <!-- è™šæ‹Ÿä»“å…³è”å­—æ®µ -->
                        <div class="form-row" id="departmentFieldsModal">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">é€‰æ‹©å…¬å¸ <span style="color: var(--danger-color);">*</span></label>
                                    <select class="form-control" id="warehouseCompanyModal" onchange="loadDepartmentsModal()">
                                        <option value="">è¯·é€‰æ‹©å…¬å¸</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">é€‰æ‹©éƒ¨é—¨ <span style="color: var(--danger-color);">*</span></label>
                                    <select class="form-control" id="warehouseDepartmentModal">
                                        <option value="">è¯·é€‰æ‹©éƒ¨é—¨</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- æ¸ é“ä»“å…³è”å­—æ®µ -->
                        <div class="form-group" id="channelFieldModal" style="display: none;">
                            <label class="form-label">é€‰æ‹©æ¸ é“ <span style="color: var(--danger-color);">*</span></label>
                            <div class="radio-group" id="channelOptionsModal">
                                <div class="radio-btn" data-channel="Amazon">Amazon</div>
                                <div class="radio-btn" data-channel="eBay">eBay</div>
                                <div class="radio-btn" data-channel="Shopify">Shopify</div>
                                <div class="radio-btn" data-channel="Walmart">Walmart</div>
                                <div class="radio-btn" data-channel="ç‹¬ç«‹ç«™">ç‹¬ç«‹ç«™</div>
                                <div class="radio-btn" data-channel="å…¶ä»–">å…¶ä»–</div>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <span>â„¹ï¸</span>
                            <span id="warehouseTypeHint">è™šæ‹Ÿä»“éœ€è¦å…³è”ä¸€ä¸ªéƒ¨é—¨ï¼Œç”¨äºéƒ¨é—¨ä¸“å±åº“å­˜ç®¡ç†</span>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" onclick="closeModal('addWarehouseModal')">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="createWarehouseFromModal()">ç¡®è®¤åˆ›å»º</button>
                    </div>
                </div>
            </div>

            <!-- æ¨¡æ€æ¡† - ç¼–è¾‘è™šæ‹Ÿä»“ -->
            <div class="modal" id="editWarehouseModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">ç¼–è¾‘è™šæ‹Ÿä»“</div>
                        <button class="close-modal" onclick="closeModal('editWarehouseModal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="editWarehouseId">
                        <div class="form-group">
                            <label class="form-label">æ‰€å±å…¬å¸</label>
                            <input type="text" class="form-control" id="editWarehouseCompanyName" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ‰€å±éƒ¨é—¨</label>
                            <input type="text" class="form-control" id="editWarehouseDepartmentName" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">è™šæ‹Ÿä»“åç§°</label>
                            <input type="text" class="form-control" id="editWarehouseName" placeholder="è¯·è¾“å…¥è™šæ‹Ÿä»“åç§°">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ç»‘å®šæ¸ é“</label>
                            <input type="text" class="form-control" id="editWarehouseChannel" readonly>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" onclick="closeModal('editWarehouseModal')">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="editWarehouse()">ç¡®è®¤ä¿®æ”¹</button>
                    </div>
                </div>
            </div>

            <!-- æ¨¡æ€æ¡† - æ–°å¢è°ƒæ‹¨ -->
            <div class="modal" id="addTransferModal">
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <div class="modal-title">æ–°å¢è°ƒæ‹¨å•</div>
                        <button class="close-modal" onclick="closeModal('addTransferModal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <!-- è°ƒæ‹¨ä¿¡æ¯åŒºåŸŸ -->
                        <div style="background: #f8f9fc; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                            <h4 style="margin: 0 0 15px; font-size: 16px; color: var(--text-color);">
                                <span style="color: var(--primary-color); margin-right: 5px;">ğŸ“‹</span>
                                è°ƒæ‹¨ä¿¡æ¯
                            </h4>
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="form-label">è°ƒæ‹¨ä»“</label>
                                        <select class="form-control" id="transferFromWarehouseModal" onchange="loadTransferProductSKUs()">
                                            <option value="">è¯·é€‰æ‹©è°ƒæ‹¨ä»“</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="form-label">è°ƒå…¥ä»“</label>
                                        <select class="form-control" id="transferToWarehouseModal">
                                            <option value="">è¯·é€‰æ‹©è°ƒå…¥ä»“</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">è°ƒæ‹¨åŸå› </label>
                                <input type="text" class="form-control" id="transferReasonModal" placeholder="è¯·è¾“å…¥è°ƒæ‹¨åŸå› ï¼ˆå¯é€‰ï¼‰">
                            </div>
                        </div>

                        <!-- äº§å“ä¿¡æ¯åŒºåŸŸ -->
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin: 0 0 15px; font-size: 16px; color: var(--text-color); display: flex; justify-content: space-between; align-items: center;">
                                <span>
                                    <span style="color: var(--primary-color); margin-right: 5px;">ğŸ“¦</span>
                                    äº§å“åˆ—è¡¨
                                </span>
                                <span style="font-size: 14px; color: var(--text-light);">æ€»è®¡: <strong id="transferTotalCount" style="color: var(--primary-color); font-size: 16px;">0</strong> ä»¶</span>
                            </h4>
                            <div style="overflow-x: auto;">
                                <table class="table" id="transferProductTable">
                                    <thead>
                                        <tr>
                                            <th style="width: 30%;">SKU</th>
                                            <th style="width: 20%;">å•†å“åç§°</th>
                                            <th style="width: 15%;">å¯ç”¨åº“å­˜</th>
                                            <th style="width: 20%;">è°ƒæ‹¨æ•°é‡</th>
                                            <th style="width: 15%;">æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="transferProductTableBody">
                                        <tr>
                                            <td colspan="5" style="text-align: center; padding: 30px; color: var(--text-light);">
                                                è¯·å…ˆé€‰æ‹©è°ƒæ‹¨ä»“ï¼Œç„¶åæ·»åŠ äº§å“
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div style="margin-top: 15px; text-align: right;">
                                <button class="btn btn-primary" onclick="addTransferProductRow()">
                                    <span>+</span>
                                    <span>æ·»åŠ äº§å“</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" onclick="closeModal('addTransferModal')">å–æ¶ˆ</button>
                        <button class="btn btn-success" onclick="createTransferFromModal()">æ‰§è¡Œè°ƒæ‹¨</button>
                    </div>
                </div>
            </div>
            
            <!-- æ¨¡æ€æ¡† - åˆ›å»ºå‡ºåº“å• -->
            <div class="modal" id="createOutboundModal">
                <div class="modal-content" style="max-width: 950px;">
                    <div class="modal-header">
                        <div class="modal-title">åˆ›å»ºå‡ºåº“å•</div>
                        <button class="close-modal" onclick="closeModal('createOutboundModal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <!-- ä¸Šå¡ç‰‡ï¼šåŸºç¡€ä¿¡æ¯ -->
                        <div style="background: linear-gradient(to bottom, #ffffff, #fafbfc); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);">
                            <h4 style="margin: 0 0 20px; font-size: 17px; font-weight: 600; color: var(--primary-color); display: flex; align-items: center;">
                                <span style="margin-right: 8px;">ğŸ“‹</span>
                                åŸºç¡€ä¿¡æ¯
                            </h4>
                            <div class="form-row" style="gap: 20px; margin-bottom: 20px;">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="form-label">å‘è´§ä»“ç±»å‹ <span style="color: var(--danger-color);">*</span></label>
                                        <select class="form-control" id="outboundWarehouseType" onchange="handleWarehouseTypeChange()" style="padding: 10px 14px; border-radius: 8px; border: 2px solid #e5e7eb; transition: all 0.3s;">
                                            <option value="">è¯·é€‰æ‹©å‘è´§ä»“ç±»å‹</option>
                                            <option value="channel">ğŸ›’ æ¸ é“ä»“</option>
                                            <option value="department">ğŸ“‹ è™šæ‹Ÿä»“</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- æ¸ é“ä»“é€‰æ‹©åŒºåŸŸ -->
                            <div id="channelWarehouseArea" style="display: none;">
                                <div class="form-row" style="gap: 20px; margin-bottom: 20px;">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label">é€‰æ‹©æ¸ é“ä»“ <span style="color: var(--danger-color);">*</span></label>
                                            <select class="form-control" id="outboundChannelWarehouseSelect" onchange="handleFinalWarehouseChange()" style="padding: 10px 14px; border-radius: 8px; border: 2px solid #e5e7eb; transition: all 0.3s;">
                                                <option value="">è¯·é€‰æ‹©æ¸ é“ä»“</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- è™šæ‹Ÿä»“é€‰æ‹©åŒºåŸŸ -->
                            <div id="departmentWarehouseArea" style="display: none;">
                                <div class="form-row" style="gap: 20px; margin-bottom: 20px;">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label class="form-label">é€‰æ‹©è™šæ‹Ÿä»“ <span style="color: var(--danger-color);">*</span></label>
                                            <select class="form-control" id="outboundDepartmentWarehouseSelect" onchange="handleFinalWarehouseChange()" style="padding: 10px 14px; border-radius: 8px; border: 2px solid #e5e7eb; transition: all 0.3s;">
                                                <option value="">è¯·é€‰æ‹©è™šæ‹Ÿä»“</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ä¸‹å¡ç‰‡ï¼šäº§å“ä¿¡æ¯åˆ—è¡¨ -->
                        <div style="background: linear-gradient(to bottom, #ffffff, #fafbfc); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);">
                            <h4 style="margin: 0 0 20px; font-size: 17px; font-weight: 600; color: var(--primary-color); display: flex; justify-content: space-between; align-items: center;">
                                <span style="display: flex; align-items: center;">
                                    <span style="margin-right: 8px;">ğŸ“¦</span>
                                    äº§å“ä¿¡æ¯åˆ—è¡¨
                                </span>
                                <span style="font-size: 14px; color: var(--text-light); background: #f0f5ff; padding: 6px 14px; border-radius: 20px;">
                                    æ€»è®¡: <strong id="outboundTotalCount" style="color: var(--primary-color); font-size: 16px; margin-left: 5px;">0</strong> ä»¶
                                </span>
                            </h4>
                            <div style="overflow-x: auto; border-radius: 8px; border: 1px solid #e5e7eb;">
                                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                    <thead>
                                        <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #ffffff; width: 24%;">SKU</th>
                                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #ffffff; width: 24%;">å•†å“åç§°</th>
                                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #ffffff; width: 14%;">å‡ºåº“æ•°é‡</th>
                                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #ffffff; width: 14%;">å¯ç”¨åº“å­˜</th>
                                            <th style="padding: 14px 16px; text-align: left; font-weight: 600; color: #ffffff; width: 19%;">å¤‡æ³¨</th>
                                            <th style="padding: 14px 16px; text-align: center; font-weight: 600; color: #ffffff; width: 5%;">æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="outboundTableBody">
                                        <tr id="outboundEmptyRow">
                                            <td colspan="6" style="padding: 50px; text-align: center; color: var(--text-light); background: #fafbfc;">
                                                <div style="font-size: 48px; margin-bottom: 12px;">ğŸ“¦</div>
                                                <div style="font-size: 15px;">æš‚æ— äº§å“ä¿¡æ¯ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div style="margin-top: 20px; text-align: right;">
                                <button class="btn btn-success" onclick="addOutboundRow()" style="padding: 10px 20px; border-radius: 8px; font-size: 14px; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);">
                                    <span>+</span>
                                    <span>æ·»åŠ ä¸€è¡Œ</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="padding: 20px 25px; border-top: 1px solid var(--border-color);">
                        <button class="btn" onclick="closeModal('createOutboundModal')" style="padding: 10px 24px; border-radius: 8px; border: 2px solid var(--border-color); background: #ffffff; color: var(--text-color);">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="submitOutboundOrderFromModal()" style="padding: 10px 24px; border-radius: 8px; background: var(--primary-color); color: white; border: none; box-shadow: 0 2px 8px rgba(42, 59, 125, 0.3);">æäº¤å‡ºåº“å•</button>
                    </div>
                </div>
            </div>
            
            <!-- æ¨¡æ€æ¡† - å‡ºåº“å•åˆ›å»ºæˆåŠŸ -->
            <div class="modal" id="successModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">å‡ºåº“å•åˆ›å»ºæˆåŠŸ</div>
                        <button class="close-modal" onclick="closeModal('successModal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="success-page">
                            <div class="success-icon">âœ“</div>
                            <div class="success-title">å‡ºåº“å•å·²æˆåŠŸåˆ›å»º</div>
                            <div class="success-subtitle">ç³»ç»Ÿå·²è‡ªåŠ¨ä»åŒ¹é…çš„è™šæ‹Ÿä»“æ‰£å‡åº“å­˜</div>
                            
                            <div class="order-details">
                                <div class="detail-row">
                                    <span>å‡ºåº“å•å·</span>
                                    <span><strong id="outboundOrderId"></strong></span>
                                </div>
                                <div class="detail-row">
                                    <span>è™šæ‹Ÿä»“</span>
                                    <span id="outboundWarehouseName"></span>
                                </div>
                                <div class="detail-row">
                                    <span>å‡ºåº“éƒ¨é—¨</span>
                                    <span id="outboundDepartmentName"></span>
                                </div>
                                <div class="detail-row">
                                    <span>é”€å”®æ¸ é“</span>
                                    <span id="outboundChannelName"></span>
                                </div>
                                <div class="detail-row">
                                    <span>å•†å“æ€»æ•°</span>
                                    <span id="outboundProductCount"></span>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <button class="btn btn-primary" style="padding: 12px 35px; font-size: 16px;" onclick="closeModal('successModal'); openCreateOutboundModal();">
                                    åˆ›å»ºæ–°è®¢å•
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ¨¡æ€æ¡† - åº“å­˜è¯¦æƒ… -->
            <div class="modal" id="inventoryDetailModal">
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <div class="modal-title">åº“å­˜è¯¦æƒ…</div>
                        <button class="close-modal" onclick="closeModal('inventoryDetailModal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; padding: 20px; margin-bottom: 20px; color: white;">
                            <h3 style="margin: 0 0 10px; font-size: 18px;" id="inventoryDetailWarehouseName"></h3>
                            <div style="display: flex; gap: 30px; margin-top: 15px;">
                                <div>
                                    <div style="font-size: 13px; opacity: 0.9;">SKUæ•°é‡</div>
                                    <div style="font-size: 24px; font-weight: bold; margin-top: 5px;" id="inventoryDetailSKUCount">0</div>
                                </div>
                                <div>
                                    <div style="font-size: 13px; opacity: 0.9;">å¯ç”¨åº“å­˜æ€»é‡</div>
                                    <div style="font-size: 24px; font-weight: bold; margin-top: 5px;" id="inventoryDetailTotalStock">0</div>
                                </div>
                                <div>
                                    <div style="font-size: 13px; opacity: 0.9;">é”å®šåº“å­˜æ€»é‡</div>
                                    <div style="font-size: 24px; font-weight: bold; margin-top: 5px;" id="inventoryDetailLockedStock">0</div>
                                </div>
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <input type="text" class="form-control" id="inventoryDetailSearch" placeholder="æœç´¢SKU..." oninput="filterInventoryDetail()">
                        </div>

                        <div style="max-height: 400px; overflow-y: auto;">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th style="width: 30%;">SKU</th>
                                        <th style="width: 25%;">å¯ç”¨åº“å­˜</th>
                                        <th style="width: 25%;">é”å®šåº“å­˜</th>
                                        <th style="width: 20%;">æ€»åº“å­˜</th>
                                    </tr>
                                </thead>
                                <tbody id="inventoryDetailTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" onclick="closeModal('inventoryDetailModal')">å…³é—­</button>
                    </div>
                </div>
            </div>
            
            <!-- æ¨¡æ€æ¡† - åˆ›å»ºåº“å­˜é”å®š -->
            <div class="modal" id="createLockModal">
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <div class="modal-title">åˆ›å»ºåº“å­˜é”å®š</div>
                        <button class="close-modal" onclick="closeModal('createLockModal')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <!-- ä¸Šå¡ç‰‡ï¼šåŸºç¡€ä¿¡æ¯ -->
                        <div style="background: #fff; border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                            <h4 style="margin: 0 0 20px; font-size: 16px; color: var(--text-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 10px;">
                                åŸºç¡€ä¿¡æ¯
                            </h4>
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="form-label">é€‰æ‹©è™šæ‹Ÿä»“</label>
                                        <select class="form-control" id="lockWarehouseSelect" onchange="handleLockWarehouseChange()">
                                            <option value="">è¯·é€‰æ‹©è™šæ‹Ÿä»“</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ä¸‹å¡ç‰‡ï¼šäº§å“ä¿¡æ¯åˆ—è¡¨ -->
                        <div style="background: #fff; border: 1px solid var(--border-color); border-radius: 8px; padding: 20px;">
                            <h4 style="margin: 0 0 20px; font-size: 16px; color: var(--text-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                                <span>äº§å“ä¿¡æ¯åˆ—è¡¨</span>
                                <span style="font-size: 14px; color: var(--text-light);">æ€»è®¡é”å®š: <strong id="lockTotalCount" style="color: var(--primary-color); font-size: 16px;">0</strong> ä»¶</span>
                            </h4>
                            <div style="overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                    <thead>
                                        <tr style="background: #f8f9fc; border-bottom: 2px solid var(--border-color);">
                                            <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-color); width: 25%;">SKU</th>
                                            <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-color); width: 15%;">é”å®šç±»å‹</th>
                                            <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-color); width: 12%;">é”å®šæ•°é‡</th>
                                            <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-color); width: 12%;">å¯ç”¨åº“å­˜</th>
                                            <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-color); width: 12%;">å·²é”å®š</th>
                                            <th style="padding: 12px; text-align: left; font-weight: 600; color: var(--text-color); width: 19%;">å¤‡æ³¨</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; color: var(--text-color); width: 5%;">æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lockTableBody">
                                        <tr id="lockEmptyRow">
                                            <td colspan="7" style="padding: 40px; text-align: center; color: var(--text-light);">
                                                <div style="font-size: 40px; margin-bottom: 10px;">ğŸ”’</div>
                                                <div>æš‚æ— é”å®šä¿¡æ¯ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div style="margin-top: 15px; text-align: right;">
                                <button class="btn btn-warning" onclick="addLockRow()">
                                    <span>+</span>
                                    <span>æ·»åŠ ä¸€è¡Œ</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" onclick="closeModal('createLockModal')">å–æ¶ˆ</button>
                        <button class="btn btn-warning" onclick="createLock()">åˆ›å»ºé”å®š</button>
                    </div>
                </div>
            </div>

            <div class="app-footer">
                <p>Â© 2024 ELSA. All rights reserved.</p>
            </div>
        </main>
        
        <!-- Toastå®¹å™¨ -->
        <div class="toast-container" id="toastContainer"></div>
        
        <!-- åŠ è½½é®ç½© -->
        <div class="loading-overlay" id="loadingOverlay" style="display: none;">
            <div class="loading-spinner"></div>
        </div>
        
        <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
        <button id="backToTop" class="btn btn-primary" style="position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; border-radius: 50%; padding: 0; display: none; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" onclick="scrollToTop()">
            <span style="font-size: 24px;">â†‘</span>
        </button>
    </div>
    
    <script>
        // å…¨å±€æ•°æ®å­˜å‚¨
        let data = {
            companies: [
                {
                    id: 1,
                    name: 'å®æ³¢å‘ç°ç‰©æµæœ‰é™å…¬å¸',
                    code: 'ABC001',
                    departments: [
                        { id: 1, name: 'éƒ¨é—¨1', warehouses: [] },
                        { id: 2, name: 'éƒ¨é—¨2', warehouses: [] },
                        { id: 3, name: 'éƒ¨é—¨3', warehouses: [] }
                    ]
                }
            ],
            warehouses: [],
            // SKUåº“å­˜æ˜ç»†ï¼škeyä¸º"warehouseId_sku"ï¼Œvalueä¸ºåº“å­˜æ•°é‡
            warehouseInventory: {},
            // SKUé”å®šåº“å­˜ï¼škeyä¸º"warehouseId_sku"ï¼Œvalueä¸ºé”å®šæ•°é‡
            warehouseLockedInventory: {},
            // åº“å­˜é”å®šè®°å½•
            locks: [],
            transfers: [],
            outboundProducts: [],
            // å‡ºåº“è®¢å•è®°å½•
            outboundOrders: []
        };

        // ç»„ç»‡æ ‘çŠ¶æ€ç®¡ç†
        let orgTreeState = {
            expandedCompanies: new Set() // å­˜å‚¨å±•å¼€çš„å…¬å¸ID
        };

        // è™šæ‹Ÿä»“æ ‘çŠ¶æ€ç®¡ç†
        let warehouseTreeState = {
            expandedCompanies: new Set() // å­˜å‚¨å±•å¼€çš„å…¬å¸ID
        };

        let currentStep = 1;
        let selectedDepartment = null;
        let selectedChannel = null;
        let matchedWarehouse = null;
        let selectedChannelValue = '';
        
        // Toastæç¤ºç³»ç»Ÿ
        function showToast(type, message, duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const icons = {
                success: 'âœ“',
                error: 'âœ—',
                warning: 'âš ',
                info: 'â„¹'
            };
            
            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <span class="toast-message">${message}</span>
                <button class="toast-close" onclick="this.parentElement.remove()">Ã—</button>
            `;
            
            container.appendChild(toast);
            
            // è‡ªåŠ¨å…³é—­
            if (duration > 0) {
                setTimeout(() => {
                    toast.classList.add('hide');
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }
        }
        
        // æ˜¾ç¤ºåŠ è½½é®ç½©
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        // éšè—åŠ è½½é®ç½©
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
        async function simulateAsync(operation, delay = 500) {
            showLoading();
            await new Promise(resolve => setTimeout(resolve, delay));
            const result = operation();
            hideLoading();
            return result;
        }
        
        // è¡¨å•éªŒè¯è¾…åŠ©å‡½æ•°
        function validateInput(inputElement, errorMessage) {
            const value = inputElement.value.trim();
            const formGroup = inputElement.closest('.form-group');
            
            if (!value) {
                formGroup.classList.add('has-error');
                if (!formGroup.querySelector('.error-message')) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'error-message';
                    errorDiv.textContent = errorMessage;
                    formGroup.appendChild(errorDiv);
                }
                return false;
            }
            
            formGroup.classList.remove('has-error');
            const errorMsg = formGroup.querySelector('.error-message');
            if (errorMsg) errorMsg.remove();
            return true;
        }
        
        // é¡µé¢åˆ‡æ¢
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function() {
                const page = this.getAttribute('data-page');
                switchPage(page);
            });
        });
        
        function switchPage(page) {
            // æ›´æ–°ä¾§è¾¹æ 
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === page) {
                    item.classList.add('active');
                }
            });
            
            // æ›´æ–°é¡µé¢å†…å®¹
            document.querySelectorAll('.page-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('page-' + page).classList.add('active');

            // åˆå§‹åŒ–é¡µé¢æ•°æ®
            if (page === 'org') {
                renderOrgTreeView();
            } else if (page === 'transfer') {
                initTransferPage();
            } else if (page === 'lock') {
                initLockPage();
            } else if (page === 'outbound') {
                initOutboundPage();
            }
        }

        // å½“å‰è§†å›¾çŠ¶æ€
        let currentOrgView = 'org'; // 'org' æˆ– 'warehouse'

        // åˆ‡æ¢ç»„ç»‡æ¶æ„è§†å›¾
        function switchOrgView(view) {
            currentOrgView = view;

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.view-toggle-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-view') === view) {
                    btn.classList.add('active');
                }
            });

            // æ›´æ–°æ·»åŠ æŒ‰é’®æ–‡æœ¬
            const addBtn = document.getElementById('addBtn');
            if (addBtn) {
                const span = addBtn.querySelector('span:nth-child(2)');
                if (span) {
                    span.textContent = view === 'org' ? 'æ·»åŠ ' : 'æ–°å¢è™šæ‹Ÿä»“';
                }
            }

            // æ›´æ–°æœç´¢æ¡†å ä½ç¬¦
            const searchInput = document.getElementById('orgSearch');
            if (searchInput) {
                searchInput.placeholder = view === 'org' ? 'æœç´¢ç»„ç»‡...' : 'æœç´¢è™šæ‹Ÿä»“...';
            }

            // åˆ‡æ¢è§†å›¾
            const orgTreeView = document.getElementById('orgTreeView');
            const warehouseTreeView = document.getElementById('warehouseTreeView');

            if (view === 'org') {
                orgTreeView.style.display = 'block';
                warehouseTreeView.style.display = 'none';
                renderOrgTreeView();
            } else {
                orgTreeView.style.display = 'none';
                warehouseTreeView.style.display = 'block';
                renderWarehouseTreeView();
            }
        }

        // æ¸²æŸ“å½“å‰è§†å›¾ï¼ˆç”¨äºæœç´¢è¿‡æ»¤ï¼‰
        function filterCurrentView() {
            if (currentOrgView === 'org') {
                renderOrgTreeView();
            } else {
                renderWarehouseTreeView();
            }
        }

        // æ‰“å¼€æ·»åŠ æ¨¡æ€æ¡†
        function openAddModal() {
            if (currentOrgView === 'org') {
                openAddCompanyModal();
            } else {
                openAddWarehouseModal();
            }
        }

        // æ¸²æŸ“ç»„ç»‡æ¶æ„è§†å›¾
        function renderOrgTreeView() {
            const container = document.getElementById('orgTreeView');
            const searchTerm = document.getElementById('orgSearch')?.value?.toLowerCase() || '';
            container.innerHTML = '';
            container.className = 'org-tree';

            const filteredCompanies = searchTerm
                ? data.companies.filter(c =>
                    c.name.toLowerCase().includes(searchTerm) ||
                    c.code.toLowerCase().includes(searchTerm) ||
                    c.departments.some(d => d.name.toLowerCase().includes(searchTerm))
                )
                : data.companies;

            if (filteredCompanies.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ¢</div>
                        <div class="empty-state-title">${data.companies.length === 0 ? 'æš‚æ— ç»„ç»‡æ¶æ„' : 'æœªæ‰¾åˆ°åŒ¹é…çš„ç»„ç»‡'}</div>
                        <div>${data.companies.length === 0 ? 'ç‚¹å‡»ä¸Šæ–¹"æ·»åŠ "æŒ‰é’®å¼€å§‹åˆ›å»º' : 'è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯'}</div>
                    </div>
                `;
                return;
            }

            filteredCompanies.forEach(company => {
                const isExpanded = searchTerm ? true : orgTreeState.expandedCompanies.has(company.id);
                const deptCount = company.departments.length;

                const companyGroup = document.createElement('div');
                companyGroup.className = 'company-group';

                const companyNode = document.createElement('div');
                companyNode.className = `org-node company ${isExpanded ? '' : 'collapsed'}`;
                companyNode.innerHTML = `
                    <div class="node-header" onclick="toggleCompany(${company.id})">
                        <span class="expand-icon">${deptCount > 0 ? 'â–¼' : ''}</span>
                        <span>ğŸ¢</span>
                        <span>${company.name}</span>
                        <span style="margin-left: 10px; color: var(--text-light); font-size: 14px;">(${company.code})</span>
                        ${deptCount > 0 ? `<span class="dept-count">${deptCount}</span>` : ''}
                    </div>
                    <div class="node-actions">
                        <button class="btn btn-sm btn-primary" onclick="openAddDepartmentModal(${company.id})">æ·»åŠ éƒ¨é—¨</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCompany(${company.id})">åˆ é™¤</button>
                    </div>
                `;

                companyGroup.appendChild(companyNode);

                if (deptCount > 0) {
                    const deptContainer = document.createElement('div');
                    deptContainer.className = `department-container ${isExpanded ? '' : 'collapsed'}`;
                    deptContainer.id = `deptContainer-${company.id}`;

                    company.departments.forEach(dept => {
                        const deptNode = document.createElement('div');
                        deptNode.className = 'org-node department';
                        deptNode.innerHTML = `
                            <div class="node-header">
                                <span>ğŸ“</span>
                                <span>${dept.name}</span>
                            </div>
                            <div class="node-actions">
                                <button class="btn btn-sm btn-primary" onclick="openEditDepartmentModal(${company.id}, ${dept.id})">ç¼–è¾‘</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteDepartment(${company.id}, ${dept.id})">åˆ é™¤</button>
                            </div>
                        `;
                        deptContainer.appendChild(deptNode);
                    });

                    companyGroup.appendChild(deptContainer);
                }

                container.appendChild(companyGroup);
            });
        }

        // æ¸²æŸ“è™šæ‹Ÿä»“æ ‘å½¢è§†å›¾ï¼ˆå…¬å¸ -> éƒ¨é—¨ -> è™šæ‹Ÿä»“ï¼‰
        function renderWarehouseTreeView() {
            const container = document.getElementById('warehouseTreeView');
            const searchTerm = document.getElementById('orgSearch')?.value?.toLowerCase() || '';
            container.innerHTML = '';
            container.className = 'org-tree';

            const filteredCompanies = searchTerm
                ? data.companies.filter(c =>
                    c.name.toLowerCase().includes(searchTerm) ||
                    c.warehouses?.some(w =>
                        w.name.toLowerCase().includes(searchTerm) ||
                        (w.channel && w.channel.toLowerCase().includes(searchTerm))
                    ) ||
                    c.departments.some(d =>
                        d.name.toLowerCase().includes(searchTerm) ||
                        d.warehouses?.some(w =>
                            w.name.toLowerCase().includes(searchTerm) ||
                            (w.channel && w.channel.toLowerCase().includes(searchTerm))
                        )
                    )
                )
                : data.companies;

            if (filteredCompanies.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“¦</div>
                        <div class="empty-state-title">${data.companies.length === 0 ? 'æš‚æ— ç»„ç»‡æ¶æ„' : 'æœªæ‰¾åˆ°åŒ¹é…çš„è™šæ‹Ÿä»“'}</div>
                        <div>${data.companies.length === 0 ? 'è¯·å…ˆåˆ›å»ºç»„ç»‡æ¶æ„ï¼Œç„¶ååˆ›å»ºè™šæ‹Ÿä»“' : 'è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯'}</div>
                    </div>
                `;
                return;
            }

            filteredCompanies.forEach(company => {
                const isExpanded = searchTerm ? true : warehouseTreeState.expandedCompanies.has(company.id);
                const totalWarehouseCount = countCompanyWarehouses(company);

                const companyGroup = document.createElement('div');
                companyGroup.className = 'company-group';

                const companyNode = document.createElement('div');
                companyNode.className = `org-node company ${isExpanded ? '' : 'collapsed'}`;
                companyNode.innerHTML = `
                    <div class="node-header" onclick="toggleWarehouseCompany(${company.id})">
                        <span class="expand-icon">${totalWarehouseCount > 0 ? 'â–¼' : ''}</span>
                        <span>ğŸ¢</span>
                        <span>${company.name}</span>
                        <span style="margin-left: 10px; color: var(--text-light); font-size: 14px;">(${company.code})</span>
                        ${totalWarehouseCount > 0 ? `<span class="dept-count">${totalWarehouseCount}ä¸ªè™šæ‹Ÿä»“</span>` : ''}
                    </div>
                `;

                companyGroup.appendChild(companyNode);

                if (totalWarehouseCount > 0) {
                    const deptContainer = document.createElement('div');
                    deptContainer.className = `department-container ${isExpanded ? '' : 'collapsed'}`;
                    deptContainer.id = `warehouseDeptContainer-${company.id}`;
                    if (!isExpanded) {
                        deptContainer.style.display = 'none';
                    }

                    company.departments.forEach(dept => {
                        const deptWarehouses = data.warehouses.filter(w => w.companyId === company.id && w.departmentId === dept.id);
                        if (deptWarehouses.length > 0) {
                            const deptNode = document.createElement('div');
                            deptNode.className = 'org-node department';
                            deptNode.innerHTML = `
                                <div class="node-header" onclick="toggleWarehouseDepartment(${company.id}, ${dept.id})">
                                    <span>ğŸ“</span>
                                    <span>${dept.name}</span>
                                    <span style="margin-left: 10px; color: var(--text-light); font-size: 14px;">(${deptWarehouses.length}ä¸ªè™šæ‹Ÿä»“)</span>
                                </div>
                            `;

                            // æ·»åŠ è™šæ‹Ÿä»“åˆ—è¡¨
                            const warehouseList = document.createElement('div');
                            warehouseList.className = 'warehouse-list';
                            warehouseList.id = `warehouseList-${company.id}-${dept.id}`;
                            warehouseList.style.display = searchTerm ? 'block' : 'none';
                            warehouseList.style.marginLeft = '30px';
                            warehouseList.style.paddingLeft = '20px';

                            deptWarehouses.forEach(warehouse => {
                                // è®¡ç®—å®é™…åº“å­˜æ•°æ®
                                const warehouseInventory = getWarehouseInventory(warehouse.id);
                                const warehouseLockedInventory = getWarehouseLockedInventory(warehouse.id);

                                // è®¡ç®—å¯ç”¨åº“å­˜æ€»é‡
                                const availableInventory = Object.values(warehouseInventory).reduce((sum, qty) => sum + qty, 0);

                                // è®¡ç®—é”å®šåº“å­˜æ€»é‡
                                const lockedInventory = Object.values(warehouseLockedInventory).reduce((sum, qty) => sum + qty, 0);

                                // è®¡ç®—æ€»åº“å­˜
                                const totalInventory = availableInventory + lockedInventory;

                                const warehouseNode = document.createElement('div');
                                warehouseNode.className = 'warehouse-card';

                                // ç¡®å®šä»“åº“ç±»å‹å’Œæ ‡ç­¾
                                let typeTag = '';
                                let typeClass = '';
                                let typeIcon = '';
                                let relationType = '';

                                if (warehouse.type === 'department') {
                                    typeTag = 'è™šæ‹Ÿä»“';
                                    typeClass = 'tag-department';
                                    typeIcon = 'ğŸ“‹';
                                    relationType = `éƒ¨é—¨: ${dept.name}`;
                                } else if (warehouse.type === 'channel') {
                                    typeTag = 'æ¸ é“ä»“';
                                    typeClass = 'tag-channel';
                                    typeIcon = 'ğŸ›’';
                                    relationType = `æ¸ é“: ${warehouse.channel || 'æœªç»‘å®š'}`;
                                } else if (warehouse.type === 'stock') {
                                    typeTag = 'å¤‡è´§ä»“';
                                    typeClass = 'tag-stock';
                                    typeIcon = 'ğŸ“¦';
                                    relationType = 'æ— å…³è”';
                                } else {
                                    // å…¼å®¹æ—§æ•°æ®ï¼šå¦‚æœæ²¡æœ‰typeå­—æ®µï¼Œæ ¹æ®å…¶ä»–å­—æ®µåˆ¤æ–­
                                    if (warehouse.departmentId) {
                                        typeTag = 'è™šæ‹Ÿä»“';
                                        typeClass = 'tag-department';
                                        typeIcon = 'ğŸ“‹';
                                        relationType = `éƒ¨é—¨: ${dept.name}`;
                                    } else if (warehouse.channel) {
                                        typeTag = 'æ¸ é“ä»“';
                                        typeClass = 'tag-channel';
                                        typeIcon = 'ğŸ›’';
                                        relationType = `æ¸ é“: ${warehouse.channel}`;
                                    } else {
                                        typeTag = 'å¤‡è´§ä»“';
                                        typeClass = 'tag-stock';
                                        typeIcon = 'ğŸ“¦';
                                        relationType = 'æ— å…³è”';
                                    }
                                }

                                warehouseNode.innerHTML = `
                                    <div class="warehouse-header">
                                        <span class="warehouse-icon">ğŸ“¦</span>
                                        <span class="warehouse-name">${warehouse.name}</span>
                                        <span class="tag ${typeClass}" style="margin-left: 10px;">${typeIcon} ${typeTag}</span>
                                    </div>
                                    <div class="warehouse-detail">
                                        <span class="detail-label">ç±»å‹å…³è”:</span>
                                        <span>${relationType}</span>
                                    </div>
                                    <div class="warehouse-detail">
                                        <span class="detail-label">å¯ç”¨åº“å­˜:</span>
                                        <span class="inventory-count">${availableInventory}</span>
                                    </div>
                                    <div class="warehouse-detail">
                                        <span class="detail-label">é”å®šåº“å­˜:</span>
                                        <span class="inventory-count" style="color: var(--warning-color);">${lockedInventory}</span>
                                    </div>
                                    <div class="warehouse-detail">
                                        <span class="detail-label">æ€»åº“å­˜:</span>
                                        <span class="inventory-count" style="color: var(--primary-color);">${totalInventory}</span>
                                    </div>
                                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                                        <button class="btn btn-sm btn-primary" onclick="openEditWarehouseModal(${warehouse.id})">ç¼–è¾‘</button>
                                        <button class="btn btn-sm btn-primary" onclick="openInventoryDetailModal(${warehouse.id})">æŸ¥çœ‹åº“å­˜è¯¦æƒ…</button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteWarehouse(${warehouse.id})">åˆ é™¤</button>
                                    </div>
                                `;

                                // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢ç‚¹å‡»ä»“åº“å¡ç‰‡æ—¶è§¦å‘çˆ¶çº§éƒ¨é—¨èŠ‚ç‚¹çš„æŠ˜å /å±•å¼€
                                warehouseNode.addEventListener('click', function(event) {
                                    event.stopPropagation();
                                });

                                warehouseList.appendChild(warehouseNode);
                            });

                            deptContainer.appendChild(deptNode);
                            deptContainer.appendChild(warehouseList);
                        }
                    });

                    companyGroup.appendChild(deptContainer);
                }

                container.appendChild(companyGroup);
            });
        }

        // è®¡ç®—å…¬å¸çš„è™šæ‹Ÿä»“æ€»æ•°
        function countCompanyWarehouses(company) {
            let count = 0;
            company.departments.forEach(dept => {
                const deptWarehouses = data.warehouses.filter(w => w.companyId === company.id && w.departmentId === dept.id);
                count += deptWarehouses.length;
            });
            return count;
        }

        // åˆ‡æ¢è™šæ‹Ÿä»“è§†å›¾ä¸­çš„å…¬å¸å±•å¼€/æ”¶èµ·
        function toggleWarehouseCompany(companyId) {
            const container = document.getElementById(`warehouseDeptContainer-${companyId}`);
            const companyNode = container.previousElementSibling;

            if (container.style.display === 'none') {
                container.style.display = 'block';
                companyNode.classList.remove('collapsed');
                warehouseTreeState.expandedCompanies.add(companyId);
            } else {
                container.style.display = 'none';
                companyNode.classList.add('collapsed');
                warehouseTreeState.expandedCompanies.delete(companyId);
            }
        }

        // åˆ‡æ¢è™šæ‹Ÿä»“è§†å›¾ä¸­çš„éƒ¨é—¨å±•å¼€/æ”¶èµ·
        function toggleWarehouseDepartment(companyId, departmentId) {
            const container = document.getElementById(`warehouseList-${companyId}-${departmentId}`);
            const deptNode = container.previousElementSibling;

            if (container.style.display === 'none') {
                container.style.display = 'block';
                deptNode.classList.remove('collapsed');
            } else {
                container.style.display = 'none';
                deptNode.classList.add('collapsed');
            }
        }

        // ç»„ç»‡æ¶æ„ç›¸å…³å‡½æ•°
        function updateStatistics() {
            const totalCompanies = data.companies.length;
            const totalDepartments = data.companies.reduce((sum, c) => sum + c.departments.length, 0);
            const totalWarehouses = data.warehouses.length;
            const totalInventory = data.warehouses.reduce((sum, w) => sum + w.inventory, 0);
            
            // åŠ¨ç”»æ•°å­—æ•ˆæœ
            animateNumber('statCompanies', totalCompanies);
            animateNumber('statDepartments', totalDepartments);
            animateNumber('statWarehouses', totalWarehouses);
            animateNumber('statTotalInventory', totalInventory);
        }
        
        function animateNumber(elementId, targetValue) {
            const element = document.getElementById(elementId);
            if (!element) return; // å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›

            const duration = 1000;
            const startValue = parseInt(element.textContent.replace(/,/g, '')) || 0;
            const startTime = performance.now();

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const currentValue = Math.floor(startValue + (targetValue - startValue) * progress);
                element.textContent = currentValue.toLocaleString();

                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }

            requestAnimationFrame(update);
        }
        
        function toggleCompany(companyId) {
            const container = document.getElementById(`deptContainer-${companyId}`);
            const companyNode = container.previousElementSibling;

            if (container.style.display === 'none') {
                container.style.display = 'block';
                companyNode.classList.remove('collapsed');
                orgTreeState.expandedCompanies.add(companyId);
            } else {
                container.style.display = 'none';
                companyNode.classList.add('collapsed');
                orgTreeState.expandedCompanies.delete(companyId);
            }
        }

        function filterOrgTree() {
            renderOrgTreeView();
        }
        
        function openAddCompanyModal() {
            document.getElementById('companyName').value = '';
            document.getElementById('companyCode').value = '';
            document.getElementById('addCompanyModal').classList.add('active');
        }
        
        function addCompany() {
            const nameInput = document.getElementById('companyName');
            const code = document.getElementById('companyCode').value.trim();
            
            if (!validateInput(nameInput, 'è¯·è¾“å…¥å…¬å¸åç§°')) {
                showToast('error', 'è¯·è¾“å…¥å…¬å¸åç§°');
                return;
            }
            
            simulateAsync(() => {
                const newCompany = {
                    id: Date.now(),
                    name: nameInput.value.trim(),
                    code: code || 'COMP' + Date.now(),
                    departments: []
                };
                
            data.companies.push(newCompany);
            renderOrgTreeView();
            updateStatistics();
            closeModal('addCompanyModal');
            showToast('success', 'å…¬å¸æ·»åŠ æˆåŠŸï¼');
            return true;
        }, 300);
    }
        
        function deleteCompany(companyId) {
            const company = data.companies.find(c => c.id === companyId);
            if (!company) return;
            
            showToast('warning', `ç¡®å®šè¦åˆ é™¤å…¬å¸"${company.name}"åŠå…¶æ‰€æœ‰éƒ¨é—¨å—ï¼Ÿ`, 0);
            
            // åˆ›å»ºç¡®è®¤å¯¹è¯æ¡†
            const confirmToast = document.createElement('div');
            confirmToast.className = 'toast toast-warning';
            confirmToast.style.marginTop = '10px';
            confirmToast.innerHTML = `
                <span class="toast-message">ç¡®å®šåˆ é™¤æ­¤æ“ä½œä¸å¯æ¢å¤</span>
                <button class="btn btn-danger btn-sm" style="margin-left: 10px;" onclick="confirmDeleteCompany(${companyId})">ç¡®è®¤åˆ é™¤</button>
                <button class="btn btn-sm" style="margin-left: 5px;" onclick="this.parentElement.remove()">å–æ¶ˆ</button>
            `;
            document.getElementById('toastContainer').appendChild(confirmToast);
        }
        
        function confirmDeleteCompany(companyId) {
            const company = data.companies.find(c => c.id === companyId);
            data.companies = data.companies.filter(c => c.id !== companyId);
            renderOrgTreeView();
            
            // ç§»é™¤æ‰€æœ‰æç¤º
            document.querySelectorAll('.toast').forEach(t => t.remove());
            
            updateStatistics();
            showToast('success', `å…¬å¸"${company.name}"å·²åˆ é™¤`);
        }
        
        function openAddDepartmentModal(companyId) {
            const company = data.companies.find(c => c.id === companyId);
            if (!company) return;
            
            document.getElementById('departmentCompanyId').value = companyId;
            document.getElementById('departmentCompanyName').value = company.name;
            document.getElementById('departmentName').value = '';
            document.getElementById('addDepartmentModal').classList.add('active');
        }
        
        function addDepartment() {
            const companyId = parseInt(document.getElementById('departmentCompanyId').value);
            const nameInput = document.getElementById('departmentName');
            
            if (!validateInput(nameInput, 'è¯·è¾“å…¥éƒ¨é—¨åç§°')) {
                showToast('error', 'è¯·è¾“å…¥éƒ¨é—¨åç§°');
                return;
            }
            
            simulateAsync(() => {
                const company = data.companies.find(c => c.id === companyId);
                if (!company) {
                    showToast('error', 'å…¬å¸ä¿¡æ¯ä¸å­˜åœ¨');
                    return;
                }
                
                company.departments.push({
                    id: Date.now(),
                    name: nameInput.value.trim(),
                    warehouses: []
                });
                
                renderOrgTreeView();
                updateStatistics();
                closeModal('addDepartmentModal');
                showToast('success', 'éƒ¨é—¨æ·»åŠ æˆåŠŸï¼');
                return true;
            }, 300);
        }
        
        function deleteDepartment(companyId, departmentId) {
            const company = data.companies.find(c => c.id === companyId);
            if (!company) return;
            
            const department = company.departments.find(d => d.id === departmentId);
            if (!department) return;
            
            showToast('warning', `ç¡®å®šè¦åˆ é™¤éƒ¨é—¨"${department.name}"å—ï¼Ÿ`, 0);
            
            // åˆ›å»ºç¡®è®¤å¯¹è¯æ¡†
            const confirmToast = document.createElement('div');
            confirmToast.className = 'toast toast-warning';
            confirmToast.style.marginTop = '10px';
            confirmToast.innerHTML = `
                <span class="toast-message">ç¡®å®šåˆ é™¤æ­¤æ“ä½œä¸å¯æ¢å¤</span>
                <button class="btn btn-danger btn-sm" style="margin-left: 10px;" onclick="confirmDeleteDepartment(${companyId}, ${departmentId})">ç¡®è®¤åˆ é™¤</button>
                <button class="btn btn-sm" style="margin-left: 5px;" onclick="this.parentElement.remove()">å–æ¶ˆ</button>
            `;
            document.getElementById('toastContainer').appendChild(confirmToast);
        }
        
        function confirmDeleteDepartment(companyId, departmentId) {
            const company = data.companies.find(c => c.id === companyId);
            const department = company.departments.find(d => d.id === departmentId);
            company.departments = company.departments.filter(d => d.id !== departmentId);
            renderOrgTreeView();

            // ç§»é™¤æ‰€æœ‰æç¤º
            document.querySelectorAll('.toast').forEach(t => t.remove());

            updateStatistics();
            showToast('success', `éƒ¨é—¨"${department.name}"å·²åˆ é™¤`);
        }

        function openEditDepartmentModal(companyId, departmentId) {
            const company = data.companies.find(c => c.id === companyId);
            if (!company) return;

            const department = company.departments.find(d => d.id === departmentId);
            if (!department) return;

            document.getElementById('editDepartmentCompanyId').value = companyId;
            document.getElementById('editDepartmentId').value = departmentId;
            document.getElementById('editDepartmentCompanyName').value = company.name;
            document.getElementById('editDepartmentName').value = department.name;
            document.getElementById('editDepartmentModal').classList.add('active');
        }

        function editDepartment() {
            const companyId = parseInt(document.getElementById('editDepartmentCompanyId').value);
            const departmentId = parseInt(document.getElementById('editDepartmentId').value);
            const nameInput = document.getElementById('editDepartmentName');

            if (!validateInput(nameInput, 'è¯·è¾“å…¥éƒ¨é—¨åç§°')) {
                showToast('error', 'è¯·è¾“å…¥éƒ¨é—¨åç§°');
                return;
            }

            simulateAsync(() => {
                const company = data.companies.find(c => c.id === companyId);
                if (!company) {
                    showToast('error', 'å…¬å¸ä¿¡æ¯ä¸å­˜åœ¨');
                    return;
                }

                const department = company.departments.find(d => d.id === departmentId);
                if (!department) {
                    showToast('error', 'éƒ¨é—¨ä¿¡æ¯ä¸å­˜åœ¨');
                    return;
                }

                const oldName = department.name;
                department.name = nameInput.value.trim();

                // æ›´æ–°è™šæ‹Ÿä»“ä¸­çš„éƒ¨é—¨åç§°
                data.warehouses.forEach(warehouse => {
                    if (warehouse.departmentId === departmentId) {
                        warehouse.departmentName = department.name;
                    }
                });

                renderOrgTreeView();
                renderWarehouseTreeView();
                closeModal('editDepartmentModal');
                showToast('success', `éƒ¨é—¨åç§°ä»"${oldName}"ä¿®æ”¹ä¸º"${department.name}"`);
                return true;
            }, 300);
        }

        // è™šæ‹Ÿä»“ç¼–è¾‘ç›¸å…³å‡½æ•°
        function openEditWarehouseModal(warehouseId) {
            // æŸ¥æ‰¾è™šæ‹Ÿä»“
            const warehouse = data.warehouses.find(w => w.id === warehouseId);
            if (!warehouse) {
                showToast('error', 'è™šæ‹Ÿä»“ä¸å­˜åœ¨');
                return;
            }

            // æŸ¥æ‰¾æ‰€å±å…¬å¸å’Œéƒ¨é—¨
            const company = data.companies.find(c => c.id === warehouse.companyId);
            const department = company ? company.departments.find(d => d.id === warehouse.departmentId) : null;

            // å¡«å……æ¨¡æ€æ¡†æ•°æ®
            document.getElementById('editWarehouseId').value = warehouseId;
            document.getElementById('editWarehouseCompanyName').value = company ? company.name : '';
            document.getElementById('editWarehouseDepartmentName').value = department ? department.name : '';
            document.getElementById('editWarehouseName').value = warehouse.name;
            document.getElementById('editWarehouseChannel').value = warehouse.channel || 'æœªç»‘å®š';

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('editWarehouseModal').classList.add('active');
        }

        function editWarehouse() {
            const warehouseId = parseInt(document.getElementById('editWarehouseId').value);
            const nameInput = document.getElementById('editWarehouseName');

            if (!validateInput(nameInput, 'è¯·è¾“å…¥è™šæ‹Ÿä»“åç§°')) {
                showToast('error', 'è¯·è¾“å…¥è™šæ‹Ÿä»“åç§°');
                return;
            }

            simulateAsync(() => {
                // æŸ¥æ‰¾è™šæ‹Ÿä»“
                const warehouse = data.warehouses.find(w => w.id === warehouseId);
                if (!warehouse) {
                    showToast('error', 'è™šæ‹Ÿä»“ä¿¡æ¯ä¸å­˜åœ¨');
                    return;
                }

                const oldName = warehouse.name;
                warehouse.name = nameInput.value.trim();

                // é‡æ–°æ¸²æŸ“è™šæ‹Ÿä»“æ ‘è§†å›¾
                renderWarehouseTreeView();
                closeModal('editWarehouseModal');
                showToast('success', `è™šæ‹Ÿä»“åç§°ä»"${oldName}"ä¿®æ”¹ä¸º"${warehouse.name}"`);
                return true;
            }, 300);
        }

        // è™šæ‹Ÿä»“ç®¡ç†ç›¸å…³å‡½æ•°
        function initWarehousePage() {
            // é»˜è®¤å±•å¼€æ‰€æœ‰å…¬å¸
            data.companies.forEach(company => {
                warehouseTreeState.expandedCompanies.add(company.id);
            });

            loadWarehouseCompanies();
            renderWarehouseList();
            initChannelSelection();
        }
        
        function openAddWarehouseModal() {
            loadWarehouseCompaniesModal();
            initWarehouseTypeSelection();
            resetWarehouseModal();
            document.getElementById('addWarehouseModal').classList.add('active');
        }
        
        function loadWarehouseCompaniesModal() {
            const select = document.getElementById('warehouseCompanyModal');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©å…¬å¸</option>';
            
            data.companies.forEach(company => {
                const option = document.createElement('option');
                option.value = company.id;
                option.textContent = company.name;
                select.appendChild(option);
            });
        }
        
        function loadDepartmentsModal() {
            const companyId = parseInt(document.getElementById('warehouseCompanyModal').value);
            const select = document.getElementById('warehouseDepartmentModal');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©éƒ¨é—¨</option>';
            
            const company = data.companies.find(c => c.id === companyId);
            if (company) {
                company.departments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept.id;
                    option.textContent = dept.name;
                    select.appendChild(option);
                });
            }
        }
        
        function initChannelSelectionModal() {
            const channelBtns = document.querySelectorAll('#channelOptionsModal .radio-btn');
            channelBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    channelBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedChannelValue = this.getAttribute('data-channel');
                });
            });
        }
        
        // è™šæ‹Ÿä»“ç±»å‹åˆ‡æ¢é€»è¾‘
        let selectedWarehouseType = 'department'; // é»˜è®¤é€‰æ‹©è™šæ‹Ÿä»“

        // ç±»å‹æç¤ºæ–‡æœ¬
        const warehouseTypeHints = {
            'department': 'è™šæ‹Ÿä»“éœ€è¦å…³è”ä¸€ä¸ªéƒ¨é—¨ï¼Œç”¨äºéƒ¨é—¨ä¸“å±åº“å­˜ç®¡ç†',
            'channel': 'æ¸ é“ä»“éœ€è¦å…³è”ä¸€ä¸ªé”€å”®æ¸ é“ï¼Œç”¨äºæ¸ é“ä¸“å±åº“å­˜ç®¡ç†',
            'stock': 'å¤‡è´§ä»“ä¸éœ€è¦å…³è”ä»»ä½•å±æ€§ï¼Œç”¨äºé€šç”¨åº“å­˜å¤‡è´§ç®¡ç†'
        };

        // åˆå§‹åŒ–è™šæ‹Ÿä»“ç±»å‹é€‰æ‹©
        function initWarehouseTypeSelection() {
            const typeBtns = document.querySelectorAll('#warehouseTypeOptions .radio-btn');
            const departmentFields = document.getElementById('departmentFieldsModal');
            const channelField = document.getElementById('channelFieldModal');
            const typeHint = document.getElementById('warehouseTypeHint');

            typeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰activeçŠ¶æ€
                    typeBtns.forEach(b => b.classList.remove('active'));
                    // æ·»åŠ å½“å‰activeçŠ¶æ€
                    btn.classList.add('active');

                    // è·å–é€‰ä¸­çš„ç±»å‹
                    selectedWarehouseType = btn.getAttribute('data-type');

                    // æ ¹æ®ç±»å‹æ˜¾ç¤º/éšè—å…³è”å­—æ®µ
                    if (selectedWarehouseType === 'department') {
                        departmentFields.style.display = 'flex';
                        channelField.style.display = 'none';
                    } else if (selectedWarehouseType === 'channel') {
                        departmentFields.style.display = 'none';
                        channelField.style.display = 'block';
                    } else if (selectedWarehouseType === 'stock') {
                        departmentFields.style.display = 'none';
                        channelField.style.display = 'none';
                    }

                    // æ›´æ–°æç¤ºæ–‡æœ¬
                    if (typeHint) {
                        typeHint.textContent = warehouseTypeHints[selectedWarehouseType];
                    }
                });
            });

            // åˆå§‹åŒ–æ¸ é“é€‰æ‹©æŒ‰é’®
            const channelBtns = document.querySelectorAll('#channelOptionsModal .radio-btn');
            channelBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    channelBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    selectedChannelValue = btn.getAttribute('data-channel');
                });
            });
        }

        // é‡ç½®è™šæ‹Ÿä»“æ¨¡æ€æ¡†
        function resetWarehouseModal() {
            document.getElementById('warehouseNameModal').value = '';
            const companySelect = document.getElementById('warehouseCompanyModal');
            const deptSelect = document.getElementById('warehouseDepartmentModal');
            if (companySelect) companySelect.value = '';
            if (deptSelect) deptSelect.value = '';

            // é‡ç½®ç±»å‹é€‰æ‹©
            const typeBtns = document.querySelectorAll('#warehouseTypeOptions .radio-btn');
            typeBtns.forEach(b => b.classList.remove('active'));
            if (typeBtns.length > 0) {
                typeBtns[0].classList.add('active');
            }
            selectedWarehouseType = 'department';
            selectedChannelValue = null;

            // é‡ç½®æ¸ é“é€‰æ‹©
            const channelBtns = document.querySelectorAll('#channelOptionsModal .radio-btn');
            channelBtns.forEach(b => b.classList.remove('active'));

            // æ˜¾ç¤ºéƒ¨é—¨å­—æ®µï¼Œéšè—æ¸ é“å­—æ®µ
            const departmentFields = document.getElementById('departmentFieldsModal');
            const channelField = document.getElementById('channelFieldModal');
            if (departmentFields) departmentFields.style.display = 'flex';
            if (channelField) channelField.style.display = 'none';
        }

        function toggleChannelBindingModal() {
            const bindChannel = document.getElementById('warehouseBindChannelModal').value;
            const channelGroup = document.getElementById('channelGroupModal');
            channelGroup.style.display = bindChannel === 'yes' ? 'block' : 'none';
        }
        
        function createWarehouseFromModal() {
            const nameInput = document.getElementById('warehouseNameModal');

            // éªŒè¯è™šæ‹Ÿä»“åç§°
            if (!validateInput(nameInput, 'è¯·è¾“å…¥è™šæ‹Ÿä»“åç§°')) {
                showToast('error', 'è¯·è¾“å…¥è™šæ‹Ÿä»“åç§°');
                return;
            }

            let warehouse = {
                id: Date.now(),
                name: nameInput.value.trim(),
                type: selectedWarehouseType, // æ–°å¢ç±»å‹å­—æ®µ
                inventory: 0,
                isMainWarehouse: false
            };

            // æ ¹æ®ç±»å‹å¤„ç†ä¸åŒçš„å…³è”ä¿¡æ¯
            if (selectedWarehouseType === 'department') {
                const companyId = parseInt(document.getElementById('warehouseCompanyModal').value);
                const departmentId = parseInt(document.getElementById('warehouseDepartmentModal').value);

                if (!companyId || !departmentId) {
                    showToast('warning', 'è¯·é€‰æ‹©å…¬å¸å’Œéƒ¨é—¨');
                    return;
                }

                const company = data.companies.find(c => c.id === companyId);
                const department = company.departments.find(d => d.id === departmentId);

                warehouse.companyId = companyId;
                warehouse.companyName = company.name;
                warehouse.departmentId = departmentId;
                warehouse.departmentName = department.name;
                warehouse.bindChannel = false;
                warehouse.channel = null;

            } else if (selectedWarehouseType === 'channel') {
                if (!selectedChannelValue) {
                    showToast('warning', 'è¯·é€‰æ‹©ç»‘å®šçš„æ¸ é“');
                    return;
                }

                warehouse.companyId = null;
                warehouse.companyName = null;
                warehouse.departmentId = null;
                warehouse.departmentName = null;
                warehouse.bindChannel = true;
                warehouse.channel = selectedChannelValue;

            } else if (selectedWarehouseType === 'stock') {
                warehouse.companyId = null;
                warehouse.companyName = null;
                warehouse.departmentId = null;
                warehouse.departmentName = null;
                warehouse.bindChannel = false;
                warehouse.channel = null;
            }

            simulateAsync(() => {
                data.warehouses.push(warehouse);

                closeModal('addWarehouseModal');
                renderWarehouseList();
                updateStatistics();

                let typeText = selectedWarehouseType === 'department' ? 'è™šæ‹Ÿä»“' :
                              selectedWarehouseType === 'channel' ? 'æ¸ é“ä»“' : 'å¤‡è´§ä»“';
                showToast('success', `${typeText}"${warehouse.name}"åˆ›å»ºæˆåŠŸï¼`);

                // é‡ç½®è¡¨å•
                resetWarehouseModal();
                return true;
            }, 400);
        }
        
        function loadWarehouseCompanies() {
            const select = document.getElementById('warehouseCompany');
            if (!select) return;

            select.innerHTML = '<option value="">è¯·é€‰æ‹©å…¬å¸</option>';

            data.companies.forEach(company => {
                const option = document.createElement('option');
                option.value = company.id;
                option.textContent = company.name;
                select.appendChild(option);
            });
        }
        
        function loadDepartments() {
            const companySelect = document.getElementById('warehouseCompany');
            const select = document.getElementById('warehouseDepartment');
            if (!companySelect || !select) return;

            const companyId = parseInt(companySelect.value);
            select.innerHTML = '<option value="">è¯·é€‰æ‹©éƒ¨é—¨</option>';

            const company = data.companies.find(c => c.id === companyId);
            if (company) {
                company.departments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept.id;
                    option.textContent = dept.name;
                    select.appendChild(option);
                });
            }
        }
        
        function initChannelSelection() {
            const channelBtns = document.querySelectorAll('#channelOptions .radio-btn');
            channelBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    channelBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedChannelValue = this.getAttribute('data-channel');
                });
            });
        }
        
        function toggleChannelBinding() {
            const bindChannel = document.getElementById('warehouseBindChannel').value;
            const channelGroup = document.getElementById('channelGroup');
            channelGroup.style.display = bindChannel === 'yes' ? 'block' : 'none';
        }
        
        function createWarehouse() {
            const companyId = parseInt(document.getElementById('warehouseCompany').value);
            const departmentId = parseInt(document.getElementById('warehouseDepartment').value);
            const nameInput = document.getElementById('warehouseName');
            const bindChannel = document.getElementById('warehouseBindChannel').value;
            
            if (!companyId || !departmentId) {
                showToast('warning', 'è¯·é€‰æ‹©å…¬å¸å’Œéƒ¨é—¨');
                return;
            }
            
            if (!validateInput(nameInput, 'è¯·è¾“å…¥è™šæ‹Ÿä»“åç§°')) {
                showToast('error', 'è¯·è¾“å…¥è™šæ‹Ÿä»“åç§°');
                return;
            }
            
            if (bindChannel === 'yes' && !selectedChannelValue) {
                showToast('warning', 'è¯·é€‰æ‹©ç»‘å®šçš„æ¸ é“');
                return;
            }
            
            simulateAsync(() => {
                const company = data.companies.find(c => c.id === companyId);
                const department = company.departments.find(d => d.id === departmentId);
                
                const warehouse = {
                    id: Date.now(),
                    name: nameInput.value.trim(),
                    companyId: companyId,
                    companyName: company.name,
                    departmentId: departmentId,
                    departmentName: department.name,
                    bindChannel: bindChannel === 'yes',
                    channel: bindChannel === 'yes' ? selectedChannelValue : null,
                    inventory: 0,  // éƒ¨é—¨è™šæ‹Ÿä»“åˆå§‹åº“å­˜ä¸º0
                    isMainWarehouse: false  // æ ‡è®°ä¸ºéƒ¨é—¨è™šæ‹Ÿä»“
                };
                
                data.warehouses.push(warehouse);
                
                // æ¸…ç©ºè¡¨å•
                nameInput.value = '';
                document.getElementById('warehouseBindChannel').value = 'no';
                document.getElementById('channelGroup').style.display = 'none';
                document.querySelectorAll('#channelOptions .radio-btn').forEach(b => b.classList.remove('active'));
                selectedChannelValue = '';
                
                renderWarehouseList();
                updateStatistics();
                showToast('success', `è™šæ‹Ÿä»“"${warehouse.name}"åˆ›å»ºæˆåŠŸï¼åˆå§‹åº“å­˜: ${warehouse.inventory}ï¼Œè¯·ä»æ€»ä»“è°ƒæ‹¨åº“å­˜`);
                return true;
            }, 400);
        }
        
        function renderWarehouseList() {
            const container = document.getElementById('warehouseList');
            const searchTerm = document.getElementById('warehouseSearch')?.value?.toLowerCase() || '';

            const filteredWarehouses = searchTerm
                ? data.warehouses.filter(w =>
                    w.name.toLowerCase().includes(searchTerm) ||
                    w.companyName.toLowerCase().includes(searchTerm) ||
                    w.departmentName.toLowerCase().includes(searchTerm) ||
                    (w.channel && w.channel.toLowerCase().includes(searchTerm))
                )
                : data.warehouses;

            if (filteredWarehouses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“¦</div>
                        <div class="empty-state-title">${data.warehouses.length === 0 ? 'æš‚æ— è™šæ‹Ÿä»“' : 'æœªæ‰¾åˆ°åŒ¹é…çš„è™šæ‹Ÿä»“'}</div>
                        <div>${data.warehouses.length === 0 ? 'è¯·å…ˆåˆ›å»ºç»„ç»‡æ¶æ„ï¼Œç„¶ååˆ›å»ºè™šæ‹Ÿä»“' : 'è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯'}</div>
                    </div>
                `;
                return;
            }

            // æŒ‰å…¬å¸åˆ†ç»„æ˜¾ç¤º
            const companyGroups = {};
            filteredWarehouses.forEach(warehouse => {
                if (!companyGroups[warehouse.companyId]) {
                    companyGroups[warehouse.companyId] = {
                        companyName: warehouse.companyName,
                        warehouses: []
                    };
                }
                companyGroups[warehouse.companyId].warehouses.push(warehouse);
            });

            // æœç´¢æ¨¡å¼ä¸‹è‡ªåŠ¨å±•å¼€æ‰€æœ‰å…¬å¸
            const isSearchMode = searchTerm.length > 0;

            let html = '';
            Object.keys(companyGroups).forEach(companyId => {
                const group = companyGroups[companyId];
                const warehouses = group.warehouses;
                const mainWarehouse = warehouses.find(w => w.isMainWarehouse === true);
                const subWarehouses = warehouses.filter(w => w.isMainWarehouse !== true);

                // æŒ‰éƒ¨é—¨åˆ†ç»„å­è™šæ‹Ÿä»“
                const deptGroups = {};
                subWarehouses.forEach(warehouse => {
                    if (!deptGroups[warehouse.departmentId]) {
                        deptGroups[warehouse.departmentId] = {
                            departmentName: warehouse.departmentName,
                            warehouses: []
                        };
                    }
                    deptGroups[warehouse.departmentId].warehouses.push(warehouse);
                });

                const isExpanded = isSearchMode || warehouseTreeState.expandedCompanies.has(parseInt(companyId));
                const deptCount = Object.keys(deptGroups).length;

                html += `
                    <div class="warehouse-tree-group">
                        <div class="warehouse-main" onclick="toggleWarehouseCompany(${companyId})">
                            <div class="warehouse-main-header">
                                <div class="warehouse-main-title">
                                    <span class="warehouse-expand-icon ${isExpanded ? 'expanded' : ''}">â–¶</span>
                                    <span>ğŸ¢</span>
                                    <span>${mainWarehouse ? mainWarehouse.name : group.companyName + ' (ä¸»è™šæ‹Ÿä»“)'}</span>
                                    <span class="tag" style="background: rgba(255,255,255,0.3); color: white;">æ€»ä»“</span>
                                </div>
                                <span class="warehouse-dept-count">${deptCount} ä¸ªéƒ¨é—¨</span>
                            </div>
                `;

                if (mainWarehouse) {
                    const mainWarehouseInventory = getWarehouseInventory(mainWarehouse.id);
                    const mainSkuCount = Object.keys(mainWarehouseInventory).filter(sku => mainWarehouseInventory[sku] > 0).length;

                    // è®¡ç®—å¯ç”¨åº“å­˜æ€»é‡
                    const mainAvailableInventory = Object.values(mainWarehouseInventory).reduce((sum, qty) => sum + qty, 0);

                    html += `
                            <div class="warehouse-detail" style="color: rgba(255,255,255,0.9); margin-top: 15px; display: flex; gap: 30px;">
                                <div>
                                    <span class="detail-label" style="color: rgba(255,255,255,0.8);">SKUæ•°é‡:</span>
                                    <span style="font-size: 20px; font-weight: bold; color: #fbbf24;">${mainSkuCount}</span>
                                </div>
                                <div>
                                    <span class="detail-label" style="color: rgba(255,255,255,0.8);">å¯ç”¨åº“å­˜æ€»é‡:</span>
                                    <span style="font-size: 20px; font-weight: bold; color: #4ade80;">${mainAvailableInventory.toLocaleString()}</span>
                                </div>
                            </div>
                            <div style="margin-top: 15px; display: flex; gap: 8px;">
                                <button class="btn btn-primary btn-sm" style="background: rgba(59, 130, 246, 0.9); color: white;" onclick="event.stopPropagation(); openInventoryDetailModal(${mainWarehouse.id})">
                                    <span>ğŸ“Š</span>
                                    <span>æŸ¥è¯¢åº“å­˜</span>
                                </button>
                                <button class="btn btn-danger btn-sm" style="background: rgba(239, 68, 68, 0.9); color: white;" onclick="event.stopPropagation(); deleteWarehouse(${mainWarehouse.id})">
                                    <span>Ã—</span>
                                    <span>åˆ é™¤</span>
                                </button>
                            </div>
                    `;
                }

                html += `
                        </div>
                        <div class="warehouse-departments-container ${isExpanded ? 'expanded' : ''}">
                `;

                // æ¸²æŸ“æ¯ä¸ªéƒ¨é—¨åŠå…¶å­è™šæ‹Ÿä»“
                Object.keys(deptGroups).forEach(deptId => {
                    const deptGroup = deptGroups[deptId];
                    html += `
                            <div class="warehouse-dept-group">
                                <div class="warehouse-dept-header">
                                    <span class="warehouse-dept-name">
                                        <span>ğŸ¬</span>
                                        <span>${deptGroup.departmentName}</span>
                                        <span class="tag tag-info" style="margin-left: 8px; font-size: 11px;">${deptGroup.warehouses.length} ä¸ªå­ä»“</span>
                                    </span>
                                </div>
                    `;

                    // æ¸²æŸ“è¯¥éƒ¨é—¨çš„å­è™šæ‹Ÿä»“
                    deptGroup.warehouses.forEach(warehouse => {
                        const warehouseInventory = getWarehouseInventory(warehouse.id);
                        const skuCount = Object.keys(warehouseInventory).filter(sku => warehouseInventory[sku] > 0).length;

                        // è®¡ç®—å¯ç”¨åº“å­˜æ€»é‡
                        const availableInventory = Object.values(warehouseInventory).reduce((sum, qty) => sum + qty, 0);

                        html += `
                                <div class="warehouse-sub-item">
                                    <div class="warehouse-sub-card">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <span style="font-size: 18px;">ğŸ“¦</span>
                                                <span style="font-weight: 600; color: var(--text-color);">${warehouse.name}</span>
                                            </div>
                                            ${warehouse.bindChannel ? `<span class="tag tag-primary">${warehouse.channel}</span>` : ''}
                                        </div>
                                        <div style="display: flex; flex-direction: column; gap: 8px; font-size: 13px; color: var(--text-light);">
                                            <div style="display: flex; justify-content: space-between;">
                                                <span>ç»‘å®šæ¸ é“:</span>
                                                <span>${warehouse.bindChannel ? `<span class="tag tag-primary" style="font-size: 11px;">${warehouse.channel}</span>` : '<span class="no-binding">æœªç»‘å®š</span>'}</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span>SKUæ•°é‡:</span>
                                                <span style="font-weight: 600; color: var(--success-color);">${skuCount}</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between;">
                                                <span>å¯ç”¨åº“å­˜æ€»é‡:</span>
                                                <span style="font-weight: 600; color: var(--primary-color);">${availableInventory.toLocaleString()}</span>
                                            </div>
                                        </div>
                                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); display: flex; gap: 8px;">
                                            <button class="btn btn-primary btn-sm" style="font-size: 12px; padding: 4px 12px;" onclick="openInventoryDetailModal(${warehouse.id})">
                                                <span>ğŸ“Š</span>
                                                <span>æŸ¥è¯¢åº“å­˜</span>
                                            </button>
                                            <button class="btn btn-danger btn-sm" style="font-size: 12px; padding: 4px 12px;" onclick="deleteWarehouse(${warehouse.id})">
                                                <span>Ã—</span>
                                                <span>åˆ é™¤</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                        `;
                    });

                    html += `
                            </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }
        
        function filterWarehouses() {
            renderWarehouseList();
        }
        
        function deleteWarehouse(warehouseId) {
            const warehouse = data.warehouses.find(w => w.id === warehouseId);
            if (!warehouse) return;
            
            showToast('warning', `ç¡®å®šè¦åˆ é™¤è™šæ‹Ÿä»“"${warehouse.name}"å—ï¼Ÿ`, 0);
            
            // åˆ›å»ºç¡®è®¤å¯¹è¯æ¡†
            const confirmToast = document.createElement('div');
            confirmToast.className = 'toast toast-warning';
            confirmToast.style.marginTop = '10px';
            confirmToast.innerHTML = `
                <span class="toast-message">ç¡®å®šåˆ é™¤æ­¤æ“ä½œä¸å¯æ¢å¤</span>
                <button class="btn btn-danger btn-sm" style="margin-left: 10px;" onclick="confirmDeleteWarehouse(${warehouseId})">ç¡®è®¤åˆ é™¤</button>
                <button class="btn btn-sm" style="margin-left: 5px;" onclick="this.parentElement.remove()">å–æ¶ˆ</button>
            `;
            document.getElementById('toastContainer').appendChild(confirmToast);
        }
        
        function confirmDeleteWarehouse(warehouseId) {
            const warehouse = data.warehouses.find(w => w.id === warehouseId);
            data.warehouses = data.warehouses.filter(w => w.id !== warehouseId);
            renderWarehouseList();
            updateStatistics();
            
            // ç§»é™¤æ‰€æœ‰æç¤º
            document.querySelectorAll('.toast').forEach(t => t.remove());
            
            showToast('success', `è™šæ‹Ÿä»“"${warehouse.name}"å·²åˆ é™¤`);
        }

        // åº“å­˜è¯¦æƒ…ç›¸å…³å‡½æ•°
        let currentInventoryDetailWarehouseId = null;

        function openInventoryDetailModal(warehouseId) {
            currentInventoryDetailWarehouseId = warehouseId;
            const warehouse = data.warehouses.find(w => w.id === warehouseId);

            if (!warehouse) {
                showToast('error', 'è™šæ‹Ÿä»“ä¸å­˜åœ¨');
                return;
            }

            // è®¾ç½®ä»“åº“åç§°
            document.getElementById('inventoryDetailWarehouseName').textContent = warehouse.name;

            // æ¸²æŸ“åº“å­˜è¯¦æƒ…
            renderInventoryDetail();

            // æ‰“å¼€æ¨¡æ€æ¡†
            document.getElementById('inventoryDetailModal').classList.add('active');
        }

        function renderInventoryDetail() {
            if (!currentInventoryDetailWarehouseId) return;

            const searchTerm = document.getElementById('inventoryDetailSearch')?.value?.toLowerCase() || '';
            const warehouseInventory = getWarehouseInventory(currentInventoryDetailWarehouseId);
            const warehouseLockedInventory = getWarehouseLockedInventory(currentInventoryDetailWarehouseId);

            // è·å–æ‰€æœ‰SKU
            const allSKUs = new Set([
                ...Object.keys(warehouseInventory),
                ...Object.keys(warehouseLockedInventory)
            ]);

            // è¿‡æ»¤SKU
            let skus = Array.from(allSKUs);
            if (searchTerm) {
                skus = skus.filter(sku => sku.toLowerCase().includes(searchTerm));
            }

            // è®¡ç®—æ€»é‡
            let totalAvailable = 0;
            let totalLocked = 0;
            let skuCount = 0;

            skus.forEach(sku => {
                const available = warehouseInventory[sku] || 0;
                const locked = warehouseLockedInventory[sku] || 0;
                if (available > 0 || locked > 0) {
                    totalAvailable += available;
                    totalLocked += locked;
                    skuCount++;
                }
            });

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('inventoryDetailSKUCount').textContent = skuCount;
            document.getElementById('inventoryDetailTotalStock').textContent = totalAvailable.toLocaleString();
            document.getElementById('inventoryDetailLockedStock').textContent = totalLocked.toLocaleString();

            // æ¸²æŸ“è¡¨æ ¼
            const tbody = document.getElementById('inventoryDetailTableBody');

            if (skus.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 30px; color: var(--text-light);">
                            ${searchTerm ? 'æœªæ‰¾åˆ°åŒ¹é…çš„SKU' : 'æš‚æ— åº“å­˜æ•°æ®'}
                        </td>
                    </tr>
                `;
                return;
            }

            let html = '';
            skus.forEach(sku => {
                const available = warehouseInventory[sku] || 0;
                const locked = warehouseLockedInventory[sku] || 0;
                const total = available + locked;

                if (total > 0) {
                    html += `
                        <tr>
                            <td><span class="tag tag-primary">${sku}</span></td>
                            <td><span style="font-weight: 600; color: var(--success-color);">${available.toLocaleString()}</span></td>
                            <td><span style="font-weight: 600; color: var(--warning-color);">${locked.toLocaleString()}</span></td>
                            <td><span style="font-weight: 600; color: var(--primary-color);">${total.toLocaleString()}</span></td>
                        </tr>
                    `;
                }
            });

            tbody.innerHTML = html;
        }

        function filterInventoryDetail() {
            renderInventoryDetail();
        }

        function getWarehouseLockedInventory(warehouseId) {
            const inventory = {};
            Object.keys(data.warehouseLockedInventory).forEach(key => {
                if (key.startsWith(warehouseId + '_')) {
                    const sku = key.split('_')[1];
                    inventory[sku] = data.warehouseLockedInventory[key];
                }
            });
            return inventory;
        }

        function getWarehouseInventory(warehouseId) {
            const inventory = {};
            Object.keys(data.warehouseInventory).forEach(key => {
                if (key.startsWith(warehouseId + '_')) {
                    const sku = key.split('_')[1];
                    inventory[sku] = data.warehouseInventory[key];
                }
            });
            return inventory;
        }

        // åº“å­˜è°ƒæ‹¨ç›¸å…³å‡½æ•°
        let transferModalData = {
            products: []
        };

        function initTransferPage() {
            loadTransferFromCompanies();
            loadTransferToDepartments();
            renderTransferList();
        }

        function openAddTransferModal() {
            // é‡ç½®æ•°æ®
            transferModalData = {
                products: []
            };

            // åŠ è½½æ‰€æœ‰è™šæ‹Ÿä»“åˆ°ä¸¤ä¸ªä¸‹æ‹‰æ¡†
            const fromWarehouseSelect = document.getElementById('transferFromWarehouseModal');
            const toWarehouseSelect = document.getElementById('transferToWarehouseModal');

            fromWarehouseSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è°ƒæ‹¨ä»“</option>';
            toWarehouseSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è°ƒå…¥ä»“</option>';

            // è·å–æ‰€æœ‰è™šæ‹Ÿä»“ï¼ˆåŒ…æ‹¬æ€»ä»“å’Œéƒ¨é—¨è™šæ‹Ÿä»“ï¼‰
            data.warehouses.forEach(warehouse => {
                const company = data.companies.find(c => c.id === warehouse.companyId);
                let displayName = '';

                if (warehouse.isMainWarehouse) {
                    // æ€»ä»“
                    displayName = `${company.name} - æ€»ä»“ - ${warehouse.name}`;
                } else {
                    // éƒ¨é—¨è™šæ‹Ÿä»“
                    const department = company.departments.find(d => d.id === warehouse.departmentId);
                    displayName = `${company.name} - ${department.name} - ${warehouse.name}`;
                }

                const option1 = document.createElement('option');
                option1.value = warehouse.id;
                option1.textContent = displayName;
                fromWarehouseSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = warehouse.id;
                option2.textContent = displayName;
                toWarehouseSelect.appendChild(option2);
            });

            // é‡ç½®è¡¨å•
            document.getElementById('transferReasonModal').value = '';

            // æ¸…ç©ºäº§å“è¡¨æ ¼
            renderTransferProductTable();

            document.getElementById('addTransferModal').classList.add('active');
        }


        function loadTransferProductSKUs() {
            // æ¸…ç©ºäº§å“åˆ—è¡¨å¹¶é‡æ–°æ¸²æŸ“
            transferModalData.products = [];
            renderTransferProductTable();
        }

        function addTransferProductRow() {
            const fromWarehouseId = parseInt(document.getElementById('transferFromWarehouseModal').value);

            if (!fromWarehouseId) {
                showToast('warning', 'è¯·å…ˆé€‰æ‹©è°ƒå‡ºè™šæ‹Ÿä»“');
                return;
            }

            // æ·»åŠ æ–°è¡Œ
            transferModalData.products.push({
                sku: '',
                productName: '',
                availableStock: 0,
                quantity: 0
            });

            renderTransferProductTable();
        }

        function renderTransferProductTable() {
            const tbody = document.getElementById('transferProductTableBody');
            const fromWarehouseId = parseInt(document.getElementById('transferFromWarehouseModal').value);

            if (!fromWarehouseId || transferModalData.products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 30px; color: var(--text-light);">
                            ${!fromWarehouseId ? 'è¯·å…ˆé€‰æ‹©è°ƒå‡ºè™šæ‹Ÿä»“ï¼Œç„¶åæ·»åŠ äº§å“' : 'æš‚æ— äº§å“ï¼Œè¯·ç‚¹å‡»"æ·»åŠ äº§å“"æŒ‰é’®'}
                        </td>
                    </tr>
                `;
                document.getElementById('transferTotalCount').textContent = '0';
                return;
            }

            // è·å–è°ƒå‡ºä»“åº“çš„åº“å­˜
            const warehouseInventory = getWarehouseInventory(fromWarehouseId);
            const availableSKUs = Object.keys(warehouseInventory).filter(sku => warehouseInventory[sku] > 0);

            let html = '';
            transferModalData.products.forEach((product, index) => {
                html += `
                    <tr>
                        <td>
                            <select class="form-control" onchange="handleTransferSKUChange(${index})" id="transferSKU_${index}">
                                <option value="">è¯·é€‰æ‹©SKU</option>
                                ${availableSKUs.map(sku => `
                                    <option value="${sku}" ${product.sku === sku ? 'selected' : ''} data-stock="${warehouseInventory[sku]}">
                                        ${sku} (åº“å­˜: ${warehouseInventory[sku]})
                                    </option>
                                `).join('')}
                            </select>
                        </td>
                        <td>
                            <input type="text" class="form-control" value="${product.productName}" readonly style="background: #e9ecef;">
                        </td>
                        <td>
                            <span style="font-weight: bold; color: var(--success-color);">${product.availableStock}</span>
                        </td>
                        <td>
                            <input type="number" class="form-control" value="${product.quantity || ''}" min="1" max="${product.availableStock}"
                                onchange="handleTransferQuantityChange(${index}, this.value)" placeholder="æ•°é‡">
                        </td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="removeTransferProductRow(${index})">
                                <span>Ã—</span>
                                <span>åˆ é™¤</span>
                            </button>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;

            // æ›´æ–°æ€»æ•°
            const totalCount = transferModalData.products.reduce((sum, p) => sum + (parseInt(p.quantity) || 0), 0);
            document.getElementById('transferTotalCount').textContent = totalCount;
        }

        function handleTransferSKUChange(index) {
            const select = document.getElementById(`transferSKU_${index}`);
            const selectedOption = select.options[select.selectedIndex];

            if (selectedOption && selectedOption.value) {
                const sku = selectedOption.value;
                const stock = parseInt(selectedOption.dataset.stock);

                transferModalData.products[index].sku = sku;
                transferModalData.products[index].productName = `å•†å“ ${sku}`;
                transferModalData.products[index].availableStock = stock;
                transferModalData.products[index].quantity = 0;
            } else {
                transferModalData.products[index].sku = '';
                transferModalData.products[index].productName = '';
                transferModalData.products[index].availableStock = 0;
                transferModalData.products[index].quantity = 0;
            }

            renderTransferProductTable();
        }

        function handleTransferQuantityChange(index, value) {
            const quantity = parseInt(value) || 0;
            const availableStock = transferModalData.products[index].availableStock;

            if (quantity > availableStock) {
                showToast('warning', `æ•°é‡ä¸èƒ½è¶…è¿‡å¯ç”¨åº“å­˜ ${availableStock}`);
                transferModalData.products[index].quantity = availableStock;
            } else {
                transferModalData.products[index].quantity = quantity;
            }

            renderTransferProductTable();
        }

        function removeTransferProductRow(index) {
            transferModalData.products.splice(index, 1);
            renderTransferProductTable();
        }

        function createTransferFromModal() {
            const fromWarehouseId = parseInt(document.getElementById('transferFromWarehouseModal').value);
            const toWarehouseId = parseInt(document.getElementById('transferToWarehouseModal').value);
            const reason = document.getElementById('transferReasonModal').value.trim() || 'å¸¸è§„è°ƒæ‹¨';

            if (!fromWarehouseId || !toWarehouseId) {
                showToast('warning', 'è¯·é€‰æ‹©è°ƒæ‹¨ä»“å’Œè°ƒå…¥ä»“');
                return;
            }

            if (fromWarehouseId === toWarehouseId) {
                showToast('error', 'è°ƒæ‹¨ä»“å’Œè°ƒå…¥ä»“ä¸èƒ½ç›¸åŒ');
                return;
            }

            if (transferModalData.products.length === 0) {
                showToast('warning', 'è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªäº§å“');
                return;
            }

            // éªŒè¯æ‰€æœ‰äº§å“
            for (const product of transferModalData.products) {
                if (!product.sku) {
                    showToast('warning', 'è¯·ä¸ºæ‰€æœ‰äº§å“é€‰æ‹©SKU');
                    return;
                }
                if (!product.quantity || product.quantity <= 0) {
                    showToast('warning', `è¯·ä¸ºSKU ${product.sku} è¾“å…¥æœ‰æ•ˆçš„è°ƒæ‹¨æ•°é‡`);
                    return;
                }
                if (product.quantity > product.availableStock) {
                    showToast('error', `SKU ${product.sku} çš„è°ƒæ‹¨æ•°é‡ä¸èƒ½è¶…è¿‡å¯ç”¨åº“å­˜ ${product.availableStock}`);
                    return;
                }
            }

            const fromWarehouse = data.warehouses.find(w => w.id === fromWarehouseId);
            const toWarehouse = data.warehouses.find(w => w.id === toWarehouseId);

            // è®¡ç®—æ€»æ•°é‡
            const totalQuantity = transferModalData.products.reduce((sum, p) => sum + p.quantity, 0);

            // æ£€æŸ¥æ€»åº“å­˜æ˜¯å¦è¶³å¤Ÿ
            if (fromWarehouse.inventory < totalQuantity) {
                showToast('error', `è°ƒå‡ºè™šæ‹Ÿä»“æ€»åº“å­˜ä¸è¶³ï¼å¯ç”¨åº“å­˜: ${fromWarehouse.inventory}`);
                return;
            }

            simulateAsync(() => {
                // æ‰§è¡Œè°ƒæ‹¨
                transferModalData.products.forEach(product => {
                    const keyFrom = fromWarehouseId + '_' + product.sku;
                    const keyTo = toWarehouseId + '_' + product.sku;

                    // æ›´æ–°SKUåº“å­˜
                    const fromStock = data.warehouseInventory[keyFrom] || 0;
                    data.warehouseInventory[keyFrom] = fromStock - product.quantity;
                    data.warehouseInventory[keyTo] = (data.warehouseInventory[keyTo] || 0) + product.quantity;

                    // è®°å½•æ¯ä¸ªSKUçš„è°ƒæ‹¨
                    data.transfers.push({
                        id: Date.now() + Math.random(),
                        fromWarehouseId: fromWarehouseId,
                        fromWarehouseName: fromWarehouse.name,
                        toWarehouseId: toWarehouseId,
                        toWarehouseName: toWarehouse.name,
                        sku: product.sku,
                        productName: product.productName,
                        quantity: product.quantity,
                        reason: reason,
                        time: new Date().toLocaleString()
                    });
                });

                // æ›´æ–°è™šæ‹Ÿä»“æ€»åº“å­˜
                fromWarehouse.inventory -= totalQuantity;
                toWarehouse.inventory += totalQuantity;

                closeModal('addTransferModal');
                renderTransferList();
                renderWarehouseList();

                showToast('success', `è°ƒæ‹¨æˆåŠŸï¼å…±è°ƒæ‹¨ ${totalQuantity} ä»¶å•†å“ä» ${fromWarehouse.name} åˆ° ${toWarehouse.name}`);
                return true;
            }, 500);
        }

        function loadTransferFromCompanies() {
            const select = document.getElementById('transferFromCompany');
            if (!select) return;

            select.innerHTML = '<option value="">è¯·é€‰æ‹©å…¬å¸</option>';

            data.companies.forEach(company => {
                const option = document.createElement('option');
                option.value = company.id;
                option.textContent = company.name;
                select.appendChild(option);
            });
        }
        
        function loadTransferToDepartments() {
            const select = document.getElementById('transferToDepartment');
            if (!select) return;

            select.innerHTML = '<option value="">è¯·é€‰æ‹©éƒ¨é—¨</option>';

            data.companies.forEach(company => {
                company.departments.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept.id;
                    option.textContent = `${company.name} - ${dept.name}`;
                    select.appendChild(option);
                });
            });
        }
        
        function loadTransferFromWarehouse() {
            const companySelect = document.getElementById('transferFromCompany');
            const select = document.getElementById('transferFromWarehouse');
            if (!companySelect || !select) return;

            const companyId = parseInt(companySelect.value);
            select.innerHTML = '<option value="">è¯·é€‰æ‹©è°ƒå‡ºè™šæ‹Ÿä»“ï¼ˆä»…æ˜¾ç¤ºæ€»ä»“ï¼‰</option>';

            // åªåŠ è½½è¯¥å…¬å¸çš„æ€»ä»“
            data.warehouses.filter(w => w.companyId === companyId && w.isMainWarehouse === true).forEach(warehouse => {
                const option = document.createElement('option');
                option.value = warehouse.id;
                option.textContent = `${warehouse.name} (åº“å­˜: ${warehouse.inventory})`;
                select.appendChild(option);
            });
        }
        
        function loadTransferToWarehouse() {
            const companySelect = document.getElementById('transferFromCompany');
            const departmentSelect = document.getElementById('transferToDepartment');
            const select = document.getElementById('transferToWarehouse');
            if (!companySelect || !departmentSelect || !select) return;

            const companyId = parseInt(companySelect.value);
            const departmentId = parseInt(departmentSelect.value);
            select.innerHTML = '<option value="">è¯·é€‰æ‹©è°ƒå…¥è™šæ‹Ÿä»“ï¼ˆä»…æ˜¾ç¤ºéƒ¨é—¨è™šæ‹Ÿä»“ï¼‰</option>';

            // åªåŠ è½½è¯¥éƒ¨é—¨ä¸‹çš„éæ€»ä»“è™šæ‹Ÿä»“
            data.warehouses.filter(w => w.departmentId === departmentId && w.isMainWarehouse !== true).forEach(warehouse => {
                const option = document.createElement('option');
                option.value = warehouse.id;
                option.textContent = `${warehouse.name} (åº“å­˜: ${warehouse.inventory})`;
                select.appendChild(option);
            });
        }
        
        function createTransfer() {
            const fromWarehouseId = parseInt(document.getElementById('transferFromWarehouse').value);
            const toWarehouseId = parseInt(document.getElementById('transferToWarehouse').value);
            const skuInput = document.getElementById('transferSKU');
            const productNameInput = document.getElementById('transferProductName');
            const quantityInput = document.getElementById('transferQuantity');
            const reason = document.getElementById('transferReason').value.trim();
            
            if (!fromWarehouseId || !toWarehouseId) {
                showToast('warning', 'è¯·é€‰æ‹©è°ƒå‡ºå’Œè°ƒå…¥è™šæ‹Ÿä»“');
                return;
            }
            
            if (!validateInput(skuInput, 'è¯·è¾“å…¥å•†å“SKU') || !validateInput(productNameInput, 'è¯·è¾“å…¥å•†å“åç§°')) {
                showToast('error', 'è¯·è¾“å…¥å•†å“SKUå’Œåç§°');
                return;
            }
            
            const quantity = parseInt(quantityInput.value);
            if (!quantity || quantity <= 0) {
                showToast('warning', 'è¯·è¾“å…¥æœ‰æ•ˆçš„è°ƒæ‹¨æ•°é‡');
                return;
            }
            
            const fromWarehouse = data.warehouses.find(w => w.id === fromWarehouseId);
            const toWarehouse = data.warehouses.find(w => w.id === toWarehouseId);
            
            // éªŒè¯è°ƒæ‹¨è§„åˆ™ï¼šåªèƒ½ä»æ€»ä»“è°ƒæ‹¨åˆ°éƒ¨é—¨è™šæ‹Ÿä»“
            if (!fromWarehouse.isMainWarehouse) {
                showToast('error', 'åªèƒ½ä»æ€»ä»“è°ƒæ‹¨åº“å­˜åˆ°éƒ¨é—¨è™šæ‹Ÿä»“ï¼');
                return;
            }
            
            if (toWarehouse.isMainWarehouse) {
                showToast('error', 'ä¸èƒ½è°ƒæ‹¨åˆ°æ€»ä»“ï¼Œåªèƒ½è°ƒæ‹¨åˆ°éƒ¨é—¨è™šæ‹Ÿä»“ï¼');
                return;
            }
            
            // éªŒè¯è°ƒå…¥è™šæ‹Ÿä»“å¿…é¡»åœ¨è°ƒå‡ºæ€»ä»“çš„ç®¡è¾–èŒƒå›´å†…
            if (fromWarehouse.companyId !== toWarehouse.companyId) {
                showToast('error', 'è°ƒå…¥è™šæ‹Ÿä»“å¿…é¡»å±äºè°ƒå‡ºæ€»ä»“æ‰€åœ¨çš„å…¬å¸ï¼');
                return;
            }
            
            // æ£€æŸ¥åº“å­˜æ˜¯å¦è¶³å¤Ÿ
            if (fromWarehouse.inventory < quantity) {
                showToast('error', `è°ƒå‡ºè™šæ‹Ÿä»“åº“å­˜ä¸è¶³ï¼å¯ç”¨åº“å­˜: ${fromWarehouse.inventory}`);
                return;
            }
            
            simulateAsync(() => {
                const sku = skuInput.value.trim();
                const keyFrom = fromWarehouseId + '_' + sku;
                const keyTo = toWarehouseId + '_' + sku;
                
                // æ£€æŸ¥è°ƒå‡ºä»“åº“çš„è¯¥SKUåº“å­˜æ˜¯å¦è¶³å¤Ÿ
                const fromStock = data.warehouseInventory[keyFrom] || 0;
                if (fromStock < quantity) {
                    showToast('error', `SKU ${sku} åœ¨${fromWarehouse.name}çš„åº“å­˜ä¸è¶³ï¼å¯ç”¨åº“å­˜: ${fromStock}`);
                    return;
                }
                
                // æ›´æ–°SKUåº“å­˜
                data.warehouseInventory[keyFrom] = fromStock - quantity;
                data.warehouseInventory[keyTo] = (data.warehouseInventory[keyTo] || 0) + quantity;
                
                // æ›´æ–°è™šæ‹Ÿä»“æ€»åº“å­˜
                fromWarehouse.inventory -= quantity;
                toWarehouse.inventory += quantity;
                
                // è®°å½•è°ƒæ‹¨
                data.transfers.push({
                    id: Date.now(),
                    fromWarehouseId: fromWarehouseId,
                    fromWarehouseName: fromWarehouse.name,
                    toWarehouseId: toWarehouseId,
                    toWarehouseName: toWarehouse.name,
                    sku: sku,
                    productName: productNameInput.value.trim(),
                    quantity: quantity,
                    reason: reason || 'å¸¸è§„è°ƒæ‹¨',
                    time: new Date().toLocaleString()
                });
                
                // æ¸…ç©ºè¡¨å•
                skuInput.value = '';
                productNameInput.value = '';
                quantityInput.value = '';
                document.getElementById('transferReason').value = '';
                
                // åˆ·æ–°æ˜¾ç¤º
                loadTransferFromWarehouse();
                loadTransferToWarehouse();
                renderTransferList();
                renderWarehouseList();
                
                showToast('success', `è°ƒæ‹¨æˆåŠŸï¼${quantity}ä»¶SKU ${sku}å·²ä»${fromWarehouse.name}è°ƒæ‹¨åˆ°${toWarehouse.name}`);
                return true;
            }, 500);
        }
        
        function renderTransferList() {
            const container = document.getElementById('transferList');
            const searchTerm = document.getElementById('transferSearch')?.value?.toLowerCase() || '';
            
            const filteredTransfers = searchTerm 
                ? data.transfers.filter(t => 
                    t.fromWarehouseName.toLowerCase().includes(searchTerm) ||
                    t.toWarehouseName.toLowerCase().includes(searchTerm) ||
                    t.sku.toLowerCase().includes(searchTerm) ||
                    t.productName.toLowerCase().includes(searchTerm)
                )
                : data.transfers;
            
            if (filteredTransfers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ”„</div>
                        <div class="empty-state-title">${data.transfers.length === 0 ? 'æš‚æ— è°ƒæ‹¨è®°å½•' : 'æœªæ‰¾åˆ°åŒ¹é…çš„è®°å½•'}</div>
                        <div>${data.transfers.length === 0 ? 'åˆ›å»ºè°ƒæ‹¨å•åè®°å½•å°†æ˜¾ç¤ºåœ¨æ­¤å¤„' : 'è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯'}</div>
                    </div>
                `;
                return;
            }
            
            let html = '<table class="table"><thead><tr><th>è°ƒæ‹¨å•å·</th><th>è°ƒå‡ºä»“åº“</th><th>è°ƒå…¥ä»“åº“</th><th>å•†å“SKU</th><th>å•†å“åç§°</th><th>æ•°é‡</th><th>åŸå› </th><th>æ—¶é—´</th></tr></thead><tbody>';
            
            filteredTransfers.forEach(transfer => {
                html += `
                    <tr>
                        <td>${transfer.id}</td>
                        <td>${transfer.fromWarehouseName}</td>
                        <td>${transfer.toWarehouseName}</td>
                        <td>${transfer.sku}</td>
                        <td>${transfer.productName}</td>
                        <td><span class="tag tag-primary">${transfer.quantity}</span></td>
                        <td>${transfer.reason}</td>
                        <td style="font-size: 12px; color: var(--text-light);">${transfer.time}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function filterTransfers() {
            renderTransferList();
        }

        function renderOutboundOrders() {
            const container = document.getElementById('outboundOrderList');
            
            if (data.outboundOrders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <div class="empty-state-title">æš‚æ— å‡ºåº“è®¢å•</div>
                        <div>åˆ›å»ºå‡ºåº“å•åè®°å½•å°†æ˜¾ç¤ºåœ¨æ­¤å¤„</div>
                    </div>
                `;
                return;
            }
            
            let html = '<table class="table"><thead><tr><th>è®¢å•å·</th><th>éƒ¨é—¨</th><th>æ¸ é“</th><th>è™šæ‹Ÿä»“</th><th>å•†å“æ•°é‡</th><th>åˆ›å»ºæ—¶é—´</th></tr></thead><tbody>';
            
            data.outboundOrders.forEach(order => {
                const productCount = order.products.reduce((sum, p) => sum + p.quantity, 0);
                html += `
                    <tr>
                        <td><span class="tag tag-success">${order.orderId}</span></td>
                        <td>${order.departmentName}</td>
                        <td><span class="tag tag-primary">${order.channel}</span></td>
                        <td>${order.warehouseName}</td>
                        <td>${productCount}</td>
                        <td style="font-size: 13px; color: var(--text-light);">${order.time}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        function filterOutboundOrders() {
            const searchTerm = document.getElementById('outboundOrderSearch')?.value?.toLowerCase() || '';
            
            const container = document.getElementById('outboundOrderList');
            
            const filteredOrders = searchTerm 
                ? data.outboundOrders.filter(o => o.orderId.toLowerCase().includes(searchTerm))
                : data.outboundOrders;
            
            if (filteredOrders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <div class="empty-state-title">${data.outboundOrders.length === 0 ? 'æš‚æ— å‡ºåº“è®¢å•' : 'æœªæ‰¾åˆ°åŒ¹é…çš„è®¢å•'}</div>
                        <div>${data.outboundOrders.length === 0 ? 'åˆ›å»ºå‡ºåº“å•åè®°å½•å°†æ˜¾ç¤ºåœ¨æ­¤å¤„' : 'è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯'}</div>
                    </div>
                `;
                return;
            }
            
            let html = '<table class="table"><thead><tr><th>è®¢å•å·</th><th>éƒ¨é—¨</th><th>æ¸ é“</th><th>è™šæ‹Ÿä»“</th><th>å•†å“æ•°é‡</th><th>åˆ›å»ºæ—¶é—´</th></tr></thead><tbody>';
            
            filteredOrders.forEach(order => {
                const productCount = order.products.reduce((sum, p) => sum + p.quantity, 0);
                html += `
                    <tr>
                        <td><span class="tag tag-success">${order.orderId}</span></td>
                        <td>${order.departmentName}</td>
                        <td><span class="tag tag-primary">${order.channel}</span></td>
                        <td>${order.warehouseName}</td>
                        <td>${productCount}</td>
                        <td style="font-size: 13px; color: var(--text-light);">${order.time}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        // å‡ºåº“å•ç›¸å…³å‡½æ•°
        function initOutboundPage() {
            renderOutboundOrders();
        }
        
        // åº“å­˜æŸ¥è¯¢ç›¸å…³å‡½æ•°
        function initInventoryPage() {
            loadInventoryWarehouses();
            filterInventory();
        }
        
        function loadInventoryWarehouses() {
            const select = document.getElementById('inventorySearchWarehouse');
            select.innerHTML = '<option value="">æ‰€æœ‰è™šæ‹Ÿä»“</option>';
            
            // æ·»åŠ æ€»ä»“åˆ†ç»„
            const companies = {};
            data.warehouses.forEach(warehouse => {
                if (warehouse.isMainWarehouse) {
                    if (!companies[warehouse.companyName]) {
                        companies[warehouse.companyName] = { mainWarehouse: null, departmentWarehouses: [] };
                    }
                    companies[warehouse.companyName].mainWarehouse = warehouse;
                } else {
                    if (!companies[warehouse.companyName]) {
                        companies[warehouse.companyName] = { mainWarehouse: null, departmentWarehouses: [] };
                    }
                    companies[warehouse.companyName].departmentWarehouses.push(warehouse);
                }
            });
            
            // æŒ‰å…¬å¸åˆ†ç»„æ˜¾ç¤º
            Object.keys(companies).forEach(companyName => {
                const group = companies[companyName];
                if (group.mainWarehouse) {
                    const option = document.createElement('option');
                    option.value = group.mainWarehouse.id;
                    option.textContent = `${companyName} - æ€»ä»“`;
                    option.dataset.isMainWarehouse = 'true';
                    select.appendChild(option);
                }
                
                group.departmentWarehouses.forEach(warehouse => {
                    const option = document.createElement('option');
                    option.value = warehouse.id;
                    option.textContent = `${companyName} - ${warehouse.departmentName} - ${warehouse.name}`;
                    select.appendChild(option);
                });
            });
        }
        
        function filterInventory() {
            const container = document.getElementById('inventoryList');
            const warehouseFilter = document.getElementById('inventorySearchWarehouse')?.value || '';
            const searchTerm = document.getElementById('inventorySearchSKU')?.value?.toLowerCase() || '';
            let viewTitle = 'å…¨éƒ¨è™šæ‹Ÿä»“åº“å­˜';
            
            let inventoryList = getAllInventory();
            
            // æŒ‰è™šæ‹Ÿä»“ç­›é€‰
            if (warehouseFilter) {
                const warehouse = data.warehouses.find(w => w.id === parseInt(warehouseFilter));
                if (warehouse) {
                    inventoryList = inventoryList.filter(item => item.warehouseId === parseInt(warehouseFilter));
                    viewTitle = `${warehouse.companyName} - ${warehouse.name} åº“å­˜`;
                }
            }
            
            // æŒ‰SKUæœç´¢
            if (searchTerm) {
                inventoryList = inventoryList.filter(item => item.sku.toLowerCase().includes(searchTerm));
            }
            
            // æ˜¾ç¤ºè§†å›¾æ ‡é¢˜
            let titleHtml = '';
            if (viewTitle) {
                titleHtml = `
                    <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white;">
                        <div style="font-size: 16px; font-weight: bold;">
                            <span style="margin-right: 10px;">ğŸ“Š</span>
                            ${viewTitle}
                        </div>
                        <div style="margin-top: 8px; font-size: 13px; opacity: 0.9;">
                            å…± ${inventoryList.length} æ¡åº“å­˜è®°å½•
                        </div>
                    </div>
                `;
            }
            
            if (inventoryList.length === 0) {
                container.innerHTML = `
                    ${titleHtml}
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“¦</div>
                        <div class="empty-state-title">æš‚æ— åº“å­˜è®°å½•</div>
                        <div>è¯·å…ˆè¿›è¡Œè°ƒæ‹¨æˆ–æ·»åŠ åº“å­˜</div>
                    </div>
                `;
                return;
            }
            
            // æŒ‰SKUåˆ†ç»„æ˜¾ç¤º
            const skuGroups = {};
            inventoryList.forEach(item => {
                if (!skuGroups[item.sku]) {
                    skuGroups[item.sku] = [];
                }
                skuGroups[item.sku].push(item);
            });
            
            let html = titleHtml + '<table class="table"><thead><tr><th>SKU</th><th>è™šæ‹Ÿä»“</th><th>å¯ç”¨åº“å­˜</th><th>é”å®šåº“å­˜</th><th>å¯å‡ºåº“åº“å­˜</th><th>æ€»åº“å­˜</th></tr></thead><tbody>';
            
            Object.keys(skuGroups).forEach(sku => {
                const items = skuGroups[sku];
                const totalStock = items.reduce((sum, item) => sum + item.quantity, 0);
                const totalLocked = items.reduce((sum, item) => sum + (data.warehouseLockedInventory[`${item.warehouseId}_${sku}`] || 0), 0);
                const totalOutboundAvailable = totalStock - totalLocked;
                
                items.forEach(item => {
                    const lockedQuantity = data.warehouseLockedInventory[`${item.warehouseId}_${sku}`] || 0;
                    const availableStock = item.quantity;
                    const outboundAvailable = availableStock - lockedQuantity;
                    
                    html += `
                        <tr>
                            <td><span class="tag tag-primary" style="font-size: 14px; padding: 5px 12px;">${sku}</span></td>
                            <td>${item.warehouseName}</td>
                            <td><span class="inventory-count" style="color: var(--success-color);">${availableStock}</span></td>
                            <td><span style="font-weight: bold; color: var(--warning-color);">${lockedQuantity}</span></td>
                            <td><span class="inventory-count" style="color: ${outboundAvailable > 0 ? 'var(--primary-color)' : 'var(--text-light)'};">${outboundAvailable}</span></td>
                            <td style="color: var(--text-light);">${availableStock}</td>
                        </tr>
                    `;
                });
                
                // æ·»åŠ æ±‡æ€»è¡Œ
                html += `
                    <tr style="background: #f0f5ff; font-weight: bold;">
                        <td colspan="2">SKU ${sku} æ±‡æ€»</td>
                        <td style="color: var(--success-color);">${totalStock}</td>
                        <td style="color: var(--warning-color);">${totalLocked}</td>
                        <td style="color: var(--primary-color);">${totalOutboundAvailable}</td>
                        <td style="color: var(--text-light);">${totalStock}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        // åº“å­˜é”å®šç®¡ç†ç›¸å…³å‡½æ•°
        let lockModalData = {
            warehouseId: null,
            warehouseName: null,
            locks: []
        };
        
        function initLockPage() {
            renderLockList();
        }
        
        function openCreateLockModal() {
            // é‡ç½®å¼¹çª—æ•°æ®
            lockModalData = {
                warehouseId: null,
                warehouseName: null,
                locks: []
            };
            
            // åŠ è½½è™šæ‹Ÿä»“é€‰é¡¹
            const warehouseSelect = document.getElementById('lockWarehouseSelect');
            warehouseSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è™šæ‹Ÿä»“</option>';
            
            data.warehouses.forEach(warehouse => {
                const option = document.createElement('option');
                option.value = warehouse.id;
                option.textContent = `${warehouse.companyName} > ${warehouse.departmentName} > ${warehouse.name}`;
                option.dataset.warehouseName = warehouse.name;
                warehouseSelect.appendChild(option);
            });

            // é‡ç½®å…¶ä»–é€‰æ‹©æ¡†
            const lockSKUSelect = document.getElementById('lockSKUSelect');
            if (lockSKUSelect) {
                lockSKUSelect.innerHTML = '<option value="">è¯·å…ˆé€‰æ‹©è™šæ‹Ÿä»“</option>';
                lockSKUSelect.disabled = true;
            }

            const lockQuantity = document.getElementById('lockQuantity');
            if (lockQuantity) {
                lockQuantity.value = '';
            }

            const lockType = document.getElementById('lockType');
            if (lockType) {
                lockType.value = 'é¢„å”®';
            }

            const lockRemark = document.getElementById('lockRemark');
            if (lockRemark) {
                lockRemark.value = '';
            }

            const lockStockInfo = document.getElementById('lockStockInfo');
            if (lockStockInfo) {
                lockStockInfo.style.display = 'none';
            }

            // æ¸…ç©ºå·²æ·»åŠ é”å®šåˆ—è¡¨
            renderLockProductList();

            // æ‰“å¼€å¼¹çª—
            document.getElementById('createLockModal').classList.add('active');
        }
        
        function handleLockWarehouseChange() {
            const warehouseSelect = document.getElementById('lockWarehouseSelect');
            const skuSelect = document.getElementById('lockSKUSelect');

            // é‡ç½®SKUå’Œé”å®šä¿¡æ¯
            lockModalData.warehouseId = null;
            lockModalData.warehouseName = null;

            const selectedWarehouseId = parseInt(warehouseSelect.value);

            if (selectedWarehouseId) {
                const warehouse = data.warehouses.find(w => w.id === selectedWarehouseId);
                if (warehouse) {
                    lockModalData.warehouseId = warehouse.id;
                    lockModalData.warehouseName = warehouse.name;

                    // åŠ è½½è¯¥è™šæ‹Ÿä»“çš„å¯ç”¨SKUï¼ˆæ’é™¤å·²é”å®šçš„ï¼‰
                    const warehouseInventory = getWarehouseInventory(warehouse.id);
                    const skus = Object.keys(warehouseInventory).filter(sku => warehouseInventory[sku] > 0);

                    if (skuSelect) {
                        skuSelect.innerHTML = '<option value="">è¯·é€‰æ‹©SKU</option>';
                        skus.forEach(sku => {
                            const option = document.createElement('option');
                            option.value = sku;
                            option.dataset.availableStock = warehouseInventory[sku];

                            // è®¡ç®—å·²é”å®šæ•°é‡
                            const lockedQuantity = data.warehouseLockedInventory[`${warehouse.id}_${sku}`] || 0;
                            const availableAfterLock = warehouseInventory[sku] - lockedQuantity;

                            option.textContent = `${sku} (å¯ç”¨: ${availableAfterLock}, å·²é”å®š: ${lockedQuantity})`;
                            skuSelect.appendChild(option);
                        });

                        skuSelect.disabled = false;
                    }

                    const lockStockInfo = document.getElementById('lockStockInfo');
                    if (lockStockInfo) {
                        lockStockInfo.style.display = 'none';
                    }
                }
            } else {
                if (skuSelect) {
                    skuSelect.innerHTML = '<option value="">è¯·å…ˆé€‰æ‹©è™šæ‹Ÿä»“</option>';
                    skuSelect.disabled = true;
                }
                const lockStockInfo = document.getElementById('lockStockInfo');
                if (lockStockInfo) {
                    lockStockInfo.style.display = 'none';
                }
            }
        }
        
        function handleLockSKUChange() {
            const skuSelect = document.getElementById('lockSKUSelect');
            const selectedOption = skuSelect.options[skuSelect.selectedIndex];
            
            if (selectedOption && selectedOption.value) {
                const sku = selectedOption.value;
                const availableStock = parseInt(selectedOption.dataset.availableStock);
                const lockedQuantity = data.warehouseLockedInventory[`${lockModalData.warehouseId}_${sku}`] || 0;
                
                document.getElementById('lockAvailableStock').textContent = availableStock;
                document.getElementById('lockCurrentLocked').textContent = lockedQuantity;
                document.getElementById('lockStockInfo').style.display = 'block';
                
                // è®¾ç½®æœ€å¤§å¯é”å®šæ•°é‡
                document.getElementById('lockQuantity').max = availableStock - lockedQuantity;
                document.getElementById('lockQuantity').placeholder = `æœ€å¤§å¯é”å®šæ•°é‡: ${availableStock - lockedQuantity}`;
            } else {
                document.getElementById('lockStockInfo').style.display = 'none';
            }
        }
        
        function addLockToProductList() {
            const skuSelect = document.getElementById('lockSKUSelect');
            const quantityInput = document.getElementById('lockQuantity');
            const typeInput = document.getElementById('lockType');
            const remarkInput = document.getElementById('lockRemark');
            
            const selectedOption = skuSelect.options[skuSelect.selectedIndex];
            
            if (!selectedOption || !selectedOption.value) {
                showToast('warning', 'è¯·å…ˆé€‰æ‹©SKU');
                return;
            }
            
            const quantity = parseInt(quantityInput.value);
            if (!quantity || quantity <= 0) {
                showToast('warning', 'è¯·è¾“å…¥æœ‰æ•ˆçš„é”å®šæ•°é‡');
                return;
            }
            
            const availableStock = parseInt(selectedOption.dataset.availableStock);
            const lockedQuantity = data.warehouseLockedInventory[`${lockModalData.warehouseId}_${selectedOption.value}`] || 0;
            
            if (lockedQuantity + quantity > availableStock) {
                showToast('error', `é”å®šæ•°é‡ä¸èƒ½è¶…è¿‡å¯ç”¨åº“å­˜ ${availableStock}`);
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²æ·»åŠ è¯¥SKU
            const existingLock = lockModalData.locks.find(l => l.sku === selectedOption.value);
            if (existingLock) {
                const newTotal = existingLock.quantity + quantity;
                if (newTotal > availableStock) {
                    showToast('error', `SKU ${selectedOption.value} çš„æ€»é”å®šæ•°é‡ä¸èƒ½è¶…è¿‡å¯ç”¨åº“å­˜ ${availableStock}`);
                    return;
                }
                existingLock.quantity = newTotal;
                existingLock.remark = remarkInput.value.trim();
            } else {
                lockModalData.locks.push({
                    sku: selectedOption.value,
                    quantity: quantity,
                    type: typeInput.value,
                    remark: remarkInput.value.trim()
                });
            }
            
            // æ¸…ç©ºè¾“å…¥
            quantityInput.value = '';
            remarkInput.value = '';
            
            renderLockProductList();
            showToast('success', 'é”å®šæ·»åŠ æˆåŠŸï¼');
        }

        function removeLockFromProductList(index) {
            lockModalData.locks.splice(index, 1);
            renderLockProductList();
        }

        function addLockRow() {
            const warehouseSelect = document.getElementById('lockWarehouseSelect');
            if (!warehouseSelect.value) {
                showToast('warning', 'è¯·å…ˆé€‰æ‹©è™šæ‹Ÿä»“');
                return;
            }

            // Add a new empty lock to the data
            lockModalData.locks.push({
                sku: '',
                quantity: 1,
                type: 'é¢„å”®',
                remark: '',
                availableStock: 0,
                lockedStock: 0
            });

            renderLockProductList();
        }

        function updateLockRow(index, field, value) {
            if (field === 'sku') {
                // When SKU changes, update available stock info
                const warehouseId = lockModalData.warehouseId;
                const inventoryKey = `${warehouseId}_${value}`;
                const quantity = data.warehouseInventory[inventoryKey];

                if (quantity !== undefined) {
                    lockModalData.locks[index].availableStock = quantity;
                    const lockedKey = `${warehouseId}_${value}`;
                    lockModalData.locks[index].lockedStock = data.warehouseLockedInventory[lockedKey] || 0;
                }
            }

            lockModalData.locks[index][field] = value;
            renderLockProductList();
        }

        function renderLockProductList() {
            const tbody = document.getElementById('lockTableBody');
            const emptyRow = document.getElementById('lockEmptyRow');

            if (lockModalData.locks.length === 0) {
                emptyRow.style.display = '';
                document.getElementById('lockTotalCount').textContent = '0';
                return;
            }

            emptyRow.style.display = 'none';

            // Remove existing data rows (keep empty row)
            const existingRows = tbody.querySelectorAll('tr:not(#lockEmptyRow)');
            existingRows.forEach(row => row.remove());

            const warehouseId = lockModalData.warehouseId;
            const warehouseInventory = getWarehouseInventory(warehouseId);
            const availableSKUs = Object.keys(warehouseInventory).map(sku => ({
                sku: sku,
                quantity: warehouseInventory[sku],
                locked: data.warehouseLockedInventory[`${warehouseId}_${sku}`] || 0
            }));

            lockModalData.locks.forEach((lock, index) => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid var(--border-color)';

                // SKU column with dropdown
                const skuOptions = availableSKUs.map(item =>
                    `<option value="${item.sku}" ${lock.sku === item.sku ? 'selected' : ''}>${item.sku}</option>`
                ).join('');

                row.innerHTML = `
                    <td style="padding: 12px;">
                        <select class="form-control" onchange="updateLockRow(${index}, 'sku', this.value)" style="font-size: 13px;">
                            <option value="">è¯·é€‰æ‹©SKU</option>
                            ${skuOptions}
                        </select>
                    </td>
                    <td style="padding: 12px;">
                        <select class="form-control" onchange="updateLockRow(${index}, 'type', this.value)" style="font-size: 13px;">
                            <option value="é¢„å”®" ${lock.type === 'é¢„å”®' ? 'selected' : ''}>é¢„å”®é”åº“</option>
                            <option value="æ´»åŠ¨" ${lock.type === 'æ´»åŠ¨' ? 'selected' : ''}>æ´»åŠ¨å¤‡è´§</option>
                            <option value="å®‰å…¨" ${lock.type === 'å®‰å…¨' ? 'selected' : ''}>å®‰å…¨åº“å­˜</option>
                            <option value="å…¶ä»–" ${lock.type === 'å…¶ä»–' ? 'selected' : ''}>å…¶ä»–</option>
                        </select>
                    </td>
                    <td style="padding: 12px;">
                        <input type="number" class="form-control" value="${lock.quantity}" min="1"
                            onchange="updateLockRow(${index}, 'quantity', parseInt(this.value))"
                            style="font-size: 13px; width: 80px;">
                    </td>
                    <td style="padding: 12px; color: var(--success-color); font-weight: 500;">
                        ${lock.availableStock || 0}
                    </td>
                    <td style="padding: 12px; color: var(--warning-color); font-weight: 500;">
                        ${lock.lockedStock || 0}
                    </td>
                    <td style="padding: 12px;">
                        <input type="text" class="form-control" value="${lock.remark || ''}"
                            onchange="updateLockRow(${index}, 'remark', this.value)"
                            placeholder="å¤‡æ³¨" style="font-size: 13px;">
                    </td>
                    <td style="padding: 12px; text-align: center;">
                        <button class="btn btn-danger btn-sm" onclick="removeLockFromProductList(${index})"
                            style="padding: 4px 8px; font-size: 16px; line-height: 1;">Ã—</button>
                    </td>
                `;

                tbody.appendChild(row);
            });

            const totalCount = lockModalData.locks.reduce((sum, l) => sum + (parseInt(l.quantity) || 0), 0);
            document.getElementById('lockTotalCount').textContent = totalCount;
        }
        
        function createLock() {
            if (lockModalData.locks.length === 0) {
                showToast('warning', 'è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªé”å®šè®°å½•');
                return;
            }

            // Validate all rows have required data
            for (let i = 0; i < lockModalData.locks.length; i++) {
                const lock = lockModalData.locks[i];
                if (!lock.sku) {
                    showToast('warning', `ç¬¬ ${i + 1} è¡Œï¼šè¯·é€‰æ‹©SKU`);
                    return;
                }
                if (!lock.quantity || lock.quantity <= 0) {
                    showToast('warning', `ç¬¬ ${i + 1} è¡Œï¼šè¯·è¾“å…¥æœ‰æ•ˆçš„é”å®šæ•°é‡`);
                    return;
                }
                // Validate quantity doesn't exceed available stock
                if (lock.quantity > lock.availableStock) {
                    showToast('error', `ç¬¬ ${i + 1} è¡Œï¼šé”å®šæ•°é‡ä¸èƒ½è¶…è¿‡å¯ç”¨åº“å­˜ ${lock.availableStock}`);
                    return;
                }
            }

            const warehouse = data.warehouses.find(w => w.id === lockModalData.warehouseId);
            if (!warehouse) {
                showToast('error', 'æœªæ‰¾åˆ°åŒ¹é…çš„è™šæ‹Ÿä»“');
                return;
            }

            // æ‰¹é‡åˆ›å»ºé”å®šè®°å½•
            simulateAsync(() => {
                lockModalData.locks.forEach(lock => {
                    const key = `${warehouse.id}_${lock.sku}`;
                    const currentLocked = data.warehouseLockedInventory[key] || 0;
                    data.warehouseLockedInventory[key] = currentLocked + lock.quantity;

                    // æ·»åŠ åˆ°é”å®šåˆ—è¡¨
                    data.locks.push({
                        id: Date.now() + Math.random(),
                        warehouseId: warehouse.id,
                        warehouseName: warehouse.name,
                        sku: lock.sku,
                        quantity: lock.quantity,
                        type: lock.type,
                        remark: lock.remark,
                        time: new Date().toLocaleString()
                    });
                });

                closeModal('createLockModal');
                renderLockList();
                showToast('success', `æˆåŠŸåˆ›å»º ${lockModalData.locks.length} æ¡é”å®šè®°å½•ï¼`);
            }, 600);
        }
        
        function renderLockList() {
            const container = document.getElementById('lockList');
            
            if (!data.locks || data.locks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ”’</div>
                        <div class="empty-state-title">æš‚æ— é”å®šè®°å½•</div>
                        <div>åˆ›å»ºé”å®šè®°å½•åå°†åœ¨æ­¤æ˜¾ç¤º</div>
                    </div>
                `;
                return;
            }
            
            let html = '<table class="table"><thead><tr><th>SKU</th><th>è™šæ‹Ÿä»“</th><th>é”å®šæ•°é‡</th><th>ç±»å‹</th><th>å¤‡æ³¨</th><th>åˆ›å»ºæ—¶é—´</th><th>æ“ä½œ</th></tr></thead><tbody>';
            
            data.locks.forEach(lock => {
                const warehouse = data.warehouses.find(w => w.id === lock.warehouseId);
                const typeColors = {
                    'é¢„å”®': 'primary',
                    'æ´»åŠ¨': 'warning',
                    'å®‰å…¨': 'danger',
                    'å…¶ä»–': 'info'
                };
                const tagColor = typeColors[lock.type] || 'info';
                
                html += `
                    <tr>
                        <td><span class="tag tag-primary" style="font-size: 14px; padding: 5px 12px;">${lock.sku}</span></td>
                        <td>${warehouse ? warehouse.name : '-'}</td>
                        <td><span style="font-weight: bold; color: var(--warning-color);">${lock.quantity}</span></td>
                        <td><span class="tag tag-${tagColor}">${lock.type}</span></td>
                        <td style="color: var(--text-light);">${lock.remark || '-'}</td>
                        <td style="font-size: 13px; color: var(--text-light);">${lock.time}</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="unlockInventory(${lock.id})">
                                <span>ğŸ”“</span>
                                <span>è§£é”</span>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        function unlockInventory(lockId) {
            const lockIndex = data.locks.findIndex(l => l.id === lockId);
            if (lockIndex === -1) {
                showToast('error', 'æœªæ‰¾åˆ°é”å®šè®°å½•');
                return;
            }
            
            const lock = data.locks[lockIndex];
            
            if (!confirm(`ç¡®å®šè¦è§£é” ${lock.sku} çš„ ${lock.quantity} ä»¶åº“å­˜å—ï¼Ÿ`)) {
                return;
            }
            
            simulateAsync(() => {
                const key = `${lock.warehouseId}_${lock.sku}`;
                const currentLocked = data.warehouseLockedInventory[key] || 0;
                
                // ç¡®ä¿ä¸ä¼šè§£é”è¶…è¿‡å·²é”å®šçš„æ•°é‡
                if (lock.quantity > currentLocked) {
                    lock.quantity = currentLocked;
                }
                
                data.warehouseLockedInventory[key] = Math.max(0, currentLocked - lock.quantity);
                
                // åˆ é™¤é”å®šè®°å½•
                data.locks.splice(lockIndex, 1);
                
                renderLockList();
                showToast('success', `SKU ${lock.sku} å·²æˆåŠŸè§£é” ${lock.quantity} ä»¶åº“å­˜ï¼`);
            }, 400);
        }
        
        // å‡ºåº“å•å¼¹çª—ç›¸å…³å‡½æ•°
        let outboundModalData = {
            departmentId: null,
            departmentName: null,
            channelId: null,
            channelName: null,
            warehouseId: null,
            warehouseName: null,
            products: []
        };
        
        function openCreateOutboundModal() {
            // é‡ç½®å¼¹çª—æ•°æ®
            outboundModalData = {
                departmentId: null,
                departmentName: null,
                channelId: null,
                channelName: null,
                warehouseId: null,
                warehouseName: null,
                products: []
            };

            // é‡ç½®ä»“åº“ç±»å‹é€‰æ‹©
            document.getElementById('outboundWarehouseType').value = '';

            // éšè—æ‰€æœ‰é€‰æ‹©åŒºåŸŸ
            document.getElementById('channelWarehouseArea').style.display = 'none';
            document.getElementById('departmentWarehouseArea').style.display = 'none';

            // åŠ è½½æ¸ é“ä»“é€‰é¡¹ï¼ˆç›´æ¥åŠ è½½æ‰€æœ‰æ¸ é“ä»“ï¼‰
            const channelWarehouseSelect = document.getElementById('outboundChannelWarehouseSelect');
            channelWarehouseSelect.innerHTML = '<option value="">è¯·é€‰æ‹©æ¸ é“ä»“</option>';

            const channelWarehouses = data.warehouses.filter(w =>
                w.type === 'channel' && !w.isMainWarehouse
            );

            channelWarehouses.forEach(warehouse => {
                const option = document.createElement('option');
                option.value = warehouse.id;
                option.textContent = `${warehouse.channel} - ${warehouse.name}`;
                channelWarehouseSelect.appendChild(option);
            });

            // åŠ è½½è™šæ‹Ÿä»“é€‰é¡¹ï¼ˆç›´æ¥åŠ è½½æ‰€æœ‰è™šæ‹Ÿä»“ï¼‰
            const departmentWarehouseSelect = document.getElementById('outboundDepartmentWarehouseSelect');
            departmentWarehouseSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è™šæ‹Ÿä»“</option>';

            const departmentWarehouses = data.warehouses.filter(w =>
                w.type === 'department' && !w.isMainWarehouse
            );

            departmentWarehouses.forEach(warehouse => {
                const company = data.companies.find(c => c.id === warehouse.companyId);
                const department = company?.departments.find(d => d.id === warehouse.departmentId);

                if (company && department) {
                    const option = document.createElement('option');
                    option.value = warehouse.id;
                    option.textContent = `${company.name} - ${department.name} - ${warehouse.name}`;
                    departmentWarehouseSelect.appendChild(option);
                }
            });

            // æ¸…ç©ºå·²æ·»åŠ å•†å“åˆ—è¡¨
            renderOutboundProductList();

            // æ‰“å¼€å¼¹çª—
            document.getElementById('createOutboundModal').classList.add('active');
        }

        // å¤„ç†ä»“åº“ç±»å‹é€‰æ‹©å˜åŒ–
        function handleWarehouseTypeChange() {
            const warehouseType = document.getElementById('outboundWarehouseType').value;
            const channelArea = document.getElementById('channelWarehouseArea');
            const departmentArea = document.getElementById('departmentWarehouseArea');

            // é‡ç½®æ•°æ®
            outboundModalData.warehouseId = null;
            outboundModalData.warehouseName = null;
            outboundModalData.departmentId = null;
            outboundModalData.departmentName = null;
            outboundModalData.channelId = null;
            outboundModalData.channelName = null;

            // æ ¹æ®é€‰æ‹©æ˜¾ç¤ºå¯¹åº”åŒºåŸŸ
            if (warehouseType === 'channel') {
                channelArea.style.display = 'block';
                departmentArea.style.display = 'none';
                // é‡ç½®æ¸ é“ä»“é€‰æ‹©
                document.getElementById('outboundChannelWarehouseSelect').value = '';
            } else if (warehouseType === 'department') {
                channelArea.style.display = 'none';
                departmentArea.style.display = 'block';
                // é‡ç½®è™šæ‹Ÿä»“é€‰æ‹©
                document.getElementById('outboundDepartmentWarehouseSelect').value = '';
            } else {
                channelArea.style.display = 'none';
                departmentArea.style.display = 'none';
            }
        }


        // å¤„ç†æœ€ç»ˆä»“åº“é€‰æ‹©ï¼ˆæ¸ é“ä»“æˆ–è™šæ‹Ÿä»“ï¼‰
        function handleFinalWarehouseChange() {
            const warehouseType = document.getElementById('outboundWarehouseType').value;
            let warehouseId = null;

            if (warehouseType === 'channel') {
                const warehouseSelect = document.getElementById('outboundChannelWarehouseSelect');
                warehouseId = warehouseSelect.value ? parseInt(warehouseSelect.value) : null;
            } else if (warehouseType === 'department') {
                const warehouseSelect = document.getElementById('outboundDepartmentWarehouseSelect');
                warehouseId = warehouseSelect.value ? parseInt(warehouseSelect.value) : null;
            }

            // é‡ç½®ä»“åº“æ•°æ®
            outboundModalData.warehouseId = null;
            outboundModalData.warehouseName = null;
            outboundModalData.channelId = null;
            outboundModalData.channelName = null;
            outboundModalData.departmentId = null;
            outboundModalData.departmentName = null;

            if (warehouseId) {
                const warehouse = data.warehouses.find(w => w.id === warehouseId);

                if (warehouse) {
                    outboundModalData.warehouseId = warehouse.id;
                    outboundModalData.warehouseName = warehouse.name;

                    if (warehouse.type === 'channel') {
                        // æ¸ é“ä»“ï¼šä¿å­˜æ¸ é“ä¿¡æ¯
                        outboundModalData.channelId = warehouse.channel;
                        outboundModalData.channelName = warehouse.channel;
                    } else if (warehouse.type === 'department') {
                        // è™šæ‹Ÿä»“ï¼šä¿å­˜éƒ¨é—¨ä¿¡æ¯
                        outboundModalData.departmentId = warehouse.departmentId;
                        const company = data.companies.find(c => c.id === warehouse.companyId);
                        const department = company?.departments.find(d => d.id === warehouse.departmentId);
                        if (department) {
                            outboundModalData.departmentName = department.name;
                            outboundModalData.companyId = warehouse.companyId;
                            outboundModalData.companyName = company.name;
                        }
                    }
                }
            }
        }

        function removeOutboundProduct(index) {
            outboundModalData.products.splice(index, 1);
            renderOutboundProductList();
        }

        function addOutboundRow() {
            // éªŒè¯æ˜¯å¦å·²é€‰æ‹©å‘è´§ä»“
            if (!outboundModalData.warehouseId) {
                showToast('warning', 'è¯·å…ˆé€‰æ‹©å‘è´§ä»“');
                return;
            }

            // Add a new empty product to the data
            outboundModalData.products.push({
                sku: '',
                name: '',
                quantity: 1,
                remark: '',
                availableStock: 0
            });

            renderOutboundProductList();
        }

        function updateOutboundRow(index, field, value) {
            if (field === 'sku') {
                // When SKU changes, update product name and available stock
                const warehouseId = outboundModalData.warehouseId;
                const inventoryKey = `${warehouseId}_${value}`;
                const quantity = data.warehouseInventory[inventoryKey];

                if (quantity !== undefined) {
                    outboundModalData.products[index].name = value;
                    const lockedKey = `${warehouseId}_${value}`;
                    const locked = data.warehouseLockedInventory[lockedKey] || 0;
                    outboundModalData.products[index].availableStock = quantity - locked;
                }
            }

            outboundModalData.products[index][field] = value;
            renderOutboundProductList();
        }

        function renderOutboundProductList() {
            const tbody = document.getElementById('outboundTableBody');
            const emptyRow = document.getElementById('outboundEmptyRow');

            if (outboundModalData.products.length === 0) {
                emptyRow.style.display = '';
                document.getElementById('outboundTotalCount').textContent = '0';
                return;
            }

            emptyRow.style.display = 'none';

            // Remove existing data rows (keep empty row)
            const existingRows = tbody.querySelectorAll('tr:not(#outboundEmptyRow)');
            existingRows.forEach(row => row.remove());

            const warehouseId = outboundModalData.warehouseId;
            const warehouseInventory = getWarehouseInventory(warehouseId);
            const availableSKUs = Object.keys(warehouseInventory).map(sku => {
                const lockedKey = `${warehouseId}_${sku}`;
                const locked = data.warehouseLockedInventory[lockedKey] || 0;
                const quantity = warehouseInventory[sku];
                return {
                    sku: sku,
                    name: sku,
                    quantity: quantity,
                    available: quantity - locked
                };
            });

            outboundModalData.products.forEach((product, index) => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid var(--border-color)';

                // SKU column with dropdown
                const skuOptions = availableSKUs.map(item =>
                    `<option value="${item.sku}" ${product.sku === item.sku ? 'selected' : ''}>${item.sku}</option>`
                ).join('');

                row.innerHTML = `
                    <td style="padding: 12px;">
                        <select class="form-control" onchange="updateOutboundRow(${index}, 'sku', this.value)" style="font-size: 13px;">
                            <option value="">è¯·é€‰æ‹©SKU</option>
                            ${skuOptions}
                        </select>
                    </td>
                    <td style="padding: 12px; color: var(--text-color);">
                        ${product.name || '-'}
                    </td>
                    <td style="padding: 12px;">
                        <input type="number" class="form-control" value="${product.quantity}" min="1"
                            onchange="updateOutboundRow(${index}, 'quantity', parseInt(this.value))"
                            style="font-size: 13px; width: 80px;">
                    </td>
                    <td style="padding: 12px; color: var(--success-color); font-weight: 500;">
                        ${product.availableStock || 0}
                    </td>
                    <td style="padding: 12px;">
                        <input type="text" class="form-control" value="${product.remark || ''}"
                            onchange="updateOutboundRow(${index}, 'remark', this.value)"
                            placeholder="å¤‡æ³¨" style="font-size: 13px;">
                    </td>
                    <td style="padding: 12px; text-align: center;">
                        <button class="btn btn-danger btn-sm" onclick="removeOutboundProduct(${index})"
                            style="padding: 4px 8px; font-size: 16px; line-height: 1;">Ã—</button>
                    </td>
                `;

                tbody.appendChild(row);
            });

            const totalCount = outboundModalData.products.reduce((sum, p) => sum + (parseInt(p.quantity) || 0), 0);
            document.getElementById('outboundTotalCount').textContent = totalCount;
        }
        
        function submitOutboundOrderFromModal() {
            // éªŒè¯æ˜¯å¦é€‰æ‹©äº†å‘è´§ä»“
            if (!outboundModalData.warehouseId) {
                showToast('warning', 'è¯·å…ˆé€‰æ‹©å‘è´§ä»“');
                return;
            }

            if (outboundModalData.products.length === 0) {
                showToast('warning', 'è¯·è‡³å°‘æ·»åŠ ä¸€ä»¶å•†å“');
                return;
            }
            
            const matchedWarehouse = data.warehouses.find(w => w.id === outboundModalData.warehouseId);
            if (!matchedWarehouse) {
                showToast('error', 'æœªæ‰¾åˆ°åŒ¹é…çš„è™šæ‹Ÿä»“');
                return;
            }
            
            // æ£€æŸ¥åº“å­˜æ˜¯å¦è¶³å¤Ÿï¼ˆè€ƒè™‘é”å®šåº“å­˜ï¼‰
            for (const product of outboundModalData.products) {
                const key = matchedWarehouse.id + '_' + product.sku;
                const stock = data.warehouseInventory[key] || 0;
                const lockedQuantity = data.warehouseLockedInventory[key] || 0;
                const outboundAvailable = stock - lockedQuantity;
                
                if (outboundAvailable < product.quantity) {
                    showToast('error', `å•†å“ ${product.sku} å¯å‡ºåº“åº“å­˜ä¸è¶³ï¼å¯ç”¨åº“å­˜: ${stock}, å·²é”å®š: ${lockedQuantity}, å¯å‡ºåº“: ${outboundAvailable}`);
                    return;
                }
            }
            
            const totalQuantity = outboundModalData.products.reduce((sum, p) => sum + p.quantity, 0);
            
            simulateAsync(() => {
                // å°†SKUåº“å­˜ä»å¯ç”¨è½¬ä¸ºé”å®š
                outboundModalData.products.forEach(product => {
                    const key = matchedWarehouse.id + '_' + product.sku;
                    const stock = data.warehouseInventory[key] || 0;
                    data.warehouseInventory[key] = stock - product.quantity;
                    data.warehouseLockedInventory[key] = (data.warehouseLockedInventory[key] || 0) + product.quantity;
                });
                
                // ç”Ÿæˆå‡ºåº“å•å·
                const orderId = 'OB-' + new Date().toISOString().slice(0, 10).replace(/-/g, '') + '-' + String(Math.floor(Math.random() * 1000)).padStart(3, '0');
                
                // ä¿å­˜å‡ºåº“è®¢å•è®°å½•
                data.outboundOrders.push({
                    orderId: orderId,
                    warehouseId: matchedWarehouse.id,
                    warehouseName: matchedWarehouse.name,
                    departmentId: outboundModalData.departmentId,
                    departmentName: outboundModalData.departmentName,
                    channel: outboundModalData.channelName,
                    products: [...outboundModalData.products],
                    totalQuantity: totalQuantity,
                    time: new Date().toLocaleString()
                });
                
                // æ˜¾ç¤ºæˆåŠŸå¼¹çª—
                document.getElementById('outboundOrderId').textContent = orderId;
                document.getElementById('outboundWarehouseName').textContent = matchedWarehouse.name;
                document.getElementById('outboundDepartmentName').textContent = outboundModalData.departmentName;
                document.getElementById('outboundChannelName').textContent = outboundModalData.channelName;
                document.getElementById('outboundProductCount').textContent = totalQuantity + ' ä»¶';
                
                closeModal('createOutboundModal');
                document.getElementById('successModal').classList.add('active');
                renderOutboundOrders();
                showToast('success', 'å‡ºåº“å•åˆ›å»ºæˆåŠŸï¼åº“å­˜å·²æ‰£å‡');
                return true;
            }, 600);
        }
        
        function findWarehouse(departmentId, channel) {
            // ä¼˜å…ˆæŸ¥æ‰¾ç»‘å®šè¯¥æ¸ é“çš„è™šæ‹Ÿä»“
            let warehouse = data.warehouses.find(w => w.departmentId === departmentId && w.bindChannel && w.channel === channel);
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼ŒæŸ¥æ‰¾æœªç»‘å®šæ¸ é“çš„è™šæ‹Ÿä»“
            if (!warehouse) {
                warehouse = data.warehouses.find(w => w.departmentId === departmentId && !w.bindChannel);
            }
            
            return warehouse;
        }
        
        // æ¨¡æ€æ¡†æ“ä½œ
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // æ»šåŠ¨åˆ°é¡¶éƒ¨
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // ç›‘å¬æ»šåŠ¨æ˜¾ç¤º/éšè—å›åˆ°é¡¶éƒ¨æŒ‰é’®
        function initBackToTopButton() {
            const backToTopBtn = document.getElementById('backToTop');
            
            window.addEventListener('scroll', function() {
                if (window.scrollY > 300) {
                    backToTopBtn.style.display = 'block';
                    backToTopBtn.style.animation = 'fadeIn 0.3s ease-out';
                } else {
                    backToTopBtn.style.display = 'none';
                }
            });
        }
        
        // é”®ç›˜å¿«æ·é”®æ”¯æŒ
        function initKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // ESCé”®å…³é—­æ‰€æœ‰æ¨¡æ€æ¡†
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.active').forEach(modal => {
                        modal.classList.remove('active');
                    });
                    document.querySelectorAll('.toast').forEach(toast => {
                        toast.classList.add('hide');
                        setTimeout(() => toast.remove(), 300);
                    });
                }
                
                // Enteré”®åœ¨è¡¨å•ä¸­æäº¤ï¼ˆå¦‚æœä¸æ˜¯åœ¨textareaä¸­ï¼‰
                if (e.key === 'Enter' && !e.target.matches('textarea')) {
                    const activeModal = document.querySelector('.modal.active');
                    if (activeModal) {
                        const submitBtn = activeModal.querySelector('.btn-primary, .btn-success');
                        if (submitBtn) {
                            submitBtn.click();
                        }
                    }
                }
            });
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        function initModalClickOutside() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this.id);
                    }
                });
            });
        }
        
        // æ·»åŠ å¹³æ»‘æ»šåŠ¨
        function smoothScrollToContent() {
            const pageContents = document.querySelectorAll('.page-content');
            pageContents.forEach(content => {
                content.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
            });
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–ç¤ºä¾‹åº“å­˜æ•°æ®
            initSampleInventoryData();
            
            renderOrgTreeView();
            updateStatistics();
            initKeyboardShortcuts();
            initModalClickOutside();
            smoothScrollToContent();
            initBackToTopButton();
            
            // æ¬¢è¿æç¤º
            setTimeout(() => {
                showToast('info', 'æ¬¢è¿ä½¿ç”¨ELSAï¼', 4000);
            }, 500);
        });
        
        // åˆå§‹åŒ–ç¤ºä¾‹åº“å­˜æ•°æ®
        function initSampleInventoryData() {
            // ä¸ºæ¯ä¸ªå…¬å¸åˆ›å»ºé»˜è®¤æ€»ä»“ï¼ˆ1çº§éƒ¨é—¨å¯¹åº”çš„æ€»ä»“ï¼‰
            data.companies.forEach(company => {
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥å…¬å¸çš„æ€»ä»“
                const existingMainWarehouse = data.warehouses.find(
                    w => w.companyId === company.id && w.isMainWarehouse === true
                );
                
                if (!existingMainWarehouse) {
                    // åˆ›å»ºå…¬å¸æ€»ä»“ï¼ˆå¯¹åº”1çº§éƒ¨é—¨ï¼ŒdepartmentIdè®¾ä¸º0è¡¨ç¤ºæ€»ä»“ï¼‰
                    const mainWarehouse = {
                        id: Date.now() + Math.random() * 1000,
                        name: `${company.name} - æ€»ä»“`,
                        companyId: company.id,
                        companyName: company.name,
                        departmentId: 0,  // 0è¡¨ç¤ºæ€»ä»“
                        departmentName: 'æ€»ä»“',
                        bindChannel: false,
                        channel: null,
                        inventory: 10000,  // æ€»ä»“åˆå§‹åº“å­˜
                        isMainWarehouse: true  // æ ‡è®°ä¸ºæ€»ä»“
                    };
                    data.warehouses.push(mainWarehouse);
                }
            });

            // ä¸ºéƒ¨é—¨åˆ›å»ºç¤ºä¾‹è™šæ‹Ÿä»“ï¼ˆéƒ¨é—¨ä»“ï¼‰
            const sampleWarehouses = [
                {
                    id: Date.now() + 10000,
                    name: ' ä¸“ç”¨è™šæ‹Ÿä»“',
                    type: 'department',
                    companyId: 1,
                    companyName: 'å®æ³¢å‘ç°ç‰©æµæœ‰é™å…¬å¸',
                    departmentId: 1,
                    departmentName: 'äº§å“1éƒ¨',
                    bindChannel: true,
                    channel: 'Amazon',
                    inventory: 0,
                    isMainWarehouse: false
                },
                {
                    id: Date.now() + 10001,
                    name: 'ä¸“ç”¨è™šæ‹Ÿä»“',
                    type: 'department',
                    companyId: 1,
                    companyName: 'å®æ³¢å‘ç°ç‰©æµæœ‰é™å…¬å¸',
                    departmentId: 1,
                    departmentName: 'äº§å“2éƒ¨',
                    bindChannel: true,
                    channel: 'eBay',
                    inventory: 0,
                    isMainWarehouse: false
                },
                {
                    id: Date.now() + 10002,
                    name: 'ä¸“ç”¨è™šæ‹Ÿä»“',
                    type: 'department',
                    companyId: 1,
                    companyName: 'å®æ³¢å‘ç°ç‰©æµæœ‰é™å…¬å¸',
                    departmentId: 2,
                    departmentName: 'äº§å“3éƒ¨',
                    bindChannel: true,
                    channel: 'Amazon',
                    inventory: 0,
                    isMainWarehouse: false
                },
                {
                    id: Date.now() + 10003,
                    name: 'ä¸“ç”¨è™šæ‹Ÿä»“',
                    type: 'department',
                    companyId: 1,
                    companyName: 'å®æ³¢å‘ç°ç‰©æµæœ‰é™å…¬å¸',
                    departmentId: 3,
                    departmentName: 'äº§å“4éƒ¨',
                    bindChannel: true,
                    channel: 'Shopify',
                    inventory: 0,
                    isMainWarehouse: false
                }
            ];

            // åˆ›å»ºç¤ºä¾‹æ¸ é“ä»“
            const sampleChannelWarehouses = [
                {
                    id: Date.now() + 20000,
                    name: 'Amazonå…¨çƒä»“',
                    type: 'channel',
                    companyId: null,
                    companyName: null,
                    departmentId: null,
                    departmentName: null,
                    bindChannel: true,
                    channel: 'Amazon',
                    inventory: 0,
                    isMainWarehouse: false
                },
                {
                    id: Date.now() + 20001,
                    name: 'eBayä¸“å±ä»“',
                    type: 'channel',
                    companyId: null,
                    companyName: null,
                    departmentId: null,
                    departmentName: null,
                    bindChannel: true,
                    channel: 'eBay',
                    inventory: 0,
                    isMainWarehouse: false
                },
                {
                    id: Date.now() + 20002,
                    name: 'Shopifyç‹¬ç«‹ç«™ä»“',
                    type: 'channel',
                    companyId: null,
                    companyName: null,
                    departmentId: null,
                    departmentName: null,
                    bindChannel: true,
                    channel: 'Shopify',
                    inventory: 0,
                    isMainWarehouse: false
                }
            ];
            
            data.warehouses.push(...sampleWarehouses);
            data.warehouses.push(...sampleChannelWarehouses);

            // åˆå§‹åŒ–æ€»ä»“çš„SKUåº“å­˜
            const mainWarehouse = data.warehouses.find(w => w.isMainWarehouse === true && w.companyId === 1);
            if (mainWarehouse) {
                const sampleInventory = [
                    { warehouseId: mainWarehouse.id, sku: 'SKU-001', quantity: 2000 },
                    { warehouseId: mainWarehouse.id, sku: 'SKU-002', quantity: 1500 },
                    { warehouseId: mainWarehouse.id, sku: 'SKU-003', quantity: 1200 },
                    { warehouseId: mainWarehouse.id, sku: 'SKU-004', quantity: 1000 },
                    { warehouseId: mainWarehouse.id, sku: 'SKU-005', quantity: 800 },
                    { warehouseId: mainWarehouse.id, sku: 'SKU-006', quantity: 600 }
                ];
                
                sampleInventory.forEach(item => {
                    const key = item.warehouseId + '_' + item.sku;
                    data.warehouseInventory[key] = item.quantity;
                });

                // åˆå§‹åŒ–æ€»ä»“çš„é”å®šåº“å­˜ï¼ˆæ¨¡æ‹Ÿéƒ¨åˆ†åº“å­˜è¢«é”å®šï¼‰
                const sampleLockedInventory = [
                    { warehouseId: mainWarehouse.id, sku: 'SKU-001', quantity: 100 },
                    { warehouseId: mainWarehouse.id, sku: 'SKU-002', quantity: 50 },
                    { warehouseId: mainWarehouse.id, sku: 'SKU-003', quantity: 80 }
                ];

                sampleLockedInventory.forEach(item => {
                    const key = item.warehouseId + '_' + item.sku;
                    data.warehouseLockedInventory[key] = item.quantity;
                });
            }
            
            // åˆ›å»ºä¸€äº›ç¤ºä¾‹è°ƒæ‹¨è®°å½•ï¼ˆä»æ€»ä»“è°ƒæ‹¨åˆ°è™šæ‹Ÿä»“ï¼‰
            const dept1Amazon = sampleWarehouses.find(w => w.name.includes('éƒ¨é—¨1 - Amazon'));
            if (dept1Amazon && mainWarehouse) {
                data.transfers.push({
                    id: Date.now(),
                    fromWarehouseId: mainWarehouse.id,
                    fromWarehouseName: mainWarehouse.name,
                    toWarehouseId: dept1Amazon.id,
                    toWarehouseName: dept1Amazon.name,
                    sku: 'SKU-001',
                    productName: 'ç¤ºä¾‹å•†å“A',
                    quantity: 200,
                    reason: 'å¸¸è§„è°ƒæ‹¨',
                    time: new Date().toLocaleString()
                });
                
                // æ‰§è¡Œè°ƒæ‹¨åº“å­˜
                const keyFrom = mainWarehouse.id + '_SKU-001';
                const keyTo = dept1Amazon.id + '_SKU-001';
                data.warehouseInventory[keyFrom] = (data.warehouseInventory[keyFrom] || 0) - 200;
                data.warehouseInventory[keyTo] = (data.warehouseInventory[keyTo] || 0) + 200;
                mainWarehouse.inventory -= 200;
                dept1Amazon.inventory += 200;

                // ä¸ºè™šæ‹Ÿä»“æ·»åŠ é”å®šåº“å­˜ç¤ºä¾‹
                const keyToLocked = dept1Amazon.id + '_SKU-001';
                data.warehouseLockedInventory[keyToLocked] = 50;
            }

            // ä¸ºæ¸ é“ä»“æ·»åŠ ç¤ºä¾‹åº“å­˜
            sampleChannelWarehouses.forEach(channelWarehouse => {
                const channelInventory = [
                    { warehouseId: channelWarehouse.id, sku: 'SKU-001', quantity: 500 },
                    { warehouseId: channelWarehouse.id, sku: 'SKU-002', quantity: 400 },
                    { warehouseId: channelWarehouse.id, sku: 'SKU-003', quantity: 300 },
                    { warehouseId: channelWarehouse.id, sku: 'SKU-004', quantity: 250 },
                    { warehouseId: channelWarehouse.id, sku: 'SKU-005', quantity: 200 }
                ];

                channelInventory.forEach(item => {
                    const key = item.warehouseId + '_' + item.sku;
                    data.warehouseInventory[key] = item.quantity;
                });

                // ä¸ºæ¸ é“ä»“æ·»åŠ é”å®šåº“å­˜ç¤ºä¾‹
                const lockedKey = channelWarehouse.id + '_SKU-001';
                data.warehouseLockedInventory[lockedKey] = 30;
            });
        }
    </script>
</body>
</html>
