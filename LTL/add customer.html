<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LTL询价</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                        accent: '#f59e0b',
                        success: '#10b981',
                        warning: '#f59e0b',
                        error: '#ef4444',
                        info: '#3b82f6'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                        'bounce-in': 'bounceIn 0.6s ease-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideIn: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        bounceIn: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '50%': { transform: 'scale(1.05)', opacity: '0.8' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* 自定义工具类 */
        .form-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            outline: none;
            transition: all 0.2s;
        }
        .form-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
            border-color: transparent;
        }
        .form-input:disabled {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }
        .form-input:enabled:hover {
            border-color: #9ca3af;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: colors 0.2s;
            font-weight: 500;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .btn-primary:hover {
            background-color: #2563eb;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: colors 0.2s;
            font-weight: 500;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        .btn-primary:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        .btn-secondary:disabled {
            background-color: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
        }
        .card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        .card-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            background-color: #f9fafb;
        }
        .card-body {
            padding: 1rem 1.5rem;
        }
        .unit-btn {
            padding: 0.5rem 1rem;
            border: 2px solid;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s;
            transform: scale(1);
        }
        .unit-btn:hover {
            transform: scale(1.05);
        }
        .unit-btn:not(.active) {
            border-color: #d1d5db;
            color: #4b5563;
            background-color: white;
        }
        .unit-btn:not(.active):hover {
            border-color: #3b82f6;
            color: #3b82f6;
        }
        .unit-btn.active {
            border-color: #3b82f6;
            color: white;
            background-color: #3b82f6;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 50;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: all 0.3s;
            max-width: 20rem;
        }
        .notification.translate-x-full {
            transform: translateX(100%);
            opacity: 0;
        }
        .notification.translate-x-0 {
            transform: translateX(0);
            opacity: 1;
        }
        .address-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 10;
            max-height: 15rem;
            overflow-y: auto;
        }
        .address-dropdown.hidden {
            display: none;
        }
        .product-item {
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: box-shadow 0.2s;
        }
        .product-item:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-color: #3b82f6;
        }
        .stats-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            background-color: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }
        /* 下拉勾选框样式 */
        .dropdown-checkbox-container {
            position: relative;
            width: 100%;
        }
        .dropdown-checkbox-header {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            min-height: 2.5rem;
        }
        .dropdown-checkbox-header:hover {
            border-color: #9ca3af;
        }
        .dropdown-checkbox-header:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }
        .dropdown-selected-text {
            flex: 1;
            color: #374151;
            font-size: 0.875rem;
        }
        .dropdown-selected-text.placeholder {
            color: #9ca3af;
        }
        .dropdown-arrow {
            color: #6b7280;
            transition: transform 0.2s;
        }
        .dropdown-arrow.rotated {
            transform: rotate(180deg);
        }
        .dropdown-checkbox-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 20;
            max-height: 12rem;
            overflow-y: auto;
            margin-top: 0.25rem;
        }
        .dropdown-checkbox-options.hidden {
            display: none;
        }
        .dropdown-checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.875rem;
            color: #374151;
        }
        .dropdown-checkbox-item:hover {
            background-color: #f3f4f6;
        }
        .dropdown-checkbox-item input[type="checkbox"] {
            margin-right: 0.5rem;
            accent-color: #3b82f6;
        }
        .dropdown-checkbox-item span {
            flex: 1;
        }
        
        /* 地址薄按钮样式 */
        .address-book-btn {
            padding: 0.375rem 0.75rem;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        .address-book-btn:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }
        .address-book-btn:active {
            transform: translateY(0);
        }
        
        /* 清空按钮样式 */
        .clear-btn {
            padding: 0.375rem 0.75rem;
            background-color: #ef4444;
            color: white;
            border: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        .clear-btn:hover {
            background-color: #dc2626;
            transform: translateY(-1px);
        }
        .clear-btn:active {
            transform: translateY(0);
        }
        
        /* 地址薄弹窗样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }
        .modal-overlay.hidden {
            display: none;
        }
        .modal-content {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            animation: slideIn 0.3s ease-out;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
            display: flex;
            align-items: center;
        }
        .modal-close {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.375rem;
            transition: all 0.2s;
        }
        .modal-close:hover {
            background-color: #f3f4f6;
            color: #374151;
        }
        .modal-body {
            padding: 1.5rem;
            flex: 1;
            overflow-y: auto;
        }
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        
        /* 询价等待弹窗的特殊样式 - 按钮居中 */
        .modal-footer.centered {
            justify-content: center;
        }
        
        /* 地址薄搜索框样式 */
        .search-section {
            margin-bottom: 1rem;
        }
        .search-input-wrapper {
            position: relative;
        }
        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }
        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }
        
        /* 地址分类标签样式 */
        .address-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .tab-btn {
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        .tab-btn:hover {
            color: #374151;
        }
        .tab-btn.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        
        /* 地址列表样式 */
        .address-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .address-item {
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .address-item:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        .address-item.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .address-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .address-name {
            font-weight: 600;
            color: #111827;
            font-size: 0.875rem;
        }
        .address-type {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .address-type.self-operated {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .address-type.platform {
            background-color: #fef3c7;
            color: #92400e;
        }
        .address-contact {
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        .address-detail {
            color: #374151;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        .address-services {
            margin-top: 0.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        .service-tag {
            padding: 0.125rem 0.5rem;
            background-color: #f3f4f6;
            color: #6b7280;
            border-radius: 0.25rem;
            font-size: 0.75rem;
        }
        
        /* 响应式优化 */
        @media (max-width: 768px) {
            .card-body {
                padding: 0.75rem 1rem;
            }
            .form-input {
                padding: 0.375rem 0.5rem;
                font-size: 0.875rem;
            }
            .modal-content {
                width: 95%;
                max-height: 90vh;
            }
            .modal-header,
            .modal-body,
            .modal-footer {
                padding: 1rem;
            }
            .address-tabs {
                overflow-x: auto;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 顶部导航 -->
    <!-- <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <i class="fas fa-truck text-primary text-2xl mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-900">LTL货运管理系统</h1>
                </div>
                <nav class="flex space-x-4">
                    <a href="index.html" class="text-gray-600 hover:text-primary px-3 py-2 rounded-md text-sm font-medium transition-colors">首页</a>
                    <a href="add_details.html" class="bg-primary text-white px-3 py-2 rounded-md text-sm font-medium">添加详情</a>
                    <a href="details.html" class="text-gray-600 hover:text-primary px-3 py-2 rounded-md text-sm font-medium transition-colors">详情列表</a>
                </nav>
            </div>
        </div>
    </header> -->

    <!-- 主要内容 -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- 页面标题 -->


        <!-- 地址信息区域 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- 提货地址 -->
            <div class="card animate-slide-in">
                <div class="card-header">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="fas fa-map-marker-alt text-primary mr-2"></i>提货地址
                        </h3>
                        <div class="flex gap-2">
                            <button type="button" onclick="clearAddressForm('sender')" class="clear-btn">
                                <i class="fas fa-eraser mr-2"></i>清空
                            </button>
                            <button type="button" onclick="openAddressBook('sender')" class="address-book-btn">
                                <i class="fas fa-address-book mr-2"></i>地址薄
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <form id="sender-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                <span class="text-red-500">*</span> 邮编搜索
                            </label>
                            <div class="relative">
                                <input type="text" id="sender-postcode" 
                                       class="form-input" 
                                       placeholder="输入邮编搜索地址，选择后将显示完整位置信息"
                                       oninput="debounceSearch('sender', this.value)">
                                <div id="sender-address-dropdown" class="address-dropdown hidden"></div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span>国家
                                </label>
                                <input type="text" id="sender-country" 
                                       class="form-input" 
                                       value="US"
                                       placeholder="请选择或输入国家" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span>省州
                                </label>
                                <input type="text" id="sender-province" 
                                       class="form-input" 
                                       placeholder="请选择或输入省州" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span>城市
                                </label>
                                <input type="text" id="sender-city" 
                                       class="form-input" 
                                       placeholder="请选择或输入城市" required>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                详细地址
                            </label>
                            <textarea id="sender-address" rows="3" class="form-input" placeholder="请输入详细地址">TEST</textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    联系人
                                </label>
                                <input type="text" id="sender-name" class="form-input" placeholder="请输入联系人姓名" value="张三">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    联系电话
                                </label>
                                <input type="tel" id="sender-phone" class="form-input" placeholder="请输入联系电话" value="13800138000">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">地址类型</label>
                                <select id="sender-address-type" class="form-input">
                                    <option value="residential">商业地址带卸货平台</option>
                                    <option value="commercial">商业地址不带卸货平台</option>
                                    <option value="industrial">私人地址</option>
                                    <option value="warehouse">限制性地址</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">提货服务</label>
                                <div class="dropdown-checkbox-container">
                                    <div class="dropdown-checkbox-header" onclick="toggleDropdown('sender-pickup-dropdown')">
                                        <span id="sender-pickup-selected" class="dropdown-selected-text">请选择提货服务</span>
                                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                                    </div>
                                    <div id="sender-pickup-dropdown" class="dropdown-checkbox-options hidden">
                                        <label class="dropdown-checkbox-item">
                                            <input type="checkbox" value="standard" onchange="updateSelectedText('sender-pickup')">
                                            <span>标准提货</span>
                                        </label>
                                        <label class="dropdown-checkbox-item">
                                            <input type="checkbox" value="liftgate" onchange="updateSelectedText('sender-pickup')">
                                            <span>升降尾板服务</span>
                                        </label>
                                        <label class="dropdown-checkbox-item">
                                            <input type="checkbox" value="inside" onchange="updateSelectedText('sender-pickup')">
                                            <span>受限区域提货</span>
                                        </label>
                                        <label class="dropdown-checkbox-item">
                                            <input type="checkbox" value="residential" onchange="updateSelectedText('sender-pickup')">
                                            <span>纸箱或非规则包装产品提货</span>
                                        </label>
                                        <label class="dropdown-checkbox-item">
                                            <input type="checkbox" value="limited" onchange="updateSelectedText('sender-pickup')">
                                            <span>预约服务</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 隐藏字段用于存储邮编信息 -->
                        <input type="hidden" id="sender-postcode-hidden">
                    </form>
                </div>
            </div>

            <!-- 收货地址 -->
            <div class="card animate-slide-in" style="animation-delay: 0.1s">
                <div class="card-header">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="fas fa-map-marker-alt text-accent mr-2"></i>收货地址
                        </h3>
                        <div class="flex gap-2">
                            <button type="button" onclick="clearAddressForm('receiver')" class="clear-btn">
                                <i class="fas fa-eraser mr-2"></i>清空
                            </button>
                            <button type="button" onclick="openAddressBook('receiver')" class="address-book-btn">
                                <i class="fas fa-address-book mr-2"></i>地址薄
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <form id="receiver-form" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span>邮编搜索
                                </label>
                                <div class="relative">
                                    <input type="text" id="receiver-postcode" 
                                           class="form-input" 
                                           placeholder="输入邮编搜索地址，选择后将显示完整位置信息"
                                           oninput="debounceSearch('receiver', this.value)">
                                    <div id="receiver-address-dropdown" class="address-dropdown hidden"></div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span>提货日期
                                </label>
                                <input type="date" id="pickup-date" required
                                    class="form-input" value="2025-12-01">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span>国家
                                </label>
                                <input type="text" id="receiver-country" 
                                       class="form-input" 
                                       value="US"
                                       placeholder="请选择或输入国家" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span>省州
                                </label>
                                <input type="text" id="receiver-province" 
                                       class="form-input" 
                                       placeholder="请选择或输入省州" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <span class="text-red-500">*</span>城市
                                </label>
                                <input type="text" id="receiver-city" 
                                       class="form-input" 
                                       placeholder="请选择或输入城市" required>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">详细地址</label>
                            <textarea id="receiver-address" rows="3" class="form-input" placeholder="请输入详细地址">TEST</textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">联系人</label>
                                <input type="text" id="receiver-name" class="form-input" placeholder="请输入联系人姓名" value="zsw">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">联系电话</label>
                                <input type="tel" id="receiver-phone" class="form-input" placeholder="请输入联系电话" value="13900139000">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    地址类型
                                </label>
                                <select id="receiver-address-type" class="form-input" required>
                                    <option value="residential">商业地址带卸货平台</option>
                                    <option value="commercial">商业地址不带卸货平台</option>
                                    <option value="industrial">私人地址</option>
                                    <option value="warehouse">限制性地址</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    派送服务
                                </label>
                                <div class="dropdown-checkbox-container">
                                    <div class="dropdown-checkbox-header" onclick="toggleDropdown('receiver-delivery-dropdown')">
                                        <span id="receiver-delivery-selected" class="dropdown-selected-text">请选择派送服务</span>
                                        <i class="fas fa-chevron-down dropdown-arrow"></i>
                                    </div>
                                    <div id="receiver-delivery-dropdown" class="dropdown-checkbox-options hidden">
                                        <label class="dropdown-checkbox-item">
                                            <input type="checkbox" value="standard" onchange="updateSelectedText('receiver-delivery')">
                                            <span>标准配送</span>
                                        </label>
                                        <label class="dropdown-checkbox-item">
                                            <input type="checkbox" value="liftgate" onchange="updateSelectedText('receiver-delivery')">
                                            <span>升降尾板服务</span>
                                        </label>
                                        <label class="dropdown-checkbox-item">
                                            <input type="checkbox" value="inside" onchange="updateSelectedText('receiver-delivery')">
                                            <span>限制地址配送</span>
                                        </label>
                                        <label class="dropdown-checkbox-item">
                                            <input type="checkbox" value="residential" onchange="updateSelectedText('receiver-delivery')">
                                            <span>预约服务</span>
                                        </label>
                                        <label class="dropdown-checkbox-item">
                                            <input type="checkbox" value="limited" onchange="updateSelectedText('receiver-delivery')">
                                            <span>白手套签收服务</span>
                                        </label>
                                        <label class="dropdown-checkbox-item">
                                            <input type="checkbox" value="limited" onchange="updateSelectedText('receiver-delivery')">
                                            <span>安装服务</span>
                                        </label>
                                        <label class="dropdown-checkbox-item">
                                            <input type="checkbox" value="limited" onchange="updateSelectedText('sender-pickup')">
                                            <span>住宅区派送</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 隐藏字段用于存储邮编信息 -->
                        <input type="hidden" id="receiver-postcode-hidden">
                    </form>
                </div>
            </div>
        </div>

        <!-- 托盘信息区域 -->
        <div class="card animate-slide-in" style="animation-delay: 0.2s">
            <div class="card-header">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-box text-primary mr-2"></i>托盘信息
                    </h3>
                    <!-- 统计信息 -->
                    <div class="flex flex-wrap gap-2">
                        <span class="stats-badge">
                            <i class="fas fa-cubes mr-1"></i>
                            数量: <span id="total-quantity">0</span>
                        </span>
                        <span class="stats-badge">
                            <i class="fas fa-weight mr-1"></i>
                            重量: <span id="total-weight">0 kg</span>
                        </span>
                        <span class="stats-badge">
                            <i class="fas fa-cube mr-1"></i>
                            体积: <span id="total-volume">0 m³</span>
                        </span>
                        <span class="stats-badge">
                            <i class="fas fa-dollar-sign mr-1"></i>
                            货值: <span id="total-value">$0</span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="card-body">


                <!-- 全局属性选项 -->
                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-3">托盘属性（适用于所有托盘）</label>
                    <div class="flex flex-wrap gap-6">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="global-hazmat" class="mr-2" onchange="updateGlobalProperty('isHazmat', this.checked)">
                            <span class="text-sm text-gray-700">危险品</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="global-flammable" class="mr-2" onchange="updateGlobalProperty('isFlammable', this.checked)">
                            <span class="text-sm text-gray-700">易燃品</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="global-stackable" class="mr-2" checked onchange="updateGlobalProperty('isStackable', this.checked)">
                            <span class="text-sm text-gray-700">允许堆叠</span>
                        </label>
                    </div>
                </div>

                <!-- 智能识别功能 -->
                <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-1">
                                <i class="fas fa-magic mr-2 text-blue-600"></i>智能识别托盘信息
                            </h4>
                            <p class="text-xs text-gray-500">批量识别托盘信息，支持多种格式</p>
                        </div>
                        <button onclick="openPalletParserModal()" class="btn-primary">
                            <i class="fas fa-wand-magic-sparkles mr-2"></i>批量识别
                        </button>
                    </div>
                </div>

                <!-- 托盘列表容器 -->
                <div id="product-table-container">
                    <div id="product-list-container" class="space-y-4 mb-6">
                        <!-- 托盘项将动态添加到这里 -->
                    </div>
                    
                    <!-- 操作按钮 -->
                    <div class="flex flex-wrap gap-3">
                        <button id="add-product-row" onclick="addProductRow()" class="btn-primary">
                            <i class="fas fa-plus mr-2"></i>添加托盘
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 操作按钮 -->
        <div class="mt-8 flex justify-center gap-4 animate-slide-in" style="animation-delay: 0.3s">
            <button onclick="cancelForm()" class="btn-secondary text-lg px-8 py-3">
                <i class="fas fa-times mr-2"></i>取消
            </button>
            <button onclick="submitInquiry()" class="btn-primary text-lg px-8 py-3">
                <i class="fas fa-search mr-2"></i>提交询价
            </button>
        </div>
    </main>

    <script>
        // 全局变量
        let palletRows = [];
        let selectedQuotation = null;
        let palletRowCount = 0;
        let searchTimeout = null;
        let currentAddressType = null; // 当前地址类型：'sender' 或 'receiver'
        
        // 全局属性设置
        let globalProperties = {
            isHazmat: false,
            isFlammable: false,
            isStackable: true
        };

        // 地址薄数据
        const addressBook = {
            selfOperated: [
                {
                    id: 'self_001',
                    name: '上海自营仓',
                    contact: '张经理',
                    phone: '021-12345678',
                    address: '上海市浦东新区张江高科技园区科苑路88号',
                    zipcode: '201203',
                    addressType: 'warehouse',
                    services: {
                        pickup: ['standard', 'liftgate'],
                        delivery: ['standard', 'liftgate', 'inside']
                    }
                },
                {
                    id: 'self_002',
                    name: '北京自营仓',
                    contact: '李主管',
                    phone: '010-87654321',
                    address: '北京市大兴区亦庄经济开发区科创十街18号',
                    zipcode: '100176',
                    addressType: 'warehouse',
                    services: {
                        pickup: ['standard', 'liftgate', 'residential'],
                        delivery: ['standard', 'liftgate']
                    }
                },
                {
                    id: 'self_003',
                    name: '深圳自营仓',
                    contact: '王经理',
                    phone: '0755-98765432',
                    address: '深圳市宝安区沙井街道创新路168号',
                    zipcode: '518104',
                    addressType: 'warehouse',
                    services: {
                        pickup: ['standard', 'liftgate', 'inside', 'limited'],
                        delivery: ['standard', 'liftgate', 'inside']
                    }
                }
            ],
            platform: [
                {
                    id: 'platform_001',
                    name: '广州平台仓',
                    contact: '陈专员',
                    phone: '020-11223344',
                    address: '广州市白云区钟落潭镇广从八路1号',
                    zipcode: '510540',
                    addressType: 'warehouse',
                    services: {
                        pickup: ['standard'],
                        delivery: ['standard', 'residential']
                    }
                },
                {
                    id: 'platform_002',
                    name: '成都平台仓',
                    contact: '刘经理',
                    phone: '028-55667788',
                    address: '成都市双流区航空港经济开发区长城路一段',
                    zipcode: '610207',
                    addressType: 'warehouse',
                    services: {
                        pickup: ['standard', 'liftgate'],
                        delivery: ['standard', 'liftgate', 'inside', 'residential']
                    }
                },
                {
                    id: 'platform_003',
                    name: '杭州平台仓',
                    contact: '赵主管',
                    phone: '0571-99887766',
                    address: '杭州市余杭区文一西路969号',
                    zipcode: '311121',
                    addressType: 'warehouse',
                    services: {
                        pickup: ['standard', 'liftgate', 'inside'],
                        delivery: ['standard', 'liftgate', 'inside', 'limited']
                    }
                }
            ]
        };

        // 更新全局属性
        function updateGlobalProperty(property, value) {
            globalProperties[property] = value;
            
            // 更新所有现有托盘的属性
            palletRows.forEach((pallet, index) => {
                pallet[property] = value;
            });
            
            // 重新渲染托盘列表以反映属性变化
            renderProductList();
            
            const propertyNames = {
                isHazmat: '危险品',
                isFlammable: '易燃品',
                isStackable: '允许堆叠'
            };
            
            showNotification(`已更新${propertyNames[property]}设置，适用于所有托盘`, 'success');
        }

        // 渲染托盘列表
        function renderProductList() {
            const container = document.getElementById('product-list-container');
            container.innerHTML = '';
            
            palletRows.forEach((palletData, index) => {
                const palletItem = createProductListItem(index, palletData);
                container.innerHTML += palletItem;
            });
        }

        // 解析托盘字符串
        function parsePalletString(input) {
            if (!input || typeof input !== 'string') {
                return null;
            }
            
            // 移除多余空格并转换为小写
            const cleaned = input.trim().toLowerCase();
            
            // 定义单位识别模式
            const unitPatterns = {
                // 托盘单位
                pallets: /(\d+)\s*(pallets?)/i,
                // 尺寸单位
                dimensions: /(\d+)\s*\*\s*(\d+)\s*\*\s*(\d+)\s*(inch|cm)/i,
                // 重量单位
                weight: /(\d+)\s*(lbs?|kg)/i
            };
            
            // 提货各个部分
            let count = 1; // 默认数量为1
            let dimensions = null;
            let weight = null;
            
            // 提货托盘数量
            const palletMatch = cleaned.match(unitPatterns.pallets);
            if (palletMatch) {
                count = parseInt(palletMatch[1]);
            }
            
            // 提货尺寸
            const dimensionMatch = cleaned.match(unitPatterns.dimensions);
            if (dimensionMatch) {
                dimensions = {
                    length: parseInt(dimensionMatch[1]),
                    width: parseInt(dimensionMatch[2]),
                    height: parseInt(dimensionMatch[3]),
                    unit: dimensionMatch[4].toLowerCase()
                };
            }
            
            // 提货重量
            const weightMatch = cleaned.match(unitPatterns.weight);
            if (weightMatch) {
                weight = {
                    value: parseInt(weightMatch[1]),
                    unit: weightMatch[2].toLowerCase().replace(/s$/, '') // 移除复数形式
                };
            }
            
            // 验证必需字段
            if (!dimensions || !weight) {
                return null; // 缺少尺寸或重量信息，返回null表示无效
            }
            
            return {
                count: count,
                length: dimensions.length,
                width: dimensions.width,
                height: dimensions.height,
                weight: weight.value,
                dimensionUnit: dimensions.unit,
                weightUnit: weight.unit,
                isValid: true
            };
        }

        // 根据解析结果添加托盘
        function addPalletFromParsed(parsedData) {
            if (!parsedData || !parsedData.isValid) {
                showNotification('无法解析托盘信息，请检查格式', 'error');
                return;
            }
            
            // 创建单个托盘数据，不进行拆分
            const palletData = {
                id: `pallet_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                palletCount: parsedData.count.toString(), // 将数量保存在palletCount中
                length: parsedData.length.toString(),
                width: parsedData.width.toString(),
                height: parsedData.height.toString(),
                weight: parsedData.weight.toString(),
                value: '',
                productName: '',
                lengthUnit: parsedData.dimensionUnit, // 使用解析出的尺寸单位
                weightUnit: parsedData.weightUnit,     // 使用解析出的重量单位
                // 应用全局属性设置
                ...globalProperties
            };
            
            palletRows.push(palletData);
            
            // 重新渲染托盘列表
            renderProductList();
            
            // 更新总计
            calculateTotals();
            
            showNotification(`成功添加 ${parsedData.count} 个托盘`, 'success');
        }

        // 解析并添加托盘
        function parseAndAddPallet() {
            const input = document.getElementById('pallet-string-input').value;
            
            if (!input.trim()) {
                showNotification('请输入托盘信息字符串', 'warning');
                return;
            }
            
            const parsedData = parsePalletString(input);
            
            if (parsedData) {
                addPalletFromParsed(parsedData);
                // 清空输入框
                clearPalletInput();
            } else {
                showNotification('无法解析托盘信息，请检查格式是否正确', 'error');
            }
        }

        // 清空托盘输入
        function clearPalletInput() {
            document.getElementById('pallet-string-input').value = '';
        }

        // 打开托盘解析器模态窗口
        function openPalletParserModal() {
            // 清空之前的输入和预览
            document.getElementById('batch-pallet-input').value = '';
            document.getElementById('batch-pallet-preview').classList.add('hidden');
            document.getElementById('batch-pallet-stats').classList.add('hidden');
            document.getElementById('confirm-batch-parsing').disabled = true;
            
            // 显示模态窗口
            const modal = document.getElementById('pallet-parser-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // 关闭托盘解析器模态窗口
        function closePalletParserModal() {
            const modal = document.getElementById('pallet-parser-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // 预览批量托盘输入
        function previewBatchPalletInput() {
            const input = document.getElementById('batch-pallet-input').value.trim();
            
            if (!input) {
                showNotification('请输入托盘信息', 'warning');
                return;
            }
            
            // 按行分割输入
            const lines = input.split('\n').filter(line => line.trim());
            
            if (lines.length === 0) {
                showNotification('请输入有效的托盘信息', 'warning');
                return;
            }
            
            // 解析每一行
            const results = [];
            let validCount = 0;
            let invalidLines = [];
            
            lines.forEach((line, index) => {
                const parsed = parsePalletString(line.trim());
                if (parsed && parsed.isValid) {
                    results.push({
                        lineNumber: index + 1,
                        originalLine: line.trim(),
                        parsedData: parsed
                    });
                    validCount++;
                } else {
                    invalidLines.push({
                        lineNumber: index + 1,
                        line: line.trim()
                    });
                }
            });
            
            // 显示预览结果
            displayBatchPreview(results, validCount, invalidLines, lines.length);
        }

        // 显示批量预览结果
        function displayBatchPreview(results, validCount, invalidLines, totalCount) {
            const previewContainer = document.getElementById('batch-pallet-preview');
            const previewContent = document.getElementById('batch-pallet-preview-content');
            const statsContainer = document.getElementById('batch-pallet-stats');
            const statsText = document.getElementById('batch-pallet-stats-text');
            const confirmButton = document.getElementById('confirm-batch-parsing');
            
            // 生成预览内容
            let previewHTML = '';
            
            // 显示有效的托盘信息
            if (results.length > 0) {
                previewHTML += '<div class="mb-3"><strong class="text-green-600">✓ 有效的托盘信息：</strong></div>';
                results.forEach(result => {
                    const data = result.parsedData;
                    previewHTML += `
                        <div class="mb-2 p-2 bg-green-50 border border-green-200 rounded text-xs">
                            <div class="font-medium text-green-800">第${result.lineNumber}行: ${result.originalLine}</div>
                            <div class="text-green-700 mt-1">
                                → ${data.count}个托盘 | 尺寸: ${data.length}*${data.width}*${data.height}${data.dimensionUnit} | 重量: ${data.weight}${data.weightUnit}
                            </div>
                        </div>
                    `;
                });
            }
            
            // 显示无效的行
            if (invalidLines.length > 0) {
                previewHTML += '<div class="mb-3"><strong class="text-red-600">✗ 无法识别的行：</strong></div>';
                invalidLines.forEach(invalid => {
                    previewHTML += `
                        <div class="mb-2 p-2 bg-red-50 border border-red-200 rounded text-xs">
                            <div class="text-red-800">第${invalid.lineNumber}行: ${invalid.line}</div>
                            <div class="text-red-600 text-xs mt-1">→ 格式不正确，请检查</div>
                        </div>
                    `;
                });
            }
            
            previewContent.innerHTML = previewHTML;
            previewContainer.classList.remove('hidden');
            
            // 显示统计信息
            const successRate = ((validCount / totalCount) * 100).toFixed(1);
            statsText.textContent = `共输入 ${totalCount} 行，成功识别 ${validCount} 个托盘信息，成功率 ${successRate}%`;
            statsContainer.classList.remove('hidden');
            
            // 启用/禁用确认按钮
            confirmButton.disabled = validCount === 0;
        }

        // 确认批量解析托盘
        function confirmBatchPalletParsing() {
            const input = document.getElementById('batch-pallet-input').value.trim();
            
            if (!input) {
                showNotification('请输入托盘信息', 'warning');
                return;
            }
            
            // 按行分割输入
            const lines = input.split('\n').filter(line => line.trim());
            
            // 解析并添加有效的托盘
            let addedCount = 0;
            let skippedCount = 0;
            let unitMismatchCount = 0;
            const newPallets = []; // 临时存储新托盘，避免重复添加
            const invalidLines = [];
            
            lines.forEach((line, index) => {
                const parsed = parsePalletString(line.trim());
                if (parsed && parsed.isValid) {
                    // 创建托盘数据但不立即添加到数组
                    const palletData = {
                        id: `pallet_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                        palletCount: parsed.count.toString(), // 将数量保存在palletCount中
                        length: parsed.length.toString(),
                        width: parsed.width.toString(),
                        height: parsed.height.toString(),
                        weight: parsed.weight.toString(),
                        value: '',
                        productName: '',
                        lengthUnit: parsed.dimensionUnit, // 使用解析出的尺寸单位
                        weightUnit: parsed.weightUnit,     // 使用解析出的重量单位
                        // 应用全局属性设置
                        ...globalProperties
                    };
                    
                    newPallets.push(palletData);
                    addedCount++;
                } else {
                    skippedCount++;
                    invalidLines.push(`第${index + 1}行: ${line.trim()}`);
                }
            });
            
            // 检查是否有重复数据并过滤
            const uniqueNewPallets = newPallets.filter(newPallet => {
                return !palletRows.some(existingPallet => 
                    existingPallet.length === newPallet.length &&
                    existingPallet.width === newPallet.width &&
                    existingPallet.height === newPallet.height &&
                    existingPallet.weight === newPallet.weight
                );
            });
            
            const duplicateCount = newPallets.length - uniqueNewPallets.length;
            
            // 一次性添加所有新托盘
            palletRows.push(...uniqueNewPallets);
            
            // 重新渲染托盘列表和更新总计
            renderProductList();
            calculateTotals();
            
            // 关闭模态窗口
            closePalletParserModal();
            
            // 显示详细结果通知
            if (uniqueNewPallets.length > 0) {
                let message = `成功添加 ${uniqueNewPallets.length} 个托盘条目`;
                if (skippedCount > 0) {
                    message += `，跳过 ${skippedCount} 个无效条目`;
                }
                if (unitMismatchCount > 0) {
                    message += `，${unitMismatchCount} 个条目单位不匹配但已添加`;
                }
                if (duplicateCount > 0) {
                    message += `，过滤了 ${duplicateCount} 个重复的托盘`;
                }
                showNotification(message, 'success');
            } else {
                showNotification('没有添加任何托盘，请检查输入格式', 'warning');
            }
            
            // 如果有无效行，在控制台输出详细信息
            if (invalidLines.length > 0) {
                console.log('无效的托盘信息行：', invalidLines);
                console.log('支持的格式示例（乱序兼容）：');
                console.log('- 15pallets 48*40*73inch 480lbs');
                console.log('- 1pallet 80*48*61cm 1337kg');
                console.log('- 48*40*73inch 480lbs 15pallets');
                console.log('- 480lbs 15pallets 48*40*73inch');
                console.log('- 1337kg 80*48*61cm 1pallet');
            }
        }

        // 防抖搜索函数
        function debounceSearch(type, value) {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                searchAddressByZipcode(type, value);
            }, 300);
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            // 移除所有现有的通知，避免重叠
            document.querySelectorAll('.notification').forEach(notification => {
                document.body.removeChild(notification);
            });
            
            const notification = document.createElement('div');
            // 确保通知样式正确，使用固定定位和过渡动画
            notification.className = `notification fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg transform transition-transform duration-300 ${type === 'success' ? 'bg-green-500 text-white' : type === 'warning' ? 'bg-yellow-500 text-white' : type === 'error' ? 'bg-red-500 text-white' : 'bg-blue-500 text-white'}`;
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'error' ? 'times-circle' : 'info-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // 显示通知 - 使用更可靠的方式
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // 隐藏通知
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 5000); // 增加显示时间，让用户有足够时间阅读
        }

        // 单位选择功能已移除，每个托盘条目现在可以独立选择单位

        // 添加托盘行
        function addProductRow() {
            // 设置默认值：尺寸40*48*72英寸，重量50磅
            const defaultLength = '40';
            const defaultWidth = '48';
            const defaultHeight = '72';
            const defaultWeight = '50';
            
            const palletData = {
                id: `pallet_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                palletCount: '1',
                length: defaultLength,
                width: defaultWidth,
                height: defaultHeight,
                weight: defaultWeight,
                value: '1000',
                productName: '电子产品',
                lengthUnit: 'inch', // 默认尺寸单位
                weightUnit: 'lb',     // 默认重量单位
                // 应用全局属性设置
                ...globalProperties
            };
            
            palletRows.push(palletData);
            
            // 使用统一的渲染函数
            renderProductList();
            
            // 创建后立即更新总计
            calculateTotals();
        }

        // 创建产品列表项
        function createProductListItem(index, productData) {
            // 获取当前产品的单位，默认使用英寸和磅
            const lengthUnit = productData.lengthUnit || 'inch';
            const weightUnit = productData.weightUnit || 'lb';
            
            return `
                <div class="product-item" data-index="${index}">
                    <div class="flex justify-between items-start mb-3">
                        <h4 class="text-sm font-semibold text-gray-900">托盘 ${index + 1}</h4>
                        <button onclick="removeProductRow(${index})" class="text-red-500 hover:text-red-700 transition">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        
                        <!-- 数量 -->
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">
                                <span class="text-red-500">*</span> 数量
                            </label>
                            <input type="number" class="form-input pallet-count" 
                                   value="${productData.palletCount || ''}"
                                   placeholder="0" min="0" onchange="updateProductData(${index}, 'palletCount', this.value)">
                        </div>
                        
                        <!-- 尺寸 -->
                        <div class="lg:col-span-1">
                            <label class="block text-xs font-medium text-gray-700 mb-1">
                                <span class="text-red-500">*</span> 尺寸
                            </label>
                            <div class="flex space-x-2">
                                <input type="number" class="form-input length" 
                                       value="${productData.length || ''}"
                                       placeholder="长" min="0" onchange="updateProductData(${index}, 'length', this.value)">
                                <input type="number" class="form-input width" 
                                       value="${productData.width || ''}"
                                       placeholder="宽" min="0" onchange="updateProductData(${index}, 'width', this.value)">
                                <input type="number" class="form-input height" 
                                       value="${productData.height || ''}"
                                       placeholder="高" min="0" onchange="updateProductData(${index}, 'height', this.value)">
                                <select class="form-input length-unit" 
                                        onchange="updateProductData(${index}, 'lengthUnit', this.value)" style="width: auto;">
                                    <option value="inch" ${lengthUnit === 'inch' ? 'selected' : ''}>inch</option>
                                    <option value="cm" ${lengthUnit === 'cm' ? 'selected' : ''}>cm</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- 总重量-->
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">
                                <span class="text-red-500">*</span> 总重量
                            </label>
                            <div class="flex space-x-2">
                                <input type="number" class="form-input weight" 
                                       value="${productData.weight || ''}"
                                       placeholder="0" min="0" step="0.1" onchange="updateProductData(${index}, 'weight', this.value)">
                                <select class="form-input weight-unit" 
                                        onchange="updateProductData(${index}, 'weightUnit', this.value)" style="width: auto;">
                                    <option value="lb" ${weightUnit === 'lb' ? 'selected' : ''}>lb</option>
                                    <option value="kg" ${weightUnit === 'kg' ? 'selected' : ''}>kg</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- 货值 -->
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">
                                <span class="text-red-500">*</span> 货值 (USD)
                            </label>
                            <input type="number" class="form-input value" 
                                   value="${productData.value || ''}"
                                   placeholder="0" min="0" step="0.01" onchange="updateProductData(${index}, 'value', this.value)">
                        </div>
                        
                        <!-- 货物名称 -->
                        <div class="lg:col-span-1">
                            <label class="block text-xs font-medium text-gray-700 mb-1">
                                <span class="text-red-500">*</span> 名称
                            </label>
                            <input type="text" class="form-input product-name" 
                                   value="${productData.productName || ''}"
                                   placeholder="请输入货物名称" onchange="updateProductData(${index}, 'productName', this.value)">
                        </div>
                    </div>
                    
                    <!-- 属性选项已移至全局设置 -->
                </div>
            `;
        }

        // 更新托盘数据
        function updateProductData(index, field, value) {
            if (palletRows[index]) {
                palletRows[index][field] = value;
                calculateTotals();
            }
        }

        // 删除托盘行
        function removeProductRow(index) {
            palletRows.splice(index, 1);
            
            // 使用新的渲染函数重新渲染列表
            renderProductList();
            
            calculateTotals();
        }

        // 计算总计
        function calculateTotals() {
            let totalQuantity = 0;
            let totalWeightInLb = 0; // 统一使用lb作为内部计算单位
            let totalVolume = 0;
            let totalValue = 0;
            
            palletRows.forEach(pallet => {
                const quantity = parseFloat(pallet.palletCount) || 0;
                totalQuantity += quantity;
                
                const weight = parseFloat(pallet.weight) || 0;
                // 将重量转换为lb统一计算
                let weightInLb;
                if (pallet.weightUnit === 'kg') {
                    weightInLb = weight * 2.20462; // 1kg = 2.20462lb
                } else {
                    weightInLb = weight; // 默认使用lb
                }
                totalWeightInLb += weightInLb;
                
                const length = parseFloat(pallet.length) || 0;
                const width = parseFloat(pallet.width) || 0;
                const height = parseFloat(pallet.height) || 0;
                
                let lengthInMeters, widthInMeters, heightInMeters;
                // 根据每个托盘的单位转换尺寸
                if (pallet.lengthUnit === 'cm') {
                    lengthInMeters = length / 100;
                    widthInMeters = width / 100;
                    heightInMeters = height / 100;
                } else {
                    lengthInMeters = length * 0.0254;
                    widthInMeters = width * 0.0254;
                    heightInMeters = height * 0.0254;
                }
                
                totalVolume += lengthInMeters * widthInMeters * heightInMeters * quantity;
                
                const value = parseFloat(pallet.value) || 0;
                totalValue += value;
            });
            
            // 使用第一个托盘的重量单位显示总重量，或者默认使用lb
            const displayWeightUnit = palletRows.length > 0 && palletRows[0].weightUnit ? palletRows[0].weightUnit : 'lb';
            // 将总重量转换为显示单位
            let displayWeight = totalWeightInLb;
            if (displayWeightUnit === 'kg') {
                displayWeight = totalWeightInLb / 2.20462;
            }
            
            // 更新总计显示，只设置存在的元素
            const totalWeightEl = document.getElementById('total-weight');
            if (totalWeightEl) {
                totalWeightEl.textContent = `${displayWeight.toFixed(2)} ${displayWeightUnit}`;
            }
            
            const totalVolumeEl = document.getElementById('total-volume');
            if (totalVolumeEl) {
                totalVolumeEl.textContent = `${totalVolume.toFixed(3)} m³`;
            }
            
            // 可选：添加其他总计元素的检查
            const totalQuantityEl = document.getElementById('total-quantity');
            if (totalQuantityEl) {
                totalQuantityEl.textContent = totalQuantity.toFixed(0);
            }
            
            const totalValueEl = document.getElementById('total-value');
            if (totalValueEl) {
                totalValueEl.textContent = `$${totalValue.toFixed(2)}`;
            }
        }

        // 美国邮编数据
        const usZipCodeData = {
            '10001': { city: 'New York', state: 'NY', country: 'USA', fullName: 'New York, NY 10001, USA' },
            '10002': { city: 'New York', state: 'NY', country: 'USA', fullName: 'New York, NY 10002, USA' },
            '10003': { city: 'New York', state: 'NY', country: 'USA', fullName: 'New York, NY 10003, USA' },
            '90210': { city: 'Beverly Hills', state: 'CA', country: 'USA', fullName: 'Beverly Hills, CA 90210, USA' },
            '90211': { city: 'Beverly Hills', state: 'CA', country: 'USA', fullName: 'Beverly Hills, CA 90211, USA' },
            '33101': { city: 'Miami', state: 'FL', country: 'USA', fullName: 'Miami, FL 33101, USA' },
            '33102': { city: 'Miami', state: 'FL', country: 'USA', fullName: 'Miami, FL 33102, USA' },
            '60601': { city: 'Chicago', state: 'IL', country: 'USA', fullName: 'Chicago, IL 60601, USA' },
            '60602': { city: 'Chicago', state: 'IL', country: 'USA', fullName: 'Chicago, IL 60602, USA' },
            '77001': { city: 'Houston', state: 'TX', country: 'USA', fullName: 'Houston, TX 77001, USA' },
            '77002': { city: 'Houston', state: 'TX', country: 'USA', fullName: 'Houston, TX 77002, USA' },
            '85001': { city: 'Phoenix', state: 'AZ', country: 'USA', fullName: 'Phoenix, AZ 85001, USA' },
            '85002': { city: 'Phoenix', state: 'AZ', country: 'USA', fullName: 'Phoenix, AZ 85002, USA' },
            '98101': { city: 'Seattle', state: 'WA', country: 'USA', fullName: 'Seattle, WA 98101, USA' },
            '98102': { city: 'Seattle', state: 'WA', country: 'USA', fullName: 'Seattle, WA 98102, USA' },
            '02101': { city: 'Boston', state: 'MA', country: 'USA', fullName: 'Boston, MA 02101, USA' },
            '02102': { city: 'Boston', state: 'MA', country: 'USA', fullName: 'Boston, MA 02102, USA' },
            '19101': { city: 'Philadelphia', state: 'PA', country: 'USA', fullName: 'Philadelphia, PA 19101, USA' },
            '19102': { city: 'Philadelphia', state: 'PA', country: 'USA', fullName: 'Philadelphia, PA 19102, USA' },
            '80201': { city: 'Denver', state: 'CO', country: 'USA', fullName: 'Denver, CO 80201, USA' },
            '80202': { city: 'Denver', state: 'CO', country: 'USA', fullName: 'Denver, CO 80202, USA' },
            '94101': { city: 'San Francisco', state: 'CA', country: 'USA', fullName: 'San Francisco, CA 94101, USA' },
            '94102': { city: 'San Francisco', state: 'CA', country: 'USA', fullName: 'San Francisco, CA 94102, USA' },
            '94103': { city: 'San Francisco', state: 'CA', country: 'USA', fullName: 'San Francisco, CA 94103, USA' },
            '90001': { city: 'Los Angeles', state: 'CA', country: 'USA', fullName: 'Los Angeles, CA 90001, USA' },
            '90002': { city: 'Los Angeles', state: 'CA', country: 'USA', fullName: 'Los Angeles, CA 90002, USA' },
            '90003': { city: 'Los Angeles', state: 'CA', country: 'USA', fullName: 'Los Angeles, CA 90003, USA' },
            '33109': { city: 'Miami Beach', state: 'FL', country: 'USA', fullName: 'Miami Beach, FL 33109, USA' },
            '33139': { city: 'Miami Beach', state: 'FL', country: 'USA', fullName: 'Miami Beach, FL 33139, USA' },
            '33140': { city: 'Miami Beach', state: 'FL', country: 'USA', fullName: 'Miami Beach, FL 33140, USA' },
            '10021': { city: 'New York', state: 'NY', country: 'USA', fullName: 'New York, NY 10021, USA' },
            '10022': { city: 'New York', state: 'NY', country: 'USA', fullName: 'New York, NY 10022, USA' },
            '10023': { city: 'New York', state: 'NY', country: 'USA', fullName: 'New York, NY 10023, USA' },
            '10024': { city: 'New York', state: 'NY', country: 'USA', fullName: 'New York, NY 10024, USA' },
            '10025': { city: 'New York', state: 'NY', country: 'USA', fullName: 'New York, NY 10025, USA' }
        };

        // 邮编搜索功能
        function searchAddressByZipcode(type, searchValue) {
            const prefix = type === 'sender' ? 'sender' : 'receiver';
            const dropdown = document.getElementById(`${prefix}-address-dropdown`);
            
            dropdown.innerHTML = '';
            
            if (searchValue.length >= 3) {
                const results = [];
                
                for (const [zipcode, data] of Object.entries(usZipCodeData)) {
                    if (zipcode.startsWith(searchValue)) {
                        results.push({
                            zipcode: zipcode,
                            ...data
                        });
                    }
                }
                
                if (results.length > 0) {
                    dropdown.classList.remove('hidden');
                    results.forEach(result => {
                        const item = document.createElement('div');
                        item.className = 'px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0';
                        item.innerHTML = `
                            <div class="font-medium">${result.fullName}</div>
                            <div class="text-sm text-gray-600">邮编: ${result.zipcode}</div>
                        `;
                        item.onclick = () => selectAddress(type, result);
                        dropdown.appendChild(item);
                    });
                } else {
                    dropdown.classList.add('hidden');
                }
            } else {
                dropdown.classList.add('hidden');
            }
        }

        // 选择地址
        function selectAddress(type, addressData) {
            const prefix = type === 'sender' ? 'sender' : 'receiver';
            
            // 将邮编、城市、省州、国家显示在邮编搜索框内，与地址薄逻辑一致
            const locationInfo = `${addressData.zipcode}, ${addressData.city}, ${addressData.state}, ${addressData.country}`;
            document.getElementById(`${prefix}-postcode`).value = locationInfo;
            
            // 填充国家、省州和城市字段，并禁用这些字段
            document.getElementById(`${prefix}-country`).value = addressData.country;
            document.getElementById(`${prefix}-country`).disabled = true;
            
            document.getElementById(`${prefix}-province`).value = addressData.state;
            document.getElementById(`${prefix}-province`).disabled = true;
            
            document.getElementById(`${prefix}-city`).value = addressData.city;
            document.getElementById(`${prefix}-city`).disabled = true;
            
            document.getElementById(`${prefix}-address-dropdown`).classList.add('hidden');
            
            showNotification(`已选择地址: ${addressData.fullName}`, 'success');
        }

        // 取消表单
        function cancelForm() {
            if (confirm('确定要取消吗？未保存的信息将丢失。')) {
                // 清空表单数据
                clearAddressForm('sender');
                clearAddressForm('receiver');
                document.getElementById('pickup-date').value = '';
                palletRows = [];
                document.getElementById('product-list-container').innerHTML = '';
                calculateTotals();
                
                // 重置托盘信息
                document.getElementById('unit-status').classList.add('hidden');
                document.getElementById('product-table-container').classList.remove('hidden');
                document.getElementById('add-product-row').disabled = false;
                
                showNotification('已取消并清空表单', 'info');
            }
        }

        // 生成模拟报价数据
        function generateQuotationData() {
            const suppliers = [
                'Fast Logistics', 'Speed Express', 'Reliable Transport', 
                'Quick Ship', 'Safe Cargo', 'Express Delivery',
                'Premium Freight', 'Economy Shipping'
            ];
            
            const quotations = [];
            const today = new Date();
            
            // 生成未来7天的报价数据
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                // 每天生成3-5个不同供应商的报价
                const dailyQuotations = [];
                const quotationCount = Math.floor(Math.random() * 3) + 3; // 3-5个报价
                
                for (let j = 0; j < quotationCount; j++) {
                    const basePrice = 1200 + Math.random() * 800; // 1200-2000的基础价格
                    const price = Math.round(basePrice);
                    const supplier = suppliers[Math.floor(Math.random() * suppliers.length)];
                    
                    dailyQuotations.push({
                        date: date.toISOString().split('T')[0],
                        price: price,
                        supplier: supplier,
                        deliveryTime: 2 + Math.floor(Math.random() * 4) // 2-5天
                    });
                }
                
                // 按价格排序
                dailyQuotations.sort((a, b) => a.price - b.price);
                quotations.push(...dailyQuotations);
            }
            
            return quotations;
        }

        // 显示报价结果弹窗
        function showQuotationResult() {
            console.log('showQuotationResult函数被调用');
            
            // 生成报价数据
            const quotations = generateQuotationData();
            console.log('生成的报价数据:', quotations);
            
            // 按日期分组并排序
            const groupedByDate = {};
            quotations.forEach(q => {
                if (!groupedByDate[q.date]) {
                    groupedByDate[q.date] = [];
                }
                groupedByDate[q.date].push(q);
            });
            console.log('按日期分组后的报价:', groupedByDate);
            
            // 对每天的报价按价格排序
            Object.keys(groupedByDate).forEach(date => {
                groupedByDate[date].sort((a, b) => a.price - b.price);
            });
            
            // 获取所有日期并排序
            const sortedDates = Object.keys(groupedByDate).sort();
            console.log('排序后的日期:', sortedDates);
            
            // 显示弹窗
            let resultModal = document.getElementById('quotation-result-modal');
            let dateTabs, priceList;
            
            if (resultModal) {
                console.log('找到了quotation-result-modal元素，准备显示');
                // 强制显示弹窗
                resultModal.style.display = 'flex';
                resultModal.style.visibility = 'visible';
                resultModal.style.opacity = '1';
                resultModal.classList.remove('hidden');
                
                // 获取date-tabs和price-list元素
                dateTabs = document.getElementById('date-tabs');
                priceList = document.getElementById('price-list');
            } else {
                console.log('未找到quotation-result-modal元素，动态创建中...');
                // 动态创建报价结果弹窗
                resultModal = document.createElement('div');
                resultModal.id = 'quotation-result-modal';
                resultModal.className = 'modal-overlay';
                resultModal.style.cssText = 'display: flex; visibility: visible; opacity: 1; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center; z-index: 1000;';
                
                // 创建完整的弹窗内容
                resultModal.innerHTML = `
                    <div class="modal-content" style="max-width: 900px; width: 100%; background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);">
                        <div class="modal-header" style="padding: 16px 20px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                            <h3 class="modal-title" style="margin: 0; font-size: 18px; font-weight: 600;">
                                <i class="fas fa-chart-line mr-2"></i>报价查询
                            </h3>
                            <button class="modal-close" onclick="closeQuotationResult()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #6b7280;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <h4 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 500;">近7天报价情况</h4>
                            <div id="date-tabs" class="date-tabs" style="display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap;"></div>
                            <div id="price-list" class="price-list" style="border: 1px solid #e5e7eb; border-radius: 6px; padding: 16px;"></div>
                            <div class="text-gray-500 text-sm mt-4" style="color: #6b7280; font-size: 14px;">
                                注：以上报价仅为参考，实际价格可能因市场情况有所波动
                            </div>
                        </div>
                        <div class="modal-footer" style="padding: 16px 20px; border-top: 1px solid #e5e7eb; display: flex; justify-content: center; gap: 10px;">
                            <button onclick="closeQuotationResult()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">取消</button>
                            <button id="confirm-order-btn" onclick="confirmOrder()" class="btn-primary px-6 py-2 font-medium" disabled>确认下单</button>
                        </div>
                    </div>
                `;
                
                // 将弹窗添加到文档
                document.body.appendChild(resultModal);
                
                // 获取动态创建的date-tabs和price-list元素
                dateTabs = resultModal.querySelector('#date-tabs');
                priceList = resultModal.querySelector('#price-list');
            }
            
            // 确保dateTabs和priceList存在
            if (!dateTabs || !priceList) {
                console.error('date-tabs或price-list元素不存在');
                // 创建简单的价格列表显示
                if (resultModal) {
                    const modalBody = resultModal.querySelector('.modal-body');
                    if (modalBody) {
                        modalBody.innerHTML += `
                            <div class="mt-4">
                                <h5>未来7天报价概览</h5>
                                <ul style="list-style-type: disc; padding-left: 20px;">
                                    ${sortedDates.map(date => {
                                        const dayQuotations = groupedByDate[date];
                                        const lowestPrice = dayQuotations[0].price;
                                        return `<li>${date}: ¥${lowestPrice.toLocaleString()}起</li>`;
                                    }).join('')}
                                </ul>
                            </div>
                        `;
                    }
                }
                return;
            }
            
            console.log('date-tabs和price-list元素已准备好，开始生成内容');
            
            // 生成日期标签
            dateTabs.innerHTML = '';
            
            sortedDates.forEach((date, index) => {
                const dateObj = new Date(date);
                const weekDay = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'][dateObj.getDay()];
                const dayQuotations = groupedByDate[date];
                const lowestPrice = dayQuotations[0].price;
                
                const dateTab = document.createElement('button');
                dateTab.className = `date-tab px-4 py-2 rounded-lg border transition-all duration-200 ${
                    index === 0 ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-700 border-gray-300 hover:border-blue-400'
                }`;
                dateTab.setAttribute('data-date', date);
                dateTab.innerHTML = `
                    <div class="text-sm font-medium">${dateObj.getMonth() + 1}月${dateObj.getDate()}日</div>
                    <div class="text-xs ${index === 0 ? 'text-blue-100' : 'text-gray-500'}">${weekDay}</div>
                    <div class="text-xs font-bold ${index === 0 ? 'text-blue-100' : 'text-green-600'}">¥${lowestPrice.toLocaleString()}起</div>
                `;
                
                dateTab.onclick = () => selectDate(date, dateTab);
                dateTabs.appendChild(dateTab);
            });
            
            // 默认显示第一天的价格
            if (sortedDates.length > 0) {
                const firstDateTab = dateTabs.querySelector('.date-tab');
                if (firstDateTab) {
                    selectDate(sortedDates[0], firstDateTab);
                }
            }
        }

        // 选择日期显示对应的价格列表
        function selectDate(date, selectedTab) {
            // 添加切换动画效果
            const priceList = document.getElementById('price-list');
            if (priceList) {
                priceList.style.opacity = '0';
                priceList.style.transform = 'translateY(10px)';
                
                setTimeout(() => {
                    // 更新标签样式
                    document.querySelectorAll('.date-tab').forEach(tab => {
                        tab.className = 'date-tab px-4 py-2 rounded-lg border transition-all duration-200 bg-white text-gray-700 border-gray-300 hover:border-blue-400 hover:shadow-sm';
                        tab.querySelectorAll('div')[1].className = 'text-xs text-gray-500';
                        tab.querySelectorAll('div')[2].className = 'text-xs font-bold text-green-600';
                    });
                    
                    selectedTab.className = 'date-tab px-4 py-2 rounded-lg border transition-all duration-200 bg-blue-600 text-white border-blue-600 shadow-lg transform scale-105';
                    selectedTab.querySelectorAll('div')[1].className = 'text-xs text-blue-100';
                    selectedTab.querySelectorAll('div')[2].className = 'text-xs font-bold text-blue-100';
                    
                    // 获取选中日期的报价数据
                    const quotations = generateQuotationData();
                    const groupedByDate = {};
                    quotations.forEach(q => {
                        if (!groupedByDate[q.date]) {
                            groupedByDate[q.date] = [];
                        }
                        groupedByDate[q.date].push(q);
                    });
                    
                    // 对每天的报价按价格排序
                    Object.keys(groupedByDate).forEach(date => {
                        groupedByDate[date].sort((a, b) => a.price - b.price);
                    });
                    
                    const dayQuotations = groupedByDate[date];
                    
                    // 生成价格列表
                    priceList.innerHTML = '';
                    
                    // 添加日期标题
                    const dateObj = new Date(date);
                const weekDay = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'][dateObj.getDay()];
                
                const dateHeader = document.createElement('div');
                dateHeader.className = 'bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 mb-4 shadow-sm';
                dateHeader.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-blue-800">
                                ${dateObj.getMonth() + 1}月${dateObj.getDate()}日 ${weekDay}
                            </h3>
                            <p class="text-sm text-blue-600">共 ${dayQuotations.length} 个车队报价</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-600">最低价格</p>
                            <p class="text-2xl font-bold text-green-600">¥${dayQuotations[0].price.toLocaleString()}</p>
                        </div>
                    </div>
                `;
                priceList.appendChild(dateHeader);
                
                // 生成价格条目
                dayQuotations.forEach((quotation, index) => {
                    const priceItem = document.createElement('div');
                    const isLowest = index === 0;
                    
                    priceItem.className = `price-item border rounded-lg p-4 transition-all duration-300 mb-3 ${
                        isLowest ? 'border-green-400 bg-green-50 shadow-md' : 'border-gray-200 bg-white hover:border-blue-300 hover:shadow-md'
                    }`;
                    priceItem.style.opacity = '0';
                    priceItem.style.transform = 'translateY(20px)';
                    
                    priceItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                ${isLowest ? '<div class="bg-green-500 text-white px-2 py-1 rounded text-xs font-bold animate-pulse">最低价</div>' : ''}
                                <div>
                                    <div class="font-semibold text-lg ${isLowest ? 'text-green-700' : 'text-gray-800'}">
                                        ¥${quotation.price.toLocaleString()}
                                    </div>
                                    <div class="text-sm text-gray-600">${quotation.supplier}</div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-6">
                                <div class="text-center">
                                    <div class="text-xs text-gray-500">时效</div>
                                    <div class="text-sm font-medium">${quotation.deliveryTime}天</div>
                                </div>
                                <button class="px-4 py-2 ${isLowest ? 'bg-green-600 hover:bg-green-700' : 'bg-blue-600 hover:bg-blue-700'} text-white rounded-lg transition-all duration-200 text-sm hover:shadow-lg transform hover:scale-105 select-quotation-btn">
                                    下单
                                </button>
                            </div>
                        </div>
                    `;
                    
                    // 添加选择报价的点击事件
                    const selectBtn = priceItem.querySelector('.select-quotation-btn');
                    selectBtn.onclick = () => selectQuotation(quotation, priceItem);
                    
                    priceList.appendChild(priceItem);
                    
                    // 添加渐入动画
                    setTimeout(() => {
                        priceItem.style.opacity = '1';
                        priceItem.style.transform = 'translateY(0)';
                    }, 100 + index * 50);
                });
                
                // 恢复价格列表显示
                setTimeout(() => {
                    priceList.style.opacity = '1';
                    priceList.style.transform = 'translateY(0)';
                }, 50);
            }, 200);
        }
    }

        // 选择报价的处理函数
        function selectQuotation(quotation, priceItem) {
            // 移除其他选中状态
            document.querySelectorAll('.price-item').forEach(item => {
                item.classList.remove('ring-2', 'ring-blue-500', 'bg-blue-50');
                const btn = item.querySelector('.select-quotation-btn');
                if (btn) {
                    btn.textContent = '下单';
                    btn.classList.remove('bg-gray-600', 'hover:bg-gray-700');
                    // 分开添加类名，避免InvalidCharacterError
                    if (btn.classList.contains('bg-green-600')) {
                        btn.classList.add('bg-green-600', 'hover:bg-green-700');
                    } else {
                        btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    }
                }
            });
            
            // 添加选中状态
            priceItem.classList.add('ring-2', 'ring-blue-500', 'bg-blue-50');
            const selectBtn = priceItem.querySelector('.select-quotation-btn');
            selectBtn.textContent = '已选择';
            selectBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700', 'bg-green-600', 'hover:bg-green-700');
            selectBtn.classList.add('bg-gray-600', 'hover:bg-gray-700');
            
            // 显示选中提示
            showNotification(`已选择 ${quotation.supplier} 的报价：¥${quotation.price.toLocaleString()}，点击"确定"完成下单`, 'success');
            
            // 保存选中的报价信息
            selectedQuotation = quotation;
            
            // 启用确认下单按钮
            const confirmBtn = document.getElementById('confirm-order-btn');
            if (confirmBtn) {
                confirmBtn.disabled = false;
            }
        }

        // 显示通知消息函数已在前面定义，此处不再重复

        // 关闭报价结果弹窗
        function closeQuotationResult() {
            const resultModal = document.getElementById('quotation-result-modal');
            if (resultModal) {
                // 确保能正确关闭弹窗，无论它是静态还是动态创建的
                resultModal.style.display = 'none';
                resultModal.style.visibility = 'hidden';
                resultModal.classList.add('hidden');
            }
        }

        // 提交询价
        function submitInquiry() {
            console.log('submitInquiry函数被调用');
            
            // 显示通知
            showNotification('正在处理询价，请勿关闭页面', 'info');
            
            // 动态创建等待弹窗
            let waitingModal = document.getElementById('inquiry-waiting-modal');
            
            if (!waitingModal) {
                console.log('动态创建等待弹窗');
                // 创建弹窗容器
                waitingModal = document.createElement('div');
                waitingModal.id = 'inquiry-waiting-modal';
                waitingModal.className = 'modal-overlay';
                waitingModal.style.cssText = 'display: flex; visibility: visible; opacity: 1;';
                
                // 弹窗内容
                waitingModal.innerHTML = `
                    <div class="modal-content" style="max-width: 500px;">
                        <div class="modal-header">
                            <h3 class="modal-title">
                                <i class="fas fa-clock mr-2"></i>询价处理中
                            </h3>
                        </div>
                        <div class="modal-body text-center py-8">
                            <div class="mb-6">
                                <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4">
                                    <i class="fas fa-spinner fa-spin text-blue-600 text-2xl"></i>
                                </div>
                                <h4 class="text-xl font-semibold mb-2">正在为您查询最优报价</h4>
                                <p class="text-gray-600 mb-4">系统正在向多个车队发送询价请求</p>
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <p class="text-sm text-blue-800">
                                        <i class="fas fa-info-circle mr-2"></i>
                                        预计需要 <strong>5-10分钟</strong> 完成询价
                                    </p>
                                </div>
                            </div>
                            <div class="space-y-2 text-left max-w-sm mx-auto">
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                    已获取提货地址信息
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                    已获取收货地址信息
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                    已获取托盘信息
                                </div>
                                <div class="flex items-center text-sm text-blue-600">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>
                                    正在向车队发送询价...
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer centered">
                            <button type="button" class="btn btn-primary" onclick="confirmInquiry()">
                                确定
                            </button>
                        </div>
                    </div>
                `;
                
                // 添加到文档
                document.body.appendChild(waitingModal);
            } else {
                // 显示现有弹窗
                waitingModal.style.display = 'flex';
                waitingModal.style.visibility = 'visible';
                waitingModal.style.opacity = '1';
                waitingModal.classList.remove('hidden');
            }
            
            console.log('等待弹窗已显示:', waitingModal);
            
            // 模拟询价过程
            setTimeout(() => {
                console.log('2秒后，关闭等待弹窗，显示报价结果');
                
                // 关闭等待弹窗
                const waitingModal = document.getElementById('inquiry-waiting-modal');
                if (waitingModal) {
                    waitingModal.classList.add('hidden');
                    waitingModal.style.display = 'none';
                }
                
                // 显示报价结果
                showQuotationResult();
            }, 2000); // 2秒后显示结果
        }
        
        // 确认下单
        function confirmOrder() {
            if (!selectedQuotation) {
                showNotification('请先选择一个报价', 'warning');
                return;
            }
            
            // 显示确认信息
            const confirmMessage = `
                您已选择以下报价：
                供应商：${selectedQuotation.supplier}
                日期：${selectedQuotation.date}
                价格：¥${selectedQuotation.price.toLocaleString()}
                时效：${selectedQuotation.deliveryTime}天
                
                确认下单吗？
            `;
            
            if (confirm(confirmMessage)) {
                // 这里可以添加实际的下单逻辑，比如调用API
                
                // 关闭报价结果弹窗
                closeQuotationResult();
                
                // 显示下单成功提示弹窗
                showOrderSuccessModal();
            }
        }
        
        // 显示下单成功提示弹窗
        function showOrderSuccessModal() {
            // 移除现有弹窗（如果存在）
            let successModal = document.getElementById('order-success-modal');
            if (successModal) {
                successModal.remove();
            }
            
            // 创建成功提示弹窗
            successModal = document.createElement('div');
            successModal.id = 'order-success-modal';
            successModal.className = 'modal-overlay';
            successModal.style.cssText = 'display: flex; visibility: visible; opacity: 1;';
            
            successModal.innerHTML = `
                <div class="modal-content" style="max-width: 400px;">
                    <div class="modal-header">
                        <h3 class="modal-title">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>下单成功！
                        </h3>
                    </div>
                    <div class="modal-body py-6">
                        <div class="text-center mb-4">
                            <div class="inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4">
                                <i class="fas fa-check text-green-600 text-3xl"></i>
                            </div>
                            <p class="text-lg font-semibold text-gray-800">您的订单已提交成功！</p>
                            <p class="text-gray-600 mt-2">订单号：${generateOrderNumber()}</p>
                        </div>
                    </div>
                    <div class="modal-footer centered space-x-4">
                        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors" onclick="closeOrderSuccessModal()">
                            查看订单
                        </button>
                        <button type="button" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" onclick="resetPage()">
                            继续下单
                        </button>
                    </div>
                </div>
            `;
            
            // 添加到文档
            document.body.appendChild(successModal);
        }
        
        // 关闭下单成功弹窗
        function closeOrderSuccessModal() {
            const successModal = document.getElementById('order-success-modal');
            if (successModal) {
                successModal.remove();
            }
            // 这里可以添加查看订单的逻辑
        }
        
        // 重置页面
        function resetPage() {
            // 关闭成功弹窗
            closeOrderSuccessModal();
            
            // 重置选中的报价
            selectedQuotation = null;
            
            // 重置所有表单字段
            document.querySelectorAll('form input, form select, form textarea').forEach(field => {
                if (field.type === 'checkbox' || field.type === 'radio') {
                    field.checked = false;
                } else {
                    field.value = '';
                }
            });
            
            // 重置确认下单按钮状态
            const confirmBtn = document.getElementById('confirm-order-btn');
            if (confirmBtn) {
                confirmBtn.disabled = true;
            }
            
            // 重置托盘列表
            const palletTable = document.getElementById('pallet-list');
            if (palletTable) {
                const tbody = palletTable.querySelector('tbody');
                if (tbody) {
                    tbody.innerHTML = '';
                }
            }
            
            // 重置地址信息
            document.querySelectorAll('[id*="address-detail"]').forEach(el => {
                el.innerHTML = '<span class="text-red-500">未选择地址</span>';
            });
            
            // 重置数量统计
            const totalWeightEl = document.getElementById('total-weight');
            if (totalWeightEl) {
                totalWeightEl.textContent = '0 kg';
            }
            const totalVolumeEl = document.getElementById('total-volume');
            if (totalVolumeEl) {
                totalVolumeEl.textContent = '0 m³';
            }
            
            // 刷新页面以确保完全重置
            location.reload();
        }
        
        // 生成订单号
        function generateOrderNumber() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return `ELSA${year}${month}${day}${hours}${minutes}${seconds}${random}`;
        }

        // 关闭询价等待弹窗
        function closeInquiryWaiting() {
            const waitingModal = document.getElementById('inquiry-waiting-modal');
            if (waitingModal) {
                waitingModal.classList.add('hidden');
            }
            showNotification('询价将在后台继续处理，完成后将通知您', 'info');
        }

        // 确定询价并完成下单
        function confirmInquiry() {
            // 关闭弹窗
            const waitingModal = document.getElementById('inquiry-waiting-modal');
            if (waitingModal) {
                waitingModal.classList.add('hidden');
            }
            
            // 显示成功提示
            showNotification('询价提交成功！', 'success');
            
            // 刷新页面，清空所有填写的数据
            setTimeout(() => {
                location.reload();
            }, 1000);
        }

        // 保存询价并返回函数已删除

        // 保存表单函数已删除

        // 表单验证
        function validateForm() {
            console.log('validateForm函数被调用');
            const errors = [];
            
            const senderPostcode = document.getElementById('sender-postcode').value.trim();
            const receiverPostcode = document.getElementById('receiver-postcode').value.trim();
            const pickupDate = document.getElementById('pickup-date').value;
            
            // 简化验证逻辑，只保留必要的验证项
            
            // 验证提货地址邮编为必填
            if (!senderPostcode) {
                errors.push('请选择提货地址（邮编搜索）');
            }
            
            // 验证收货地址邮编为必填
            if (!receiverPostcode) {
                errors.push('请选择收货地址（邮编搜索）');
            }
            
            // 验证提货日期为必填
            if (!pickupDate) {
                errors.push('请选择提货日期');
            }
            
            // 验证至少添加一个托盘
            if (palletRows.length === 0) {
                errors.push('请至少添加一个托盘');
            }
            
            console.log('验证错误列表:', errors);
            
            if (errors.length > 0) {
                showNotification('表单验证失败：' + errors.join('；'), 'error');
                console.log('表单验证失败，返回false');
                return false;
            }
            
            console.log('表单验证通过，返回true');
            return true;
        }

        // 点击页面其他地方关闭下拉列表
        document.addEventListener('click', function(event) {
            // 关闭地址下拉列表
            if (!event.target.closest('.relative')) {
                document.querySelectorAll('[id$="-address-dropdown"]').forEach(dropdown => {
                    dropdown.classList.add('hidden');
                });
            }
            
            // 关闭下拉勾选框
            if (!event.target.closest('.dropdown-checkbox-container')) {
                document.querySelectorAll('.dropdown-checkbox-options').forEach(dropdown => {
                    dropdown.classList.add('hidden');
                });
                document.querySelectorAll('.dropdown-arrow').forEach(arrow => {
                    arrow.classList.remove('rotated');
                });
            }
        });

        // 切换下拉勾选框显示/隐藏
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const arrow = dropdown.previousElementSibling.querySelector('.dropdown-arrow');
            
            // 关闭其他所有下拉勾选框
            document.querySelectorAll('.dropdown-checkbox-options').forEach(otherDropdown => {
                if (otherDropdown.id !== dropdownId) {
                    otherDropdown.classList.add('hidden');
                }
            });
            
            document.querySelectorAll('.dropdown-arrow').forEach(otherArrow => {
                if (otherArrow !== arrow) {
                    otherArrow.classList.remove('rotated');
                }
            });
            
            // 切换当前下拉框
            dropdown.classList.toggle('hidden');
            arrow.classList.toggle('rotated');
        }

        // 更新选中项文本显示
        function updateSelectedText(prefix) {
            const dropdown = document.getElementById(`${prefix}-dropdown`);
            const selectedText = document.getElementById(`${prefix}-selected`);
            const checkboxes = dropdown.querySelectorAll('input[type="checkbox"]:checked');
            
            // 根据前缀确定默认提示文本
            const defaultText = prefix === 'sender-pickup' ? '请选择提货服务' : '请选择配送服务';
            
            if (checkboxes.length === 0) {
                selectedText.textContent = defaultText;
                selectedText.classList.add('placeholder');
                selectedText.title = ''; // 清空悬浮提示
            } else {
                const selectedValues = Array.from(checkboxes).map(cb => cb.nextElementSibling.textContent);
                let displayText = '';
                
                // 优化展示逻辑：默认展示第一个选择内容，其余通过+数据展示
                if (checkboxes.length === 1) {
                    displayText = selectedValues[0];
                } else {
                    displayText = `${selectedValues[0]} +${checkboxes.length - 1}`;
                }
                
                // 设置悬浮提示，显示所有选中项
                selectedText.title = selectedValues.join(', ');
                selectedText.textContent = displayText;
                selectedText.classList.remove('placeholder');
            }
        }

        // 获取下拉勾选框选中的值
        function getDropdownSelectedValues(prefix) {
            const dropdown = document.getElementById(`${prefix}-dropdown`);
            const checkboxes = dropdown.querySelectorAll('input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // 地址薄功能
        let addressBookCurrentType = ''; // 当前选择的地址类型（sender/receiver）
        let currentCategory = 'all'; // 当前分类筛选

        // 预设地址数据
        const addressBookData = {
            selfOperated: [
                {
                    id: 'self_001',
                    name: 'Demo LA Warehouse',
                    contact: 'John Smith',
                    phone: '+1-555-0101',
                    address: '1234 Aviation Blvd',
                    city: 'Los Angeles',
                    state: 'CA',
                    country: 'USA',
                    zipcode: '90045',
                    services: ['Standard Delivery', 'Express Delivery', 'Storage Service']
                },
                {
                    id: 'self_002',
                    name: 'Demo NYC Warehouse',
                    contact: 'Michael Johnson',
                    phone: '+1-555-0102',
                    address: '5678 JFK Boulevard',
                    city: 'New York',
                    state: 'NY',
                    country: 'USA',
                    zipcode: '11430',
                    services: ['Standard Delivery', 'Air Freight', 'International Shipping']
                },
                {
                    id: 'self_003',
                    name: 'Demo Chicago Warehouse',
                    contact: 'Robert Davis',
                    phone: '+1-555-0103',
                    address: '9012 O\'Hare Drive',
                    city: 'Chicago',
                    state: 'IL',
                    country: 'USA',
                    zipcode: '60666',
                    services: ['Standard Delivery', 'Express Delivery', 'Freight Service']
                }
            ],
            platform: [
                {
                    id: 'platform_001',
                    name: 'Demo Miami Platform',
                    contact: 'Maria Garcia',
                    phone: '+1-555-0201',
                    address: '3456 NW 25th St',
                    city: 'Miami',
                    state: 'FL',
                    country: 'USA',
                    zipcode: '33142',
                    services: ['Standard Delivery', 'Express Delivery', 'Last Mile Delivery']
                },
                {
                    id: 'platform_002',
                    name: 'Demo Seattle Platform',
                    contact: 'James Wilson',
                    phone: '+1-555-0202',
                    address: '7890 Sea-Tac Airport Rd',
                    city: 'Seattle',
                    state: 'WA',
                    country: 'USA',
                    zipcode: '98158',
                    services: ['Standard Delivery', 'Air Freight', 'Regional Distribution']
                },
                {
                    id: 'platform_003',
                    name: 'Demo Dallas Platform',
                    contact: 'Jennifer Brown',
                    phone: '+1-555-0203',
                    address: '2345 Logistics Pkwy',
                    city: 'Dallas',
                    state: 'TX',
                    country: 'USA',
                    zipcode: '75261',
                    services: ['Standard Delivery', 'Express Delivery', 'Cross-country Shipping']
                }
            ]
        };

        // 打开地址薄弹窗
        function openAddressBook(type) {
            addressBookCurrentType = type;
            currentCategory = 'all';
            
            const modal = document.getElementById('address-book-modal');
            const title = document.querySelector('#address-book-modal .modal-title');
            
            // 设置标题
            if (title) {
                title.innerHTML = `<i class="fas fa-address-book mr-2"></i>${type === 'sender' ? '选择提货地址' : '选择收货地址'}`;
            }
            
            // 重置搜索框
            const searchInput = document.getElementById('address-book-search');
            if (searchInput) {
                searchInput.value = '';
            }
            
            // 重置分类标签
            switchAddressCategory('all');
            
            // 显示弹窗
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // 渲染地址列表
            renderAddressList();
        }

        // 关闭地址薄弹窗
        function closeAddressBook() {
            const modal = document.getElementById('address-book-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // 切换地址分类
        function switchAddressCategory(category) {
            currentCategory = category;
            
            // 更新标签样式
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => {
                if (tab.dataset.category === category) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // 重新渲染地址列表
            renderAddressList();
        }

        // 搜索地址
        function filterAddressBook() {
            renderAddressList();
        }

        // 渲染地址列表
        function renderAddressList() {
            const container = document.getElementById('address-list');
            const searchInput = document.getElementById('address-book-search');
            const searchValue = searchInput ? searchInput.value.toLowerCase() : '';
            
            // 获取要显示的地址数据
            let addresses = [];
            
            if (currentCategory === 'all') {
                addresses = [...addressBookData.selfOperated, ...addressBookData.platform];
            } else if (currentCategory === 'selfOperated') {
                addresses = addressBookData.selfOperated;
            } else if (currentCategory === 'platform') {
                addresses = addressBookData.platform;
            }
            
            // 搜索过滤
            if (searchValue) {
                addresses = addresses.filter(addr => 
                    addr.name.toLowerCase().includes(searchValue) ||
                    addr.contact.toLowerCase().includes(searchValue) ||
                    addr.address.toLowerCase().includes(searchValue) ||
                    addr.zipcode.includes(searchValue)
                );
            }
            
            // 清空容器
            container.innerHTML = '';
            
            if (addresses.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-search text-3xl mb-2"></i>
                        <p>未找到匹配的地址</p>
                    </div>
                `;
                return;
            }
            
            // 渲染地址项
            addresses.forEach(address => {
                const isSelfOperated = addressBookData.selfOperated.some(addr => addr.id === address.id);
                const addressItem = document.createElement('div');
                addressItem.className = 'address-item';
                addressItem.innerHTML = `
                    <div class="address-header">
                        <div class="address-name">${address.name}</div>
                        <div class="address-type ${isSelfOperated ? 'self-operated' : 'platform'}">
                            ${isSelfOperated ? '自营仓' : '平台仓'}
                        </div>
                    </div>
                    <div class="address-contact">
                        <i class="fas fa-user mr-1"></i>${address.contact} 
                        <i class="fas fa-phone ml-2 mr-1"></i>${address.phone}
                    </div>
                    <div class="address-detail">
                        <i class="fas fa-map-marker-alt mr-1"></i>${address.address}, ${address.city}, ${address.state}, ${address.country}, ${address.zipcode}
                    </div>
                    <div class="address-services">
                        ${address.services.map(service => `<span class="service-tag">${service}</span>`).join('')}
                    </div>
                `;
                
                // 添加点击事件
                addressItem.addEventListener('click', () => selectAddressFromBook(address));
                
                container.appendChild(addressItem);
            });
        }

        // 清空地址表单
        function clearAddressForm(type) {
            const prefix = type;
            
            // 清空所有字段
            document.getElementById(`${prefix}-postcode`).value = '';
            document.getElementById(`${prefix}-country`).value = '';
            document.getElementById(`${prefix}-province`).value = '';
            document.getElementById(`${prefix}-city`).value = '';
            document.getElementById(`${prefix}-address`).value = '';
            document.getElementById(`${prefix}-name`).value = '';
            document.getElementById(`${prefix}-phone`).value = '';
            
            // 清空地址类型选择
            const addressTypeRadios = document.querySelectorAll(`input[name="${prefix}-address-type"]`);
            addressTypeRadios.forEach(radio => radio.checked = false);
            
            // 清空服务选择
            const serviceCheckboxes = document.querySelectorAll(`input[name="${prefix}-service"]:checked`);
            serviceCheckboxes.forEach(checkbox => checkbox.checked = false);
            
            // 显示清空成功提示
            const typeName = type === 'sender' ? '提货地址' : '收货地址';
            showNotification(`${typeName}表单已清空`, 'info');
        }

        // 从地址薄选择地址
        function selectAddressFromBook(address) {
            const prefix = addressBookCurrentType === 'sender' ? 'sender' : 'receiver';
            
            // 将城市、省州、国家、邮编显示在邮编搜索内
            const locationInfo = `${address.city}, ${address.state}, ${address.country}, ${address.zipcode}`;
            document.getElementById(`${prefix}-postcode`).value = locationInfo;
            
            // 填充国家、省州和城市字段，并禁用这些字段
            document.getElementById(`${prefix}-country`).value = address.country;
            document.getElementById(`${prefix}-country`).disabled = true;
            
            document.getElementById(`${prefix}-province`).value = address.state;
            document.getElementById(`${prefix}-province`).disabled = true;
            
            document.getElementById(`${prefix}-city`).value = address.city;
            document.getElementById(`${prefix}-city`).disabled = true;
            
            // 其他信息展示在详细地址里，并保持启用状态
            document.getElementById(`${prefix}-address`).value = address.address;
            document.getElementById(`${prefix}-address`).disabled = false;
            
            document.getElementById(`${prefix}-name`).value = address.contact;
            document.getElementById(`${prefix}-name`).disabled = false;
            
            document.getElementById(`${prefix}-phone`).value = address.phone;
            document.getElementById(`${prefix}-phone`).disabled = false;
            
            // 关闭弹窗
            closeAddressBook();
            
            // 显示成功提示
            showNotification(`已选择${address.name}的地址信息`, 'success');
        }

        // 重置货运选项
        function resetShippingOptions() {
            document.getElementById('shipping-type').value = 'standard';
            document.getElementById('insurance-none').checked = true;
            document.getElementById('special-fragile').checked = false;
            document.getElementById('special-temperature').checked = false;
            document.getElementById('special-hazardous').checked = false;
            document.getElementById('shipping-notes').value = '';
            showNotification('货运选项已重置', 'info');
        }

        // 页面加载完成初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 启用地址搜索字段
            document.querySelectorAll('[id$="-address-search"]').forEach(field => {
                field.disabled = false;
            });
            
            // 启用添加托盘按钮
            document.getElementById('add-product-row').disabled = false;
            
            // 自动添加一行产品
            setTimeout(() => {
                addProductRow();
            }, 100);
        });
    </script>

    <!-- 地址薄弹窗 -->
    <div id="address-book-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-address-book mr-2"></i>选择地址
                </h3>
                <button type="button" class="modal-close" onclick="closeAddressBook()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- 搜索框 -->
                <div class="search-section">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="address-book-search" 
                               class="search-input" 
                               placeholder="搜索地址名称、联系人或地址..."
                               onkeyup="filterAddressBook()">
                    </div>
                </div>
                
                <!-- 地址分类标签 -->
                <div class="address-tabs">
                    <button type="button" class="tab-btn active" data-category="all" onclick="switchAddressCategory('all')">
                        全部地址
                    </button>
                    <button type="button" class="tab-btn" data-category="selfOperated" onclick="switchAddressCategory('selfOperated')">
                        自营仓
                    </button>
                    <button type="button" class="tab-btn" data-category="platform" onclick="switchAddressCategory('platform')">
                        平台仓
                    </button>
                </div>
                
                <!-- 地址列表 -->
                <div class="address-list" id="address-list">
                    <!-- 地址项将通过JavaScript动态生成 -->
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeAddressBook()">
                    取消
                </button>
            </div>
        </div>
    </div>

    <!-- 托盘智能识别弹窗 -->
    <div id="pallet-parser-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-magic mr-2"></i>批量识别托盘信息
                </h3>
                <button type="button" class="modal-close" onclick="closePalletParserModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="space-y-4">
                    <!-- 输入区域 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            托盘信息输入
                        </label>
                        <textarea 
                            id="batch-pallet-input" 
                            rows="8" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="输入托盘信息，每行一个托盘，支持以下格式：
    支持的分隔符：空格或横线(-)

                        ></textarea>
                        <div class="mt-2 text-xs text-gray-500">
                            <p><strong>格式说明：</strong>数量pallets[分隔符]长*宽*高单位[分隔符]重量单位</p>
                            <p><strong>支持单位：</strong>INCH/LBS（英寸/磅）或 CM/KG（厘米/千克）</p>
                            <p><strong>批量输入：</strong>每行输入一个托盘信息，可一次识别多个托盘</p>
                        </div>
                    </div>
                    
                    <!-- 预览区域 -->
                    <div id="batch-pallet-preview" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            识别结果预览
                        </label>
                        <div id="batch-pallet-preview-content" class="max-h-40 overflow-y-auto bg-gray-50 rounded-lg p-3 text-sm">
                            <!-- 预览内容将通过JavaScript动态生成 -->
                        </div>
                    </div>
                    
                    <!-- 统计信息 -->
                    <div id="batch-pallet-stats" class="hidden">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <div class="text-sm text-blue-800">
                                <i class="fas fa-info-circle mr-2"></i>
                                <span id="batch-pallet-stats-text"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closePalletParserModal()">
                    取消
                </button>
                <button type="button" class="btn btn-primary" onclick="previewBatchPalletInput()">
                    <i class="fas fa-eye mr-2"></i>预览识别结果
                </button>
                <button type="button" class="btn btn-success" onclick="confirmBatchPalletParsing()" disabled id="confirm-batch-parsing">
                    <i class="fas fa-check mr-2"></i>确认添加托盘
                </button>
            </div>
        </div>
    </div>

    <!-- 报价结果弹窗 -->
    <div id="quotation-result-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-chart-line mr-2"></i>报价查询
                </h3>
                <button class="modal-close" onclick="closeQuotationResult()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- 12306风格价格展示 -->
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4">
                        <h4 class="text-lg font-semibold flex items-center">
                            <i class="fas fa-calendar-alt mr-2"></i>
                            报价详情（近7天报价情况）
                        </h4>
                        <p class="text-sm text-blue-100 mt-1">请等待5-10分钟，系统会自动更新报价信息。</p>
                    </div>
                    
                    <!-- 日期选择标签 -->
                    <div class="border-b border-gray-200 bg-gray-50 p-3">
                        <div id="date-tabs" class="flex space-x-2 overflow-x-auto">
                            <!-- 日期标签将动态生成 -->
                        </div>
                    </div>
                    
                    <!-- 价格列表 -->
                    <div class="p-4">
                        <div id="price-list" class="space-y-2">
                            <!-- 价格列表将动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 询价等待弹窗 -->
    <div id="inquiry-waiting-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-clock mr-2"></i>询价处理中
                </h3>
            </div>
            
            <div class="modal-body text-center py-8">
                <div class="mb-6">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4">
                        <i class="fas fa-spinner fa-spin text-blue-600 text-2xl"></i>
                    </div>
                    <h4 class="text-xl font-semibold mb-2">正在为您查询最优报价</h4>
                    <p class="text-gray-600 mb-4">系统正在向多个车队发送询价请求</p>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <p class="text-sm text-blue-800">
                            <i class="fas fa-info-circle mr-2"></i>
                            预计需要 <strong>5-10分钟</strong> 完成询价
                        </p>
                    </div>
                </div>
                
                <div class="space-y-2 text-left max-w-sm mx-auto">
                    <div class="flex items-center text-sm text-gray-600">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        已获取提货地址信息
                    </div>
                    <div class="flex items-center text-sm text-gray-600">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        已获取收货地址信息
                    </div>
                    <div class="flex items-center text-sm text-gray-600">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        已获取托盘信息
                    </div>
                    <div class="flex items-center text-sm text-blue-600">
                        <i class="fas fa-spinner fa-spin mr-2"></i>
                        正在向车队发送询价...
                    </div>
                </div>
            </div>
            
            <div class="modal-footer centered">
                <button type="button" class="btn btn-primary" onclick="confirmInquiry()">
                    确定
                </button>
            </div>
        </div>
    </div>
</body>
</html>