<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>排柜计划看板</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            success: '#52C41A',
            warning: '#FAAD14',
            danger: '#FF4D4F',
            dark: '#1F2937',
            light: '#F3F4F6'
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .card-shadow {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }
      /* Tab栏样式 */
      .timeline-tabs {
        @apply flex overflow-x-auto scrollbar-hide border-b border-gray-200;
      }
      .timeline-tab {
        @apply flex-shrink-0 px-6 py-3 text-center cursor-pointer transition-all duration-300 relative whitespace-nowrap;
      }
      .timeline-tab.timeline-active {
        @apply text-primary font-medium;
      }
      .timeline-tab.timeline-inactive {
        @apply text-gray-600 hover:text-primary;
      }
      .timeline-tab::after {
        content: '';
        @apply absolute bottom-0 left-0 w-0 h-1 bg-primary transition-all duration-300;
      }
      .timeline-tab.timeline-active::after {
        @apply w-full;
      }
      .timeline-tab-week {
        @apply block text-sm font-medium transition-all duration-300;
      }
      .timeline-tab-date {
        @apply block text-xs text-gray-500 transition-all duration-300;
      }
      .timeline-tab.timeline-active .timeline-tab-date {
        @apply text-primary/70;
      }
    }
  </style>
</head>
<body class="font-inter bg-gray-50 text-dark min-h-screen">
  <main class="container mx-auto px-4 py-6">
    <!-- 页面标题与筛选区 -->
    <div class="mb-6 flex flex-col md:flex-row md:items-center justify-between gap-4">
      <div>
        <h2 class="text-[clamp(1.25rem,3vw,1.75rem)] font-bold text-dark">排柜计划看板</h2>
        <p class="text-gray-500 mt-1">按仓库维度展示整柜/散货入库数量统计</p>
      </div>
      
      <div class="flex flex-wrap gap-3">
        <div class="relative">
          <select class="appearance-none bg-white border border-gray-200 rounded-lg px-4 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all">
            <option value="all">所有仓库</option>
            <option value="DEMO">DEMO</option>
            <option value="DE001">DE001</option>
            <option value="MD001">MD001</option>
            <option value="NJ001">NJ001</option>
          </select>
          <i class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
        </div>
      </div>
    </div>

    <!-- 周计划Tab栏 -->
    <div class="mb-8 bg-white rounded-xl p-4 card-shadow">
      <h3 class="text-lg font-semibold mb-4 flex items-center">
        <i class="fa fa-calendar-o text-primary mr-2"></i>
        周计划
      </h3>
      
      <!-- Tab栏容器 -->
        <div class="timeline-tabs">
          <!-- Tab项 - 全部（活跃） -->
          <div class="timeline-tab timeline-active" data-week="all">
              全部
          </div>
          
          <!-- Tab项 - 第1周（非活跃） -->
          <div class="timeline-tab timeline-inactive" data-week="1">
              06/28 - 07/04
          </div>
          
          <!-- Tab项 - 第2周（非活跃） -->
          <div class="timeline-tab timeline-inactive" data-week="2">
              07/05 - 07/11
          </div>
          
          <!-- Tab项 - 第3周（非活跃） -->
          <div class="timeline-tab timeline-inactive" data-week="3">
              07/12 - 07/18
          </div>
          
          <!-- Tab项 - 第4周（非活跃） -->
          <div class="timeline-tab timeline-inactive" data-week="4">
              07/19 - 07/25
          </div>
          
          <!-- Tab项 - 第5周（非活跃） -->
          <div class="timeline-tab timeline-inactive" data-week="5">
              07/26 - 08/01
          </div>
      </div>
    </div>

    <!-- 数据概览卡片 -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
      <!-- 总入库量 -->
      <div class="bg-white rounded-xl p-4 card-shadow hover:shadow-lg transition-all">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-gray-500 font-medium">总计</h3>
          <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
            <i class="fa fa-cubes"></i>
          </div>
        </div>
        <div class="flex items-end justify-between">
          <span class="text-2xl font-bold">1,286</span>
          <span class="text-red-500 text-sm flex items-center">
            <i class="fa fa-arrow-up mr-1"></i> 12.5%
          </span>
        </div>
        <p class="text-xs text-gray-500 mt-1">较上周增长</p>
      </div>
      
      <!-- 整柜入库量 -->
      <div class="bg-white rounded-xl p-4 card-shadow hover:shadow-lg transition-all lg:col-span-2">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-gray-500 font-medium">整柜</h3>
          <!-- 标题和logo中间添加柜型数量统计 -->
          <div>
            <div class="flex items-center space-x-8 text-sm">
              <div class="flex items-center">
                <span class="w-2 h-2 rounded-full bg-blue-500 mr-2"></span>
                <span class="text-gray-600">20GP:</span>
                <span class="ml-1 font-medium text-gray-900" id="20GP-count-header">156</span>
              </div>
              <div class="flex items-center">
                <span class="w-2 h-2 rounded-full bg-green-500 mr-2"></span>
                <span class="text-gray-600">40GP:</span>
                <span class="ml-1 font-medium text-gray-900" id="40GP-count-header">128</span>
              </div>
              <div class="flex items-center">
                <span class="w-2 h-2 rounded-full bg-yellow-500 mr-2"></span>
                <span class="text-gray-600">40HQ:</span>
                <span class="ml-1 font-medium text-gray-900" id="40HQ-count-header">98</span>
              </div>
              <div class="flex items-center">
                <span class="w-2 h-2 rounded-full bg-red-500 mr-2"></span>
                <span class="text-gray-600">45HQ:</span>
                <span class="ml-1 font-medium text-gray-900" id="45HQ-count-header">50</span>
              </div>
            </div>
          </div>
          <div class="w-10 h-10 rounded-lg bg-secondary/10 flex items-center justify-center text-secondary">
            <i class="fa fa-ship"></i>
          </div>
        </div>
        <div class="flex items-end justify-between">
          <span class="text-2xl font-bold">432</span>
          <span class="text-red-500 text-sm flex items-center">
            <i class="fa fa-arrow-up mr-1"></i> 8.3%
          </span>
        </div>
        <p class="text-xs text-gray-500 mt-1">较上周增长</p>
      </div>
      
      <!-- 散货入库量 -->
      <div class="bg-white rounded-xl p-4 card-shadow hover:shadow-lg transition-all">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-gray-500 font-medium">散货</h3>
          <div class="w-10 h-10 rounded-lg bg-warning/10 flex items-center justify-center text-warning">
            <i class="fa fa-truck"></i>
          </div>
        </div>
        <div class="flex items-end justify-between">
          <span class="text-2xl font-bold">854</span>
          <span class="text-red-500 text-sm flex items-center">
            <i class="fa fa-arrow-up mr-1"></i> 15.7%
          </span>
        </div>
        <p class="text-xs text-gray-500 mt-1">较上周增长</p>
      </div>
    </div>

    <!-- 主数据区域（表格） -->
    <div class="bg-white rounded-xl p-4 card-shadow mb-8">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-semibold">入库统计</h3>
        <div class="relative">
          <input type="text" placeholder="搜索仓库..." class="pl-9 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary w-full md:w-64">
          <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full min-w-[600px]">
          <thead>
            <tr class="border-b border-gray-200">
                <th class="text-left py-3 px-4 font-semibold text-gray-700">仓库</th>
                <th class="text-center py-3 px-4 font-semibold text-gray-700">整柜</th>
                <th class="text-center py-3 px-4 font-semibold text-gray-700">散货</th>
                <th class="text-center py-3 px-4 font-semibold text-gray-700">总计</th>
                <th class="text-center py-3 px-4 font-semibold text-gray-700">占比</th>
            </tr>
          </thead>
          <tbody>
            <tr class="border-b border-gray-100 hover:bg-gray-50 transition-all">
              <td class="py-3 px-4">
                <div class="flex items-center">
                  <i class="fa fa-building-o text-primary mr-2"></i>
                  <span>DEMO</span>
                </div>
              </td>
              <td class="text-center py-3 px-4">128</td>
              <td class="text-center py-3 px-4">245</td>
              <td class="text-center py-3 px-4 font-medium">373</td>
              <td class="text-center py-3 px-4">
                <div class="flex items-center justify-center">
                  <span class="text-primary font-medium">29.0%</span>
                </div>
              </td>
            </tr>

            <tr class="border-b border-gray-100 hover:bg-gray-50 transition-all">
                <td class="py-3 px-4">
                  <div class="flex items-center">
                    <i class="fa fa-building-o text-primary mr-2"></i>
                    <span>DE001</span>
                  </div>
                </td>
                <td class="text-center py-3 px-4">96</td>
                <td class="text-center py-3 px-4">187</td>
                <td class="text-center py-3 px-4 font-medium">283</td>
                <td class="text-center py-3 px-4">
                <div class="flex items-center justify-center">
                  <span class="text-primary font-medium">22.0%</span>
                </div>
                </td>
            </tr>
            <tr class="border-b border-gray-100 hover:bg-gray-50 transition-all">
            <td class="py-3 px-4">
              <div class="flex items-center">
                <i class="fa fa-building-o text-primary mr-2"></i>
                <span>MD001</span>
              </div>
            </td>
            <td class="text-center py-3 px-4">85</td>
            <td class="text-center py-3 px-4">156</td>
            <td class="text-center py-3 px-4 font-medium">241</td>
            <td class="text-center py-3 px-4">
              <div class="flex items-center justify-center">
                <span class="text-primary font-medium">18.7%</span>
              </div>
            </td>
            </tr>
            <tr class="border-b border-gray-100 hover:bg-gray-50 transition-all">
              <td class="py-3 px-4">
                <div class="flex items-center">
                  <i class="fa fa-building-o text-primary mr-2"></i>
                  <span>NJ001</span>
                </div>
              </td>
              <td class="text-center py-3 px-4">72</td>
              <td class="text-center py-3 px-4">132</td>
              <td class="text-center py-3 px-4 font-medium">204</td>
              <td class="text-center py-3 px-4">
                <div class="flex items-center justify-center">
                  <span class="text-primary font-medium">15.9%</span>
                </div>
              </td>
            </tr>
            <tr class="hover:bg-gray-50 transition-all">
              <td class="py-3 px-4">
                <div class="flex items-center">
                  <i class="fa fa-building-o text-primary mr-2"></i>
                  <span>NJ006</span>
                </div>
              </td>
              <td class="text-center py-3 px-4">51</td>
              <td class="text-center py-3 px-4">134</td>
              <td class="text-center py-3 px-4 font-medium">185</td>
              <td class="text-center py-3 px-4">
                <div class="flex items-center justify-center">
                  <span class="text-primary font-medium">14.4%</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- 分页 -->
      <div class="flex items-center justify-between mt-4">
        <div class="text-sm text-gray-500">
          显示 1-5 条，共 16 条
        </div>
        <div class="flex space-x-1">
          <button class="w-8 h-8 flex items-center justify-center rounded border border-gray-200 text-gray-500 hover:border-primary hover:text-primary transition-all">
            <i class="fa fa-chevron-left text-xs"></i>
          </button>
          <button class="w-8 h-8 flex items-center justify-center rounded bg-primary text-white">1</button>
          <button class="w-8 h-8 flex items-center justify-center rounded border border-gray-200 hover:border-primary hover:text-primary transition-all">2</button>
          <button class="w-8 h-8 flex items-center justify-center rounded border border-gray-200 hover:border-primary hover:text-primary transition-all">3</button>
          <button class="w-8 h-8 flex items-center justify-center rounded border border-gray-200 text-gray-500 hover:border-primary hover:text-primary transition-all">
            <i class="fa fa-chevron-right text-xs"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- 统计图表区域 -->
    <!-- 入库占比图表（默认显示） -->
    <div id="warehouseChartSection" class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-8">
      <!-- 库占比分析（玫瑰图） -->
      <div class="bg-white rounded-xl p-4 card-shadow hover:shadow-lg transition-all">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold">库占比分析</h3>
          <div class="flex space-x-2">
            <button class="text-sm px-2 py-1 rounded bg-primary/10 text-primary flex items-center">
              <i class="fa fa-rose mr-1"></i> 玫瑰图
            </button>
            <button class="text-sm px-2 py-1 rounded text-gray-500 hover:bg-gray-100 flex items-center">
              <i class="fa fa-download mr-1"></i> 导出
            </button>
          </div>
        </div>
        <div class="h-64">
          <canvas id="warehouseRoseChart"></canvas>
        </div>
      </div>
      
      <!-- 整柜入库占比 -->
      <div class="bg-white rounded-xl p-4 card-shadow hover:shadow-lg transition-all">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold">整柜入库占比</h3>
          <div class="flex space-x-2">
            <button class="text-sm px-2 py-1 rounded bg-primary/10 text-primary flex items-center">
              <i class="fa fa-pie-chart mr-1"></i> 分布
            </button>
            <button class="text-sm px-2 py-1 rounded text-gray-500 hover:bg-gray-100 flex items-center">
              <i class="fa fa-download mr-1"></i> 导出
            </button>
          </div>
        </div>
        <div class="h-64">
          <canvas id="inventoryChart"></canvas>
        </div>
      </div>
      
      <!-- 散货入库占比 -->
      <div class="bg-white rounded-xl p-4 card-shadow hover:shadow-lg transition-all">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold">散货入库占比</h3>
          <div class="flex space-x-2">
            <button class="text-sm px-2 py-1 rounded bg-primary/10 text-primary flex items-center">
              <i class="fa fa-pie-chart mr-1"></i> 分布
            </button>
            <button class="text-sm px-2 py-1 rounded text-gray-500 hover:bg-gray-100 flex items-center">
              <i class="fa fa-download mr-1"></i> 导出
            </button>
          </div>
        </div>
        <div class="h-64">
          <canvas id="looseCargoChart"></canvas>
        </div>
      </div>
    </div>
    
    <!-- 柜型统计和入库趋势图表（默认隐藏） -->
    <div id="containerTypeChartSection" class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-8 hidden">
      <!-- 柜型统计 -->
      <div class="bg-white rounded-xl p-4 card-shadow hover:shadow-lg transition-all">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold">柜型统计</h3>
          <div class="flex space-x-2">
            <button class="text-sm px-2 py-1 rounded bg-primary/10 text-primary flex items-center">
              <i class="fa fa-bar-chart mr-1"></i> 分布
            </button>
            <button class="text-sm px-2 py-1 rounded text-gray-500 hover:bg-gray-100 flex items-center">
              <i class="fa fa-download mr-1"></i> 导出
            </button>
          </div>
        </div>
        <div class="h-64">
          <canvas id="containerTypeChart"></canvas>
        </div>
      </div>
      
      <!-- 入库趋势 -->
      <div class="bg-white rounded-xl p-4 card-shadow hover:shadow-lg transition-all">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold">入库趋势</h3>
          <div class="flex space-x-2">
            <button class="text-sm px-2 py-1 rounded bg-primary/10 text-primary flex items-center">
              <i class="fa fa-line-chart mr-1"></i> 趋势
            </button>
            <button class="text-sm px-2 py-1 rounded text-gray-500 hover:bg-gray-100 flex items-center">
              <i class="fa fa-download mr-1"></i> 导出
            </button>
          </div>
        </div>
        <div class="h-64">
          <canvas id="inventoryTrendChart"></canvas>
        </div>
      </div>
    </div>
  </main>


  <!-- JavaScript 代码 -->
  <script>
    // 柜型分布默认显示，不再需要下拉逻辑

    // 初始化图表和筛选功能
    document.addEventListener('DOMContentLoaded', function() {
      // 模拟数据
      // 原始数据 - 按周划分
      const weeklyData = {
        all: [
          { warehouse: 'DEMO', fullContainer: 128, looseCargo: 245, total: 373 },
          { warehouse: 'DE001', fullContainer: 96, looseCargo: 187, total: 283 },
          { warehouse: 'MD001', fullContainer: 112, looseCargo: 220, total: 332 },
          { warehouse: 'NJ001', fullContainer: 96, looseCargo: 202, total: 300 }
        ],
        '1': [
          { warehouse: 'DEMO', fullContainer: 32, looseCargo: 61, total: 93 },
          { warehouse: 'DE001', fullContainer: 24, looseCargo: 47, total: 71 },
          { warehouse: 'MD001', fullContainer: 28, looseCargo: 55, total: 83 },
          { warehouse: 'NJ001', fullContainer: 24, looseCargo: 51, total: 75 }
        ],
        '2': [
          { warehouse: 'DEMO', fullContainer: 25, looseCargo: 49, total: 74 },
          { warehouse: 'DE001', fullContainer: 19, looseCargo: 37, total: 56 },
          { warehouse: 'MD001', fullContainer: 22, looseCargo: 44, total: 66 },
          { warehouse: 'NJ001', fullContainer: 19, looseCargo: 40, total: 59 }
        ],
        '3': [
          { warehouse: 'DEMO', fullContainer: 28, looseCargo: 54, total: 82 },
          { warehouse: 'DE001', fullContainer: 21, looseCargo: 41, total: 62 },
          { warehouse: 'MD001', fullContainer: 25, looseCargo: 49, total: 74 },
          { warehouse: 'NJ001', fullContainer: 21, looseCargo: 45, total: 66 }
        ],
        '4': [
          { warehouse: 'DEMO', fullContainer: 22, looseCargo: 43, total: 65 },
          { warehouse: 'DE001', fullContainer: 16, looseCargo: 32, total: 48 },
          { warehouse: 'MD001', fullContainer: 19, looseCargo: 39, total: 58 },
          { warehouse: 'NJ001', fullContainer: 16, looseCargo: 35, total: 51 }
        ],
        '5': [
          { warehouse: 'DEMO', fullContainer: 21, looseCargo: 40, total: 61 },
          { warehouse: 'DE001', fullContainer: 16, looseCargo: 30, total: 46 },
          { warehouse: 'MD001', fullContainer: 18, looseCargo: 33, total: 51 },
          { warehouse: 'NJ001', fullContainer: 16, looseCargo: 31, total: 47 }
        ]
      };
      
      // 默认显示所有数据
      const warehouseData = weeklyData.all;
      let currentWeek = 'all'; // 记录当前选中的周
        
      // 图表实例
      let inventoryChart, looseCargoChart, containerTypeChart, inventoryTrendChart, warehouseRoseChart;
      
      // 初始化入库占比图表函数
      function initWarehouseCharts(data) {
        // 计算总计
        const totalFullContainer = data.reduce((sum, item) => sum + item.fullContainer, 0);
        const totalLooseCargo = data.reduce((sum, item) => sum + item.looseCargo, 0);
        
        // 整柜入库占比 - 按仓库占比统计
        if (inventoryChart) {
          inventoryChart.destroy();
        }
        const inventoryCtx = document.getElementById('inventoryChart').getContext('2d');
        
        // 按仓库分组计算整柜占比
        const warehouseFullContainerData = data.map(item => ({
          warehouse: item.warehouse,
          value: item.fullContainer
        }));
        
        inventoryChart = new Chart(inventoryCtx, {
          type: 'doughnut',
          data: {
            labels: warehouseFullContainerData.map(item => item.warehouse),
            datasets: [
              {
                data: warehouseFullContainerData.map(item => item.value),
                backgroundColor: [
                  '#36CFC9',
                  '#1890FF',
                  '#52C41A',
                  '#FAAD14',
                  '#F5222D'
                ],
                borderWidth: 0
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  padding: 20,
                  usePointStyle: true,
                  pointStyle: 'circle'
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.parsed || 0;
                    const percentage = Math.round((value / totalFullContainer) * 100);
                    return `${label}: ${value} (${percentage}%)`;
                  }
                }
              }
            },
            cutout: '60%'
          }
        });
        
        // 散货入库占比 - 按仓库占比统计
        if (looseCargoChart) {
          looseCargoChart.destroy();
        }
        const looseCargoCtx = document.getElementById('looseCargoChart').getContext('2d');
        
        // 按仓库分组计算散货占比
        const warehouseLooseCargoData = data.map(item => ({
          warehouse: item.warehouse,
          value: item.looseCargo
        }));
        
        looseCargoChart = new Chart(looseCargoCtx, {
          type: 'doughnut',
          data: {
            labels: warehouseLooseCargoData.map(item => item.warehouse),
            datasets: [
              {
                data: warehouseLooseCargoData.map(item => item.value),
                backgroundColor: [
                  '#FAAD14',
                  '#F5222D',
                  '#722ED1',
                  '#13C2C2',
                  '#EB2F96'
                ],
                borderWidth: 0
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  padding: 20,
                  usePointStyle: true,
                  pointStyle: 'circle'
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.parsed || 0;
                    const percentage = Math.round((value / totalLooseCargo) * 100);
                    return `${label}: ${value} (${percentage}%)`;
                  }
                }
              }
            },
            cutout: '60%'
          }
        });
        
        // 库占比分析 - 按地区分布（堆叠矩形）
        if (warehouseRoseChart) {
          warehouseRoseChart.destroy();
        }
        const warehouseRoseCtx = document.getElementById('warehouseRoseChart').getContext('2d');
        
        // 准备地区数据（美东、美西、美南）
        const regions = ['美东', '美西', '美南'];
        // 模拟数据 - 实际项目中应从API获取
        const fullContainerByRegion = [286, 324, 198];
        const looseCargoByRegion = [542, 618, 389];
        
        warehouseRoseChart = new Chart(warehouseRoseCtx, {
          type: 'bar',
          data: {
            labels: regions,
            datasets: [
              {
                label: '整柜',
                data: fullContainerByRegion,
                backgroundColor: '#1890FF',
                borderRadius: 4
              },
              {
                label: '散货',
                data: looseCargoByRegion,
                backgroundColor: '#52C41A',
                borderRadius: 4
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  padding: 20
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const datasetLabel = context.dataset.label || '';
                    const value = context.parsed.y || 0;
                    return `${datasetLabel}: ${value}`;
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                stacked: true,
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)'
                }
              },
              x: {
                stacked: true,
                grid: {
                  display: false
                }
              }
            }
          }
        });
      }
      
      // 初始化柜型统计图表函数
      function initContainerTypeChart(data) {
        // 模拟柜型数据（实际项目中应从API获取）
        const containerTypes = [
          { type: '20GP', value: 156 },
          { type: '40GP', value: 128 },
          { type: '40HQ', value: 98 },
          { type: '45HQ', value: 50 }
        ];
        
        if (containerTypeChart) {
          containerTypeChart.destroy();
        }
        const containerTypeCtx = document.getElementById('containerTypeChart').getContext('2d');
        
        containerTypeChart = new Chart(containerTypeCtx, {
          type: 'bar',
          data: {
            labels: containerTypes.map(item => item.type),
            datasets: [
              {
                label: '柜型数量',
                data: containerTypes.map(item => item.value),
                backgroundColor: [
                  '#1890FF',
                  '#52C41A',
                  '#FAAD14',
                  '#F5222D'
                ],
                borderRadius: 4
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `${context.label}: ${context.parsed.y}`;
                  }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)'
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });
      }
      
      // 初始化入库趋势图表函数
      function initInventoryTrendChart(data, warehouseName) {
        // 模拟入库趋势数据（按具体日期）
        const dates = ['11-25', '11-26', '11-27', '11-28', '11-29', '11-30', '12-01'];
        const fullContainerData = [5, 4, 6, 5, 7, 3, 2];
        const looseCargoData = [10, 8, 12, 9, 11, 6, 5];
        
        if (inventoryTrendChart) {
          inventoryTrendChart.destroy();
        }
        const inventoryTrendCtx = document.getElementById('inventoryTrendChart').getContext('2d');
        
        inventoryTrendChart = new Chart(inventoryTrendCtx, {
          type: 'line',
          data: {
            labels: dates,
            datasets: [
              {
                label: '整柜',
                data: fullContainerData,
                borderColor: '#1890FF',
                backgroundColor: 'rgba(24, 144, 255, 0.1)',
                tension: 0.3,
                fill: true
              },
              {
                label: '散货',
                data: looseCargoData,
                borderColor: '#52C41A',
                backgroundColor: 'rgba(82, 196, 26, 0.1)',
                tension: 0.3,
                fill: true
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  padding: 20
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)'
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });
      }
      
      // 初始化图表函数
      function initCharts(data, isSingleWarehouse = false, warehouseName = '') {
        if (isSingleWarehouse) {
          // 显示柜型统计和入库趋势图表
          document.getElementById('warehouseChartSection').classList.add('hidden');
          document.getElementById('containerTypeChartSection').classList.remove('hidden');
          
          // 初始化柜型统计和入库趋势图表
          initContainerTypeChart(data);
          initInventoryTrendChart(data, warehouseName);
        } else {
          // 显示入库占比图表
          document.getElementById('warehouseChartSection').classList.remove('hidden');
          document.getElementById('containerTypeChartSection').classList.add('hidden');
          
          // 初始化入库占比图表
          initWarehouseCharts(data);
        }
      }
      
      // 更新统计卡片
      function updateStats(data) {
        // 计算总计
        const totalFullContainer = data.reduce((sum, item) => sum + item.fullContainer, 0);
        const totalLooseCargo = data.reduce((sum, item) => sum + item.looseCargo, 0);
        const total = totalFullContainer + totalLooseCargo;
        
        // 更新总计卡片
        document.querySelectorAll('.text-2xl.font-bold')[0].textContent = total.toLocaleString();
        // 更新整柜卡片
        document.querySelectorAll('.text-2xl.font-bold')[1].textContent = totalFullContainer.toLocaleString();
        // 更新散货卡片
        document.querySelectorAll('.text-2xl.font-bold')[2].textContent = totalLooseCargo.toLocaleString();
      }
      
      // 更新表格数据
      function updateTable(data) {
        const tbody = document.querySelector('tbody');
        const total = data.reduce((sum, item) => sum + item.total, 0);
        
        tbody.innerHTML = '';
        data.forEach(item => {
          const tr = document.createElement('tr');
          tr.className = 'border-b border-gray-100 hover:bg-gray-50 transition-all';
          const percentage = ((item.total / total) * 100).toFixed(1);
          
          tr.innerHTML = `
            <td class="py-3 px-4">
              <div class="flex items-center">
                <i class="fa fa-building-o text-primary mr-2"></i>
                <span>${item.warehouse}</span>
              </div>
            </td>
            <td class="text-center py-3 px-4">${item.fullContainer}</td>
            <td class="text-center py-3 px-4">${item.looseCargo}</td>
            <td class="text-center py-3 px-4 font-medium">${item.total}</td>
            <td class="text-center py-3 px-4">
              <div class="flex items-center justify-center">
                <span class="text-primary font-medium">${percentage}%</span>
              </div>
            </td>
          `;
          
          tbody.appendChild(tr);
        });
      }
      
      // 筛选函数
      function filterByWarehouse(warehouse) {
        let filteredData;
        // 获取当前周的数据
        const currentData = weeklyData[currentWeek];
        
        if (warehouse === 'all') {
          filteredData = currentData;
          // 更新图表 - 显示入库占比图表
          initCharts(filteredData, false);
        } else {
          // 根据仓库名称直接过滤数据
          filteredData = currentData.filter(item => item.warehouse === warehouse);
          // 更新图表 - 显示柜型统计和入库趋势图表
          initCharts(filteredData, true, warehouse);
        }
        
        // 更新统计卡片
        updateStats(filteredData);
        // 更新表格
        updateTable(filteredData);
      }
      
      // 为仓库选择器添加事件监听器
      const warehouseSelect = document.querySelector('select');
      warehouseSelect.addEventListener('change', function() {
        filterByWarehouse(this.value);
      });
      
      // 初始化图表和数据
      initCharts(warehouseData);
      updateStats(warehouseData);
      updateTable(warehouseData);
      
      // Tab栏点击事件
      const timelineTabs = document.querySelectorAll('.timeline-tab');
      
      // 切换周数据的函数
      function switchWeekData(week) {
        currentWeek = week; // 更新当前选中的周
        const data = weeklyData[week];
        const warehouseSelect = document.querySelector('select');
        const selectedWarehouse = warehouseSelect.value;
        
        // 更新统计卡片
        updateStats(data);
        // 更新表格
        updateTable(data);
        // 更新图表
        if (selectedWarehouse === 'all') {
          initCharts(data, false);
        } else {
          const filteredData = data.filter(item => item.warehouse === selectedWarehouse);
          initCharts(filteredData, true, selectedWarehouse);
        }
      }
      
      timelineTabs.forEach(tab => {
        tab.addEventListener('click', function() {
          // 移除所有Tab的活跃状态
          timelineTabs.forEach(t => {
            t.classList.remove('timeline-active');
            t.classList.add('timeline-inactive');
          });
          
          // 添加当前Tab的活跃状态
          this.classList.remove('timeline-inactive');
          this.classList.add('timeline-active');
          
          // 添加点击动画
          this.classList.add('scale-105');
          setTimeout(() => {
            this.classList.remove('scale-105');
          }, 200);
          
          // 获取周数并切换数据
          const week = this.getAttribute('data-week');
          switchWeekData(week);
        });
      });
    });
  </script>
</body>
</html>