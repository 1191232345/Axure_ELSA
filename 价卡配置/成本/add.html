<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>新增成本</title>
  <!-- 引入必要依赖 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            success: '#00B42A',
            danger: '#F53F3F',
            neutral: {
              100: '#F2F3F5',
              200: '#E5E6EB',
              400: '#86909C',
              500: '#4E5969',
              600: '#272E3B',
              700: '#1D2129',
            }
          },
          transitionProperty: {
            'all-300': 'all 0.3s ease',
          }
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .transition-all-300 {
        transition: all 0.3s ease;
      }
      .bg-primary\/10 {
        background-color: rgba(22, 93, 255, 0.1);
      }
      .hover\:border-primary:hover {
        border-color: #165DFF;
      }
      .hover\:text-primary:hover {
        color: #165DFF;
      }
      .hover\:bg-neutral-50:hover {
        background-color: #F9FAFB;
      }
      .hover\:bg-primary\/5:hover {
        background-color: rgba(22, 93, 255, 0.05);
      }
      .hover\:text-danger:hover {
        color: #F53F3F;
      }
      .status-tag {
        @apply inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium;
      }
    }
  </style>
  
  <!-- 基础样式保障 -->
  <style>
    /* 基础布局样式 */
    .mt-6 { margin-top: 1.5rem; }
    .mt-4 { margin-top: 1rem; }
    .border-t { border-top: 1px solid; }
    .pt-6 { padding-top: 1.5rem; }
    .pb-4 { padding-bottom: 1rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-3 { margin-bottom: 0.75rem; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
    .py-1\.5 { padding-top: 0.375rem; padding-bottom: 0.375rem; }
    .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
    .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
    .ml-2 { margin-left: 0.5rem; }
    .ml-1 { margin-left: 0.25rem; }
    .mr-2 { margin-right: 0.5rem; }
    .flex { display: flex; }
    .flex-wrap { flex-wrap: wrap; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .text-left { text-align: left; }
    .text-sm { font-size: 0.875rem; }
    .text-base { font-size: 1rem; }
    .font-bold { font-weight: 600; }
    .font-medium { font-weight: 500; }
    .rounded-lg { border-radius: 0.5rem; }
    .rounded-md { border-radius: 0.375rem; }
    .rounded { border-radius: 0.25rem; }
    .border { border: 1px solid; }
    .min-h-\[60px\] { min-height: 60px; }
    .min-h-\[100px\] { min-height: 100px; }
    .overflow-x-auto { overflow-x: auto; }
    .gap-3 { gap: 0.75rem; }
    .gap-2 { gap: 0.5rem; }
    .grid { display: grid; }
    .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
    .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    .transition-all-300 { transition: all 0.3s ease; }
    .w-full { width: 100%; }
    .outline-none { outline: none; }
    .focus\:border-primary:focus { border-color: #165DFF; }
    
    /* 颜色样式 */
    .border-neutral-100 { border-color: #F2F3F5; }
    .border-neutral-200 { border-color: #E5E6EB; }
    .border-primary { border-color: #165DFF; }
    .text-neutral-700 { color: #1D2129; }
    .text-neutral-600 { color: #272E3B; }
    .text-neutral-500 { color: #4E5969; }
    .text-neutral-400 { color: #86909C; }
    .text-primary { color: #165DFF; }
    .text-success { color: #00B42A; }
    .text-danger { color: #F53F3F; }
    .bg-neutral-50 { background-color: #F9FAFB; }
    .bg-neutral-100 { background-color: #F2F3F5; }
    .bg-primary\/10 { background-color: rgba(22, 93, 255, 0.1); }
    .bg-neutral-200 { background-color: #E5E6EB; }
    .bg-primary { background-color: #165DFF; }
    .text-white { color: #FFFFFF; }
    
    /* 交互样式 */
    .hover\:border-primary:hover { border-color: #165DFF; }
    .hover\:text-primary:hover { color: #165DFF; }
    .hover\:bg-neutral-50:hover { background-color: #F9FAFB; }
    .hover\:bg-primary\/5:hover { background-color: rgba(22, 93, 255, 0.05); }
    .hover\:bg-primary\/10:hover { background-color: rgba(22, 93, 255, 0.1); }
    .hover\:text-danger:hover { color: #F53F3F; }
    .hover\:bg-primary:hover { background-color: #0E4BDB; }
    
    /* 状态样式 */
    .hidden { display: none; }
    .cursor-pointer { cursor: pointer; }
  </style>
</head>
<body class="bg-gray-50">
  <!-- 主内容区域 -->
  <main class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- 页面标题与操作栏 -->
    <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4">
      <div class="flex items-center">
        <button id="backBtn" class="px-3 py-1.5 bg-neutral-100 text-neutral-600 rounded-md text-sm hover:bg-neutral-200 transition-all-300 mr-4 flex items-center">
          <i class="fa fa-arrow-left mr-1"></i> 返回
        </button>
      </div>
    </div>

    <!-- 成本内容（默认隐藏） -->
    <div id="priceCardContent" class="space-y-6">
      <!-- 成本类型卡片 -->
      <div class="bg-white border border-neutral-100 rounded-lg shadow-sm p-6">
        <h2 class="text-base font-bold text-neutral-700 mb-4">成本类型</h2>
        <div class="flex items-center">
          <select id="priceCardType" name="priceCardType" class="w-64 px-4 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
        <option value="卸货费">卸货费</option>
        <option value="仓储费">仓储费</option>
        <option value="快递费">快递费</option>
      </select>
        </div>
      </div>
      
      <!-- 基本信息卡片 -->
      <div class="bg-white border border-neutral-100 rounded-lg shadow-sm p-6">
        <h2 class="text-base font-bold text-neutral-700 mb-4">基本信息</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label for="priceCardName" class="block text-sm font-medium text-neutral-600 mb-1">名称</label>
            <input type="text" id="priceCardName" value="这是一个成本名称" placeholder="请输入成本名称" 
                   class="w-full px-4 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
          </div>
          <div>
            <label for="applyScope" class="block text-sm font-medium text-neutral-600 mb-1">适用范围</label>
            <select id="applyScope" class="w-full px-4 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
              <option value="全部">全部</option>
              <option value="特定仓库">美东仓群</option>
              <option value="特定客户">美西仓群</option>
              <option value="特定客户">美南仓群</option>
            </select>
          </div>
          <div>
            <label for="profitMargin" class="block text-sm font-medium text-neutral-600 mb-1">利润率（%）</label>
            <input type="number" id="profitMargin" value="15" placeholder="请输入利润率" min="0" max="100" step="0.1"
                   class="w-full px-4 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
          </div>
          <!-- 特定仓库选择区域，默认隐藏 -->
          <div id="warehouseSelection" class="hidden md:col-span-2">
            <label class="block text-sm font-medium text-neutral-600 mb-1">指定仓库</label>
            <div class="relative">
              <!-- 下拉触发器 -->
              <button id="warehouseDropdownTrigger" class="w-full px-4 py-2 border border-neutral-200 rounded-md text-sm text-left focus:border-primary focus:outline-none transition-all-300 flex justify-between items-center bg-white">
                <span id="warehouseSelectedText">请选择仓库</span>
                <i class="fa fa-chevron-down text-neutral-500 transition-transform duration-300"></i>
              </button>
              <!-- 下拉面板 -->
              <div id="warehouseDropdownPanel" class="hidden absolute z-10 w-full mt-1 bg-white border border-neutral-200 rounded-md shadow-lg p-3 max-h-60 overflow-y-auto">
                <div class="grid grid-cols-1 gap-2">
                  <label class="flex items-center space-x-2 cursor-pointer hover:bg-neutral-50 p-1 rounded">
                    <input type="checkbox" name="warehouse" value="warehouse1" class="w-4 h-4 text-primary border-neutral-300 rounded focus:ring-primary">
                    <span class="text-sm text-neutral-700">DE001</span>
                  </label>
                  <label class="flex items-center space-x-2 cursor-pointer hover:bg-neutral-50 p-1 rounded">
                    <input type="checkbox" name="warehouse" value="warehouse2" class="w-4 h-4 text-primary border-neutral-300 rounded focus:ring-primary">
                    <span class="text-sm text-neutral-700">MD001</span>
                  </label>
                  <label class="flex items-center space-x-2 cursor-pointer hover:bg-neutral-50 p-1 rounded">
                    <input type="checkbox" name="warehouse" value="warehouse3" class="w-4 h-4 text-primary border-neutral-300 rounded focus:ring-primary">
                    <span class="text-sm text-neutral-700">DEMO</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="mt-4">
          <label for="description" class="block text-sm font-medium text-neutral-600 mb-1">描述</label>
          <textarea id="description" rows="3" placeholder="请输入成本描述" 
                    class="w-full px-4 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300"></textarea>
        </div>
      </div>

      <!-- 单价设置 -->
      <div class="space-y-6">
        <h2 class="text-base font-bold text-neutral-700">价格设置</h2>
        
        <!-- 整柜单价项目 -->
        <div id="containerPriceSection" class="bg-white border border-neutral-100 rounded-lg shadow-sm p-6">
          <h3 class="text-sm font-medium text-neutral-600 mb-3">整柜</h3>
          <div class="overflow-x-auto">
            <table class="w-full border-collapse">
              <thead>
                <tr class="bg-neutral-50 border-b border-neutral-200">
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider w-1/4">柜型</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider w-1/4">单价</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider w-1/2">备注</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider w-12">操作</th>
                </tr>
              </thead>
              <tbody id="containerPriceList">
                <!-- 整柜单价项目将通过JS动态添加 -->
                <tr class="border-b border-neutral-200 container-price-item">
                  <td class="px-4 py-3">
                    <select class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                      <option value="20GP">20GP</option>
                      <option value="40GP">40GP</option>
                      <option value="40HQ">40HQ</option>
                      <option value="45HQ">45HQ</option>
                    </select>
                  </td>
                  <td class="px-4 py-3">
                    <div class="relative">
                      <input type="number" step="0.01" placeholder="请输入单价" value="100"
                             class="w-full pl-8 pr-4 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                      <span class="absolute left-2 top-1/2 -translate-y-1/2 text-neutral-500 text-sm">$</span>
                    </div>
                  </td>
                  <td class="px-4 py-3">
                    <input type="text" placeholder="可选" value="这是一个备注"
                           class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                  </td>
                  <td class="px-4 py-3">
                    <button type="button" class="remove-container-item p-1 bg-red-50 text-red-600 rounded hover:bg-red-100 transition-all-300">
                      <i class="fa fa-trash text-xs"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <button type="button" id="addContainerPrice" class="mt-3 px-3 py-1.5 bg-neutral-100 text-neutral-600 rounded-md text-sm hover:bg-neutral-200 transition-all-300 flex items-center">
            <i class="fa fa-plus mr-1"></i> 添加柜型
          </button>
        </div>
        
        <!-- 散货单成本片 -->
        <div id="bulkPriceSection" class="bg-white border border-neutral-100 rounded-lg shadow-sm p-6">
          <h3 class="text-sm font-medium text-neutral-600 mb-3">散货</h3>
          <div class="overflow-x-auto">
            <table class="w-full border-collapse">
              <thead>
                <tr class="bg-neutral-50 border-b border-neutral-200">
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider w-1/3">单价</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider w-1/3">单位</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider w-1/3">备注</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b border-neutral-200">
                  <td class="px-4 py-3">
                    <div class="relative">
                      <input type="number" id="bulkPrice" step="0.01" placeholder="请输入单价" value="100"
                             class="w-full pl-8 pr-4 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                      <span class="absolute left-2 top-1/2 -translate-y-1/2 text-neutral-500 text-sm">$</span>
                    </div>
                  </td>
                  <td class="px-4 py-3">
                    <select id="bulkUnit" class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                      <option value="件">件</option>
                    </select>
                  </td>
                  <td class="px-4 py-3">
                    <input type="text" id="bulkRemark" placeholder="可选" value="这是一个备注"
                           class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- 快递单成本片 -->
        <div id="expressPriceSection" class="bg-white border border-neutral-100 rounded-lg shadow-sm p-6">
          <h3 class="text-sm font-medium text-neutral-600 mb-3">快递</h3>
          <div class="overflow-x-auto">
            <table class="w-full border-collapse">
              <thead>
                <tr class="bg-neutral-50 border-b border-neutral-200">
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider w-1/3">单价</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider w-1/3">单位</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider w-1/3">备注</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b border-neutral-200">
                  <td class="px-4 py-3">
                    <div class="relative">
                      <input type="number" id="expressPrice" step="0.01" placeholder="请输入单价" value="100"
                             class="w-full pl-8 pr-4 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                      <span class="absolute left-2 top-1/2 -translate-y-1/2 text-neutral-500 text-sm">$</span>
                    </div>
                  </td>
                  <td class="px-4 py-3">
                    <select id="expressUnit" class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                      <option value="件">件</option>
                    </select>
                  </td>
                  <td class="px-4 py-3">
                    <input type="text" id="expressRemark" placeholder="可选" value="这是一个备注"
                           class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- 仓储费阶梯式收费 -->
        <div id="storagePriceSection" class="bg-white border border-neutral-100 rounded-lg shadow-sm p-6 hidden">
          <h3 class="text-sm font-medium text-neutral-600 mb-3">仓储费</h3>
          <div class="overflow-x-auto">
            <table class="w-full border-collapse">
              <thead>
                <tr class="bg-neutral-50 border-b border-neutral-200">
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">单位</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">起始数量</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">结束数量</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">价格</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">备注</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider w-12">操作</th>
                </tr>
              </thead>
              <tbody id="storagePriceList">
                <!-- 阶梯式费用项目将通过JS动态添加 -->
                <tr class="border-b border-neutral-200 container-price-item">
                  <td class="px-4 py-3">
                    <select class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300" disabled>
                      <option value="箱">箱</option>
                      <option value="托">托</option>
                      <option value="件">件</option>
                      <option value="kg">kg</option>
                      <option value="m³" selected>m³</option>
                    </select>
                  </td>
                  <td class="px-4 py-3">
                    <div class="relative">
                      <input type="number" step="1" placeholder="起始数量" value="1"
                             class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                    </div>
                  </td>
                  <td class="px-4 py-3">
                    <div class="relative">
                      <input type="number" step="1" placeholder="结束数量" value="30"
                             class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                    </div>
                  </td>
                  <td class="px-4 py-3">
                    <div class="relative">
                      <input type="number" step="0.01" placeholder="请输入价格" value="0"
                             class="w-full pl-8 pr-4 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                      <span class="absolute left-2 top-1/2 -translate-y-1/2 text-neutral-500 text-sm">$</span>
                    </div>
                  </td>
                  <td class="px-4 py-3">
                    <input type="text" placeholder="可选" value="免仓期"
                           class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
                  </td>
                  <td class="px-4 py-3">
                    <button type="button" class="remove-container-item p-1 bg-red-50 text-red-600 rounded hover:bg-red-100 transition-all-300">
                      <i class="fa fa-trash text-xs"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <button type="button" id="addStoragePrice" class="mt-3 px-3 py-1.5 bg-neutral-100 text-neutral-600 rounded-md text-sm hover:bg-neutral-200 transition-all-300 flex items-center">
            <i class="fa fa-plus mr-1"></i> 添加阶梯
          </button>
        </div>
      </div>
    </div>
  </main>

  <script>
    // DOMContentLoaded事件监听
    document.addEventListener('DOMContentLoaded', function() {
      // 设置默认日期（注释掉不存在的元素引用）
      // const today = new Date();
      // const formattedDate = today.toISOString().split('T')[0];
      // document.getElementById('validFrom').value = formattedDate;
      
      // 设置默认失效日期为一年后
      // const oneYearLater = new Date(today.setFullYear(today.getFullYear() + 1));
      // const formattedOneYearLater = oneYearLater.toISOString().split('T')[0];
      // document.getElementById('validTo').value = formattedOneYearLater;
      
      // 检查URL参数，判断是否为查看模式
      const urlParams = new URLSearchParams(window.location.search);
      const mode = urlParams.get('mode');
      const type = urlParams.get('type');
      
      // 如果是查看模式，隐藏保存按钮并禁用所有输入框
      const saveBtn = document.getElementById('saveBtn');
      if (mode === 'view' && saveBtn) {
        saveBtn.classList.add('hidden');
        
        // 禁用所有输入框（input、select、textarea）
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
          input.disabled = true;
        });
      }
      
      // 如果有成本类型参数，自动选择该类型
      if (type) {
        const select = document.getElementById('priceCardType');
        if (select) {
          select.value = type;
          // 触发change事件以显示相应的价格设置部分
          select.dispatchEvent(new Event('change'));
        }
      }
      
      // 绑定事件
      bindEvents();
    });

    // 绑定事件
    function bindEvents() {
      // 返回按钮点击事件
      document.getElementById('backBtn').addEventListener('click', function() {
        window.location.href = 'index.html';
      });
      
      // 成本类型选择事件
      document.getElementById('priceCardType').addEventListener('change', function() {
        const priceCardContent = document.getElementById('priceCardContent');
        const containerPriceSection = document.getElementById('containerPriceSection');
        const bulkPriceSection = document.getElementById('bulkPriceSection');
        const expressPriceSection = document.getElementById('expressPriceSection');
        const storagePriceSection = document.getElementById('storagePriceSection');
        
        if (this.value) {
          priceCardContent.classList.remove('hidden');
          
          // 根据不同的成本类型显示不同的价格设置部分
          if (this.value === '卸货费') {
            // 显示整柜、散货和快递价格设置
            containerPriceSection.classList.remove('hidden');
            bulkPriceSection.classList.remove('hidden');
            expressPriceSection.classList.remove('hidden');
            // 隐藏仓储费阶梯式收费
            storagePriceSection.classList.add('hidden');
          } else if (this.value === '仓储费') {
            // 隐藏整柜、散货和快递价格设置
            containerPriceSection.classList.add('hidden');
            bulkPriceSection.classList.add('hidden');
            expressPriceSection.classList.add('hidden');
            // 显示仓储费阶梯式收费
            storagePriceSection.classList.remove('hidden');
          }
        } else {
          priceCardContent.classList.add('hidden');
        }
      });
      
      // 适用范围选择事件监听
      document.getElementById('applyScope').addEventListener('change', function() {
        const warehouseSelection = document.getElementById('warehouseSelection');
        if (this.value === '特定仓库') {
          warehouseSelection.classList.remove('hidden');
        } else {
          warehouseSelection.classList.add('hidden');
          // 隐藏下拉面板
          document.getElementById('warehouseDropdownPanel').classList.add('hidden');
        }
      });

      // 仓库下拉checkbox逻辑
      const warehouseDropdownTrigger = document.getElementById('warehouseDropdownTrigger');
      const warehouseDropdownPanel = document.getElementById('warehouseDropdownPanel');
      const warehouseSelectedText = document.getElementById('warehouseSelectedText');
      const warehouseCheckboxes = document.querySelectorAll('input[name="warehouse"]');
      
      // 切换下拉面板显示/隐藏
      warehouseDropdownTrigger.addEventListener('click', function() {
        const isHidden = warehouseDropdownPanel.classList.toggle('hidden');
        // 旋转箭头
        const icon = this.querySelector('i');
        if (isHidden) {
          icon.classList.remove('rotate-180');
        } else {
          icon.classList.add('rotate-180');
        }
      });
      
      // 更新选中文本
      function updateWarehouseSelectedText() {
        const checkedBoxes = document.querySelectorAll('input[name="warehouse"]:checked');
        const checkedCount = checkedBoxes.length;
        if (checkedCount === 0) {
          warehouseSelectedText.textContent = '请选择仓库';
        } else if (checkedCount === 1) {
          const label = checkedBoxes[0].closest('label').querySelector('span').textContent;
          warehouseSelectedText.textContent = label;
        } else {
          warehouseSelectedText.textContent = `${checkedCount}个仓库已选择`;
        }
      }
      
      // 为每个checkbox添加事件监听
      warehouseCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateWarehouseSelectedText);
      });
      
      // 点击外部关闭下拉面板
      document.addEventListener('click', function(event) {
        if (!warehouseDropdownTrigger.contains(event.target) && !warehouseDropdownPanel.contains(event.target)) {
          warehouseDropdownPanel.classList.add('hidden');
          const icon = warehouseDropdownTrigger.querySelector('i');
          icon.classList.remove('rotate-180');
        }
      });
      
      // 保存并发布按钮点击事件 - 已移至页面底部单独处理
      // document.getElementById('saveAndPublishBtn').addEventListener('click', function() {
      //   savePriceCard('published');
      // });
      
      // 添加整柜阶梯按钮点击事件
      document.getElementById('addContainerPrice').addEventListener('click', function() {
        addContainerPriceItem();
      });
      
      // 初始绑定整柜删除阶梯按钮事件
      bindRemoveContainerPriceEvents();
      
      // 添加仓储费阶梯按钮点击事件
      document.getElementById('addStoragePrice').addEventListener('click', function() {
        addStoragePriceItem();
      });
      
      // 初始绑定仓储费删除阶梯按钮事件
      bindRemoveStoragePriceEvents();
    }
    
    // 添加柜型单价项目
    function addContainerPriceItem() {
      // 每次都重新获取最新的containerPriceList元素
      const containerPriceList = document.getElementById('containerPriceList');
      const itemCount = containerPriceList.querySelectorAll('.container-price-item').length + 1;
      
      const newRow = document.createElement('tr');
      newRow.className = 'border-b border-neutral-200 container-price-item';
      newRow.innerHTML = `
        <td class="px-4 py-3">
          <select class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
            <option value="">请选择柜型</option>
            <option value="20GP">20GP</option>
            <option value="40GP">40GP</option>
            <option value="40HQ">40HQ</option>
            <option value="45HQ">45HQ</option>
            <option value="20RF">20RF</option>
            <option value="40RF">40RF</option>
            <option value="40RH">40RH</option>
            <option value="20OT">20OT</option>
            <option value="40OT">40OT</option>
            <option value="20FR">20FR</option>
            <option value="40FR">40FR</option>
          </select>
        </td>
        <td class="px-4 py-3">
          <div class="relative">
            <input type="number" step="0.01" placeholder="请输入单价" 
                   class="w-full pl-8 pr-4 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
            <span class="absolute left-2 top-1/2 -translate-y-1/2 text-neutral-500 text-sm">$</span>
          </div>
        </td>
        <td class="px-4 py-3">
          <input type="text" placeholder="可选" 
                 class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
        </td>
        <td class="px-4 py-3">
          <button type="button" class="remove-container-item p-1 bg-red-50 text-red-600 rounded hover:bg-red-100 transition-all-300">
            <i class="fa fa-trash text-xs"></i>
          </button>
        </td>
      `;
      
      containerPriceList.appendChild(newRow);
      
      // 绑定新添加的删除按钮事件
      bindRemoveContainerPriceEvents();
    }
    
    // 绑定删除阶梯按钮事件
    function bindRemoveContainerPriceEvents() {
      // 先移除所有现有事件监听器（通过事件委托方式实现）
      const containerPriceList = document.getElementById('containerPriceList');
      
      // 移除所有现有事件监听器
      const newContainer = containerPriceList.cloneNode(true);
      containerPriceList.parentNode.replaceChild(newContainer, containerPriceList);
      
      // 重新绑定事件委托
      newContainer.addEventListener('click', function(event) {
        if (event.target.closest('.remove-container-item')) {
          const itemCount = newContainer.querySelectorAll('.container-price-item').length;
          if (itemCount > 1) {
            event.target.closest('.container-price-item').remove();
          } else {
            alert('至少需要保留一个阶梯');
          }
        }
      });
    }
    
    // 添加仓储费阶梯费用项目
    function addStoragePriceItem() {
      // 每次都重新获取最新的storagePriceList元素
      const storagePriceList = document.getElementById('storagePriceList');
      const itemCount = storagePriceList.querySelectorAll('.container-price-item').length + 1;
      
      const newRow = document.createElement('tr');
      newRow.className = 'border-b border-neutral-200 container-price-item';
      newRow.innerHTML = `
        <td class="px-4 py-3">
          <select class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300" disabled>
            <option value="箱">箱</option>
            <option value="托">托</option>
            <option value="件">件</option>
            <option value="kg">kg</option>
            <option value="m³" selected>m³</option>
          </select>
        </td>
        <td class="px-4 py-3">
          <div class="relative">
            <input type="number" step="1" placeholder="起始数量" 
                   class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
          </div>
        </td>
        <td class="px-4 py-3">
          <div class="relative">
            <input type="number" step="1" placeholder="结束数量" 
                   class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
          </div>
        </td>
        <td class="px-4 py-3">
          <div class="relative">
            <input type="number" step="0.01" placeholder="请输入价格" 
                   class="w-full pl-8 pr-4 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
            <span class="absolute left-2 top-1/2 -translate-y-1/2 text-neutral-500 text-sm">$</span>
          </div>
        </td>
        <td class="px-4 py-3">
          <input type="text" placeholder="可选" 
                 class="w-full px-3 py-2 border border-neutral-200 rounded-md text-sm focus:border-primary focus:outline-none transition-all-300">
        </td>
        <td class="px-4 py-3">
          <button type="button" class="remove-container-item p-1 bg-red-50 text-red-600 rounded hover:bg-red-100 transition-all-300">
            <i class="fa fa-trash text-xs"></i>
          </button>
        </td>
      `;
      
      storagePriceList.appendChild(newRow);
      
      // 绑定新添加的删除按钮事件
      bindRemoveStoragePriceEvents();
    }
    
    // 绑定仓储费删除阶梯按钮事件
    function bindRemoveStoragePriceEvents() {
      // 先移除所有现有事件监听器（通过事件委托方式实现）
      const storagePriceList = document.getElementById('storagePriceList');
      
      // 移除所有现有事件监听器
      const newContainer = storagePriceList.cloneNode(true);
      storagePriceList.parentNode.replaceChild(newContainer, storagePriceList);
      
      // 重新绑定事件委托
      newContainer.addEventListener('click', function(event) {
        if (event.target.closest('.remove-container-item')) {
          const itemCount = newContainer.querySelectorAll('.container-price-item').length;
          if (itemCount > 1) {
            event.target.closest('.container-price-item').remove();
          } else {
            alert('至少需要保留一个阶梯');
          }
        }
      });
    }
    
    // 保存成本
    function savePriceCard() {
      // 获取表单数据
      // 获取选中的仓库
      const selectedWarehouseCheckboxes = document.querySelectorAll('input[name="warehouse"]:checked');
      const selectedWarehouses = Array.from(selectedWarehouseCheckboxes).map(checkbox => checkbox.value);
      const priceCardType = document.getElementById('priceCardType').value;
    
      // 构建成本数据
      const priceCardData = {
        type: priceCardType,
        name: document.getElementById('priceCardName').value,
        applyScope: document.getElementById('applyScope').value,
        warehouses: selectedWarehouses,
        // 使用默认日期值，因为页面中没有日期字段
        validFrom: new Date().toISOString().split('T')[0] + ' 00:00:00',
        validTo: new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0] + ' 23:59:59',
        description: document.getElementById('description').value,
        status: 'pending' // 默认保存为未生效状态
      };
      
      // 根据成本类型添加不同的配置
      if (priceCardType === '卸货费') {
        priceCardData.calculationLogic = '根据成本类型和适用范围计算';
        priceCardData.containerConfig = getContainerConfig();
        priceCardData.bulkConfig = {
          price: parseFloat(document.getElementById('bulkPrice').value) || 0,
          unit: document.getElementById('bulkUnit').value,
          remark: document.getElementById('bulkRemark').value
        };
        priceCardData.expressConfig = {
          price: parseFloat(document.getElementById('expressPrice').value) || 0,
          unit: document.getElementById('expressUnit').value,
          remark: document.getElementById('expressRemark').value
        };
      } else if (priceCardType === '仓储费') {
        priceCardData.calculationLogic = '根据阶梯式数量计算仓储费';
        priceCardData.storageConfig = getStorageConfig();
      }
      
      // 验证必填字段
      if (!priceCardData.type) {
        alert('请选择成本类型');
        return;
      }
      
      if (!priceCardData.name) {
        alert('请输入成本名称');
        return;
      }
      
      // 模拟保存操作
      console.log('保存成本数据:', priceCardData);
      
      // 显示保存成功提示
      alert('成本保存成功！');
      
      // 跳转到成本列表页面
      window.location.href = 'index.html';
    }
    
    // 获取整柜配置
    function getContainerConfig() {
      const containerConfig = [];
      const containerItems = document.querySelectorAll('.container-price-item');
      
      containerItems.forEach((item) => {
        const select = item.querySelector('select');
        const inputs = item.querySelectorAll('input');
        
        const type = select.value;
        const price = parseFloat(inputs[0].value) || 0;
        const remark = inputs[1].value;
        
        if (type) {
          containerConfig.push({
            containerType: type,
            price: price,
            remark: remark
          });
        }
      });
      
      return containerConfig;
    }
    
    // 获取仓储费阶梯式收费配置
    function getStorageConfig() {
      const storageConfig = [];
      const storageItems = document.querySelectorAll('#storagePriceList .container-price-item');
      
      storageItems.forEach((item) => {
        const select = item.querySelector('select');
        const inputs = item.querySelectorAll('input');
        
        const unit = select.value;
        const startQuantity = parseInt(inputs[0].value) || 0;
        const endQuantity = parseInt(inputs[1].value) || 0;
        const price = parseFloat(inputs[2].value) || 0;
        const remark = inputs[3].value;
        
        storageConfig.push({
          unit: unit,
          startQuantity: startQuantity,
          endQuantity: endQuantity,
          price: price,
          remark: remark
        });
      });
      
      return storageConfig;
    }
  </script>
  
  <!-- 底部按钮区域 -->
  <div class="flex justify-center items-center gap-4 py-8 bg-white border-t border-neutral-100 mt-8">
    <button id="cancelBtn" class="px-6 py-2 border border-neutral-200 rounded-md text-sm text-neutral-700 hover:bg-neutral-50 focus:border-primary focus:outline-none transition-all-300">
      取消
    </button>
    <button id="saveBtn" class="px-6 py-2 bg-primary text-white rounded-md text-sm hover:bg-primary/90 focus:outline-none transition-all-300">
      保存
    </button>
  </div>
  
  <script>
    // 绑定底部按钮事件
    document.getElementById('cancelBtn').addEventListener('click', function() {
      if (confirm('确定要取消吗？未保存的内容将丢失。')) {
        window.location.href = 'index.html';
      }
    });
    
    document.getElementById('saveBtn').addEventListener('click', function() {
      // 保存成本
      savePriceCard();
    });
    
    // 页面加载完成后绑定事件
    document.addEventListener('DOMContentLoaded', function() {
      bindEvents();
    });
  </script>
</body>
</html>